<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –î—É–±—Ä–æ–≤–∏—Ü—è</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           –ê–î–ú–Ü–ù –ü–ê–ù–ï–õ–¨ - –°–¢–ò–õ–Ü
        ============================================ */
        .admin-wrap {
            max-width: 860px;
            margin: 2rem auto;
            padding: 0 1.5rem 4rem;
        }

        .admin-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 1.25rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        }

        .admin-card h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--color-text);
        }

        .admin-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin: 1.25rem 0 0.4rem;
            color: var(--color-text);
        }

        /* ---- Inputs ---- */
        .field {
            margin-bottom: 1rem;
        }
        .field label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.35rem;
            color: var(--color-text-secondary);
            letter-spacing: 0.02em;
        }
        .field input,
        .field select,
        .field textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: 0.625rem;
            font-size: 0.9375rem;
            font-family: 'DM Sans', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        .field input:focus,
        .field select:focus,
        .field textarea:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        .field input[type="password"] {
            letter-spacing: 0.1em;
        }

        /* ---- Buttons ---- */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.75rem;
            border: none;
            border-radius: 0.625rem;
            font-size: 0.9375rem;
            font-weight: 600;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--color-primary);
            color: white;
        }
        .btn-primary:hover { opacity: 0.88; transform: translateY(-1px); }
        .btn-green { background: #2e7d32; color: white; }
        .btn-green:hover { opacity: 0.88; }
        .btn-red { background: #c62828; color: white; }
        .btn-red:hover { opacity: 0.88; }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--color-border);
            color: var(--color-text);
        }
        .btn-outline:hover { border-color: var(--color-primary); color: var(--color-primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* ---- Notices ---- */
        .notice {
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .notice-info { background: #e3f2fd; border-left: 4px solid #1976d2; color: #0d47a1; }
        .notice-warn { background: #fff8e1; border-left: 4px solid #f9a825; color: #6d4c00; }
        .notice-success { background: #e8f5e9; border-left: 4px solid #2e7d32; color: #1b5e20; }
        .notice-error { background: #ffebee; border-left: 4px solid #c62828; color: #7f0000; }
        [data-theme="dark"] .notice-info { background: #0d2a4a; color: #90caf9; }
        [data-theme="dark"] .notice-warn { background: #3e2a00; color: #ffe082; }
        [data-theme="dark"] .notice-success { background: #0a2e12; color: #a5d6a7; }
        [data-theme="dark"] .notice-error { background: #3e0a0a; color: #ef9a9a; }

        /* ---- Status message ---- */
        #statusMsg {
            display: none;
            margin-top: 1rem;
            font-weight: 600;
        }

        /* ---- Photo preview ---- */
        #photoPreview {
            display: none;
            width: 100%;
            max-height: 260px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-top: 0.75rem;
            border: 2px solid var(--color-border);
        }

        /* ---- Photo list ---- */
        .photo-list {
            display: grid;
            gap: 0.75rem;
        }
        .photo-item {
            display: grid;
            grid-template-columns: 72px 1fr auto;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
        }
        .photo-item img {
            width: 72px;
            height: 52px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .photo-item-info h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin: 0 0 0.2rem;
        }
        .photo-item-info p {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            margin: 0;
        }
        .badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--color-primary);
            color: white;
            margin-right: 0.25rem;
        }

        /* ---- Token input with toggle ---- */
        .token-row {
            display: flex;
            gap: 0.5rem;
        }
        .token-row input { flex: 1; }

        /* ---- Step indicators ---- */
        .steps { counter-reset: step; }
        .step-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.875rem;
            align-items: flex-start;
        }
        .step-item::before {
            counter-increment: step;
            content: counter(step);
            min-width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 0.1rem;
        }
        .step-item p { margin: 0; line-height: 1.55; font-size: 0.9rem; }
        .step-item a { color: var(--color-primary); }

        /* ---- Tabs ---- */
        .tabs {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--color-border);
        }
        .tab-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            background: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        .tab-btn.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* ---- Loader ---- */
        .spinner-sm {
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.4);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            display: inline-block;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ---- Upload area ---- */
        .upload-area {
            border: 2px dashed var(--color-border);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }
        .upload-area:hover, .upload-area.drag-over {
            border-color: var(--color-primary);
            background: rgba(26, 86, 50, 0.04);
        }
        .upload-area p { margin: 0.5rem 0 0; font-size: 0.875rem; color: var(--color-text-secondary); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 600px) { .grid-2 { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<!-- ==================== HEADER ==================== -->
<header class="header">
    <div class="header-container">
        <a href="index.html" class="logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Lesser_Coat_of_Arms_of_Ukraine.svg/800px-Lesser_Coat_of_Arms_of_Ukraine.svg.png" alt="–ì–µ—Ä–±" class="logo-img">
            <div class="logo-text">
                <span class="logo-city">–î—É–±—Ä–æ–≤–∏—Ü—è</span>
                <span class="logo-subtitle">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</span>
            </div>
        </a>
        <div style="display:flex;gap:0.75rem;align-items:center;">
            <a href="index.html" class="btn btn-outline" style="padding:0.5rem 1rem;font-size:0.875rem;">‚Üê –ù–∞ —Å–∞–π—Ç</a>
            <button class="theme-toggle" id="themeToggle" aria-label="–¢–µ–º–∞">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
        </div>
    </div>
</header>

<!-- ==================== MAIN ==================== -->
<div class="admin-wrap">

    <!-- ===== LOGIN ===== -->
    <div id="loginCard" class="admin-card">
        <h2>üîê –í—Ö—ñ–¥ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <div class="notice notice-info">
            –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∞–π—Ç—É –º–æ–∂–µ –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª—è—Ç–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó.
        </div>
        <div class="field">
            <label>–ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω–∞</label>
            <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" autocomplete="off">
        </div>
        <button class="btn btn-primary" id="loginBtn">–£–≤—ñ–π—Ç–∏</button>
        <div id="loginError" class="notice notice-error" style="display:none;">‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å</div>
    </div>

    <!-- ===== ADMIN CONTENT ===== -->
    <div id="adminContent" style="display:none;">

        <!-- GitHub Token Setup -->
        <div class="admin-card" id="tokenCard">
            <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è GitHub</h2>

            <div id="tokenSetupSection">
                <div class="notice notice-warn">
                    <strong>–û–¥–Ω–æ—Ä–∞–∑–æ–≤–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è!</strong> –í–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω GitHub Personal Access Token, —â–æ–± –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –º–æ–≥–ª–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ñ–æ—Ç–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –Ω–∞ GitHub –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–æ–¥—É.
                </div>

                <div class="notice notice-info steps">
                    <strong>–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω (1 —Ö–≤–∏–ª–∏–Ω–∞):</strong>
                    <div class="step-item"><p>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ <a href="https://github.com/settings/tokens/new" target="_blank"><strong>github.com/settings/tokens/new</strong></a></p></div>
                    <div class="step-item"><p>–£ –ø–æ–ª—ñ <strong>"Note"</strong> –Ω–∞–ø–∏—à—ñ—Ç—å: <code>–î—É–±—Ä–æ–≤–∏—Ü—è –∞—Ä—Ö—ñ–≤</code></p></div>
                    <div class="step-item"><p>–£ <strong>"Expiration"</strong> –æ–±–µ—Ä—ñ—Ç—å <strong>"No expiration"</strong></p></div>
                    <div class="step-item"><p>–ü–æ—Å—Ç–∞–≤—Ç–µ –≥–∞–ª–æ—á–∫—É <strong>"repo"</strong> (–ø–µ—Ä—à–∏–π –ø—É–Ω–∫—Ç —É —Å–ø–∏—Å–∫—É)</p></div>
                    <div class="step-item"><p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∑–µ–ª–µ–Ω—É –∫–Ω–æ–ø–∫—É <strong>"Generate token"</strong></p></div>
                    <div class="step-item"><p>–°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω (–≤—ñ–Ω –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ <code>ghp_</code>) —ñ –≤—Å—Ç–∞–≤—Ç–µ –Ω–∏–∂—á–µ</p></div>
                </div>

                <div class="field">
                    <label>GitHub Personal Access Token</label>
                    <div class="token-row">
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                        <button class="btn btn-outline" id="toggleToken" style="white-space:nowrap;">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
                    </div>
                </div>
                <button class="btn btn-primary" id="saveTokenBtn">‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–∫–µ–Ω</button>
            </div>

            <div id="tokenOkSection" style="display:none;" class="notice notice-success">
                ‚úÖ –¢–æ–∫–µ–Ω –∑–±–µ—Ä–µ–∂–µ–Ω–æ. GitHub API –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ. <button class="btn btn-outline" id="changeTokenBtn" style="margin-left:0.5rem;padding:0.3rem 0.75rem;font-size:0.8rem;">–ó–º—ñ–Ω–∏—Ç–∏</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="admin-card">
            <div class="tabs">
                <button class="tab-btn active" data-tab="add">‚ûï –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</button>
                <button class="tab-btn" data-tab="list">üìã –£—Å—ñ —Ñ–æ—Ç–æ</button>
            </div>

            <!-- TAB: ADD PHOTO -->
            <div class="tab-panel active" id="tab-add">
                <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;margin-bottom:1.25rem;">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —Ñ–æ—Ç–æ</h2>

                <div class="notice notice-info" style="margin-bottom:1.5rem;">
                    <strong>–Ø–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ:</strong> –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ <a href="https://imgur.com/upload" target="_blank"><strong>imgur.com/upload</strong></a>, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ, –ø–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è ‚Üí <strong>"–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è"</strong> ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –∑–∞–∫—ñ–Ω—á—É–≤–∞—Ç–∏—Å—å –Ω–∞ <code>.jpg</code> –∞–±–æ <code>.png</code>.
                </div>

                <div class="field">
                    <label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–æ—Ç–æ (URL) *</label>
                    <input type="url" id="newPhotoUrl" placeholder="https://i.imgur.com/abc123.jpg">
                    <img id="photoPreview" src="" alt="–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥">
                </div>

                <div class="field">
                    <label>–ù–∞–∑–≤–∞ —Ñ–æ—Ç–æ *</label>
                    <input type="text" id="newPhotoTitle" placeholder="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ø–ª–æ—â–∞, 1935 —Ä—ñ–∫">
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>–ü–µ—Ä—ñ–æ–¥ *</label>
                        <select id="newPhotoPeriod">
                            <option value="">–û–±–µ—Ä—ñ—Ç—å...</option>
                            <option value="before-1900">–î–æ 1900</option>
                            <option value="1900-1939">1900‚Äî1939</option>
                            <option value="1939-1945">1939‚Äî1945 (–î—Ä—É–≥–∞ —Å–≤—ñ—Ç–æ–≤–∞)</option>
                            <option value="1945-1991">1945‚Äî1991 (–†–∞–¥—è–Ω—Å—å–∫–∏–π)</option>
                            <option value="after-1991">–ü—ñ—Å–ª—è 1991 (–ù–µ–∑–∞–ª–µ–∂–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞)</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è *</label>
                        <select id="newPhotoCategory">
                            <option value="">–û–±–µ—Ä—ñ—Ç—å...</option>
                            <option value="churches">üõê –¶–µ—Ä–∫–≤–∏ —Ç–∞ —Ö—Ä–∞–º–∏</option>
                            <option value="streets">üèòÔ∏è –í—É–ª–∏—Ü—ñ –º—ñ—Å—Ç–∞</option>
                            <option value="people">üë• –õ—é–¥–∏ —Ç–∞ –ø–æ—Ä—Ç—Ä–µ—Ç–∏</option>
                            <option value="architecture">üèõÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞</option>
                            <option value="aerial">‚úàÔ∏è –ê–µ—Ä–æ—Ñ–æ—Ç–æ–∑–Ω—ñ–º–∫–∏</option>
                            <option value="drawings">üé® –ú–∞–ª—é–Ω–∫–∏ —Ç–∞ –≥—Ä–∞–≤—é—Ä–∏</option>
                            <option value="events">üìÖ –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –ø–æ–¥—ñ—ó</option>
                        </select>
                    </div>
                </div>

                <div class="field">
                    <label>–†—ñ–∫ (–∞–±–æ –ø—Ä–∏–±–ª–∏–∑–Ω–∏–π —Ä—ñ–∫)</label>
                    <input type="text" id="newPhotoDate" placeholder="1935">
                </div>

                <button class="btn btn-green" id="publishBtn">
                    üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ñ–æ—Ç–æ –Ω–∞ —Å–∞–π—Ç
                </button>

                <div id="statusMsg" class="notice"></div>
            </div>

            <!-- TAB: PHOTO LIST -->
            <div class="tab-panel" id="tab-list">
                <h2 style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;margin-bottom:1.25rem;">–£—Å—ñ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó –≤ –∞—Ä—Ö—ñ–≤—ñ</h2>
                <div id="photoListWrap">
                    <p style="color:var(--color-text-secondary);">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
            </div>
        </div>

    </div><!-- /adminContent -->
</div>

<script>
(function(){
    var saved = localStorage.getItem("theme") || "light";
    document.documentElement.setAttribute("data-theme", saved);
    document.addEventListener("DOMContentLoaded", function() {
        var btn = document.getElementById("themeToggle");
        if (btn) btn.addEventListener("click", function() {
            var cur = document.documentElement.getAttribute("data-theme");
            var next = cur === "dark" ? "light" : "dark";
            document.documentElement.setAttribute("data-theme", next);
            localStorage.setItem("theme", next);
        });
    });
})();
</script>
<script>
// ===================================================================
// –ê–î–ú–Ü–ù –ü–ê–ù–ï–õ–¨ - –õ–û–ì–Ü–ö–ê
// ===================================================================

const ADMIN_PASSWORD  = 'admin2026';
const GITHUB_REPO     = 'jerkinsmichael13-stack/Dubrovytsia1';
const PHOTOS_FILE     = 'photos.json';
const BRANCH          = 'main';

const PERIOD_NAMES = {
    'before-1900': '–î–æ 1900',
    '1900-1939':   '1900‚Äî1939',
    '1939-1945':   '1939‚Äî1945',
    '1945-1991':   '1945‚Äî1991',
    'after-1991':  '–ü—ñ—Å–ª—è 1991'
};
const CATEGORY_NAMES = {
    churches:     'üõê –¶–µ—Ä–∫–≤–∏',
    streets:      'üèòÔ∏è –í—É–ª–∏—Ü—ñ',
    people:       'üë• –õ—é–¥–∏',
    architecture: 'üèõÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞',
    aerial:       '‚úàÔ∏è –ê–µ—Ä–æ—Ñ–æ—Ç–æ',
    drawings:     'üé® –ú–∞–ª—é–Ω–∫–∏',
    events:       'üìÖ –ü–æ–¥—ñ—ó'
};

// ‚îÄ‚îÄ‚îÄ Utility ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getToken() { return localStorage.getItem('gh_token_dubrovytsia') || ''; }
function setToken(t) { localStorage.setItem('gh_token_dubrovytsia', t); }

function showStatus(msg, type='info') {
    const el = document.getElementById('statusMsg');
    el.className = `notice notice-${type}`;
    el.innerHTML = msg;
    el.style.display = 'block';
    el.scrollIntoView({ behavior:'smooth', block:'nearest' });
}

// ‚îÄ‚îÄ‚îÄ GitHub API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function ghGet(path) {
    const r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${path}`, {
        headers: { Authorization: `token ${getToken()}`, Accept: 'application/vnd.github.v3+json' }
    });
    if (!r.ok) throw new Error(`GitHub API: ${r.status} ${r.statusText}`);
    return r.json();
}

async function ghPut(path, content, sha, message) {
    const body = { message, content: btoa(unescape(encodeURIComponent(content))), branch: BRANCH };
    if (sha) body.sha = sha;
    const r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${path}`, {
        method: 'PUT',
        headers: {
            Authorization: `token ${getToken()}`,
            Accept: 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
    });
    if (!r.ok) {
        const err = await r.json().catch(()=>({}));
        throw new Error(err.message || `GitHub API: ${r.status}`);
    }
    return r.json();
}

async function loadPhotosFromGH() {
    const data = await ghGet(PHOTOS_FILE);
    const json = decodeURIComponent(escape(atob(data.content.replace(/\n/g,''))));
    return { photos: JSON.parse(json), sha: data.sha };
}

// ‚îÄ‚îÄ‚îÄ Login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', function() {

document.getElementById('loginBtn').addEventListener('click', () => {
    const pw = document.getElementById('loginPassword').value;
    if (pw === ADMIN_PASSWORD) {
        document.getElementById('loginCard').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        document.getElementById('loginError').style.display = 'none';
        initAdmin();
    } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('loginPassword').value = '';
    }
});
document.getElementById('loginPassword').addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('loginBtn').click();
});

// ‚îÄ‚îÄ‚îÄ Init Admin ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initAdmin() {
    // Token section
    const tok = getToken();
    if (tok) {
        document.getElementById('tokenSetupSection').style.display = 'none';
        document.getElementById('tokenOkSection').style.display = 'block';
    }

    document.getElementById('saveTokenBtn').addEventListener('click', () => {
        const t = document.getElementById('githubToken').value.trim();
        if (!t.startsWith('ghp_') && !t.startsWith('github_pat_')) {
            alert('‚ùå –¢–æ–∫–µ–Ω –º–∞—î –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ ghp_ –∞–±–æ github_pat_');
            return;
        }
        setToken(t);
        document.getElementById('tokenSetupSection').style.display = 'none';
        document.getElementById('tokenOkSection').style.display = 'block';
    });

    document.getElementById('changeTokenBtn').addEventListener('click', () => {
        document.getElementById('tokenSetupSection').style.display = 'block';
        document.getElementById('tokenOkSection').style.display = 'none';
    });

    document.getElementById('toggleToken').addEventListener('click', function() {
        const inp = document.getElementById('githubToken');
        if (inp.type === 'password') { inp.type = 'text'; this.textContent = '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏'; }
        else { inp.type = 'password'; this.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏'; }
    });

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            this.classList.add('active');
            const panel = document.getElementById('tab-' + this.dataset.tab);
            if (panel) { panel.classList.add('active'); }
            if (this.dataset.tab === 'list') renderPhotoList();
        });
    });

    // Preview image on URL input
    const urlInput = document.getElementById('newPhotoUrl');
    const preview  = document.getElementById('photoPreview');
    let previewTimer;
    urlInput.addEventListener('input', () => {
        clearTimeout(previewTimer);
        previewTimer = setTimeout(() => {
            const v = urlInput.value.trim();
            if (v.startsWith('http')) {
                preview.src = v;
                preview.style.display = 'block';
                preview.onerror = () => { preview.style.display = 'none'; };
            } else {
                preview.style.display = 'none';
            }
        }, 500);
    });

    // Publish button
    document.getElementById('publishBtn').addEventListener('click', publishPhoto);
}

// ‚îÄ‚îÄ‚îÄ Publish Photo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function publishPhoto() {
    const url      = document.getElementById('newPhotoUrl').value.trim();
    const title    = document.getElementById('newPhotoTitle').value.trim();
    const period   = document.getElementById('newPhotoPeriod').value;
    const category = document.getElementById('newPhotoCategory').value;
    const date     = document.getElementById('newPhotoDate').value.trim();

    // Validation
    if (!url || !title || !period || !category) {
        showStatus('‚ùå –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (*)', 'error');
        return;
    }
    if (!url.startsWith('http')) {
        showStatus('‚ùå URL —Ñ–æ—Ç–æ –º–∞—î –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ https://', 'error');
        return;
    }
    if (!getToken()) {
        showStatus('‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å GitHub Token –≤–∏—â–µ', 'error');
        return;
    }

    const btn = document.getElementById('publishBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-sm"></span> –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è...';
    showStatus('‚è≥ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ GitHub...', 'info');

    try {
        // Load current photos.json from GitHub
        showStatus('‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∞—Ä—Ö—ñ–≤—É...', 'info');
        const { photos, sha } = await loadPhotosFromGH();

        // Add new photo
        const newPhoto = { imageUrl: url, title, period, category, date: date || new Date().getFullYear().toString() };
        photos.unshift(newPhoto); // add to beginning

        // Save back to GitHub
        showStatus('‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ GitHub...', 'info');
        await ghPut(PHOTOS_FILE, JSON.stringify(photos, null, 4), sha, `–î–æ–¥–∞–Ω–æ —Ñ–æ—Ç–æ: ${title}`);

        showStatus(`‚úÖ –§–æ—Ç–æ "<strong>${title}</strong>" —É—Å–ø—ñ—à–Ω–æ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ! –ß–µ—Ä–µ–∑ 1-3 —Ö–≤–∏–ª–∏–Ω–∏ –∑'—è–≤–∏—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç—ñ –¥–ª—è –≤—Å—ñ—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤.`, 'success');

        // Clear form
        document.getElementById('newPhotoUrl').value = '';
        document.getElementById('newPhotoTitle').value = '';
        document.getElementById('newPhotoPeriod').value = '';
        document.getElementById('newPhotoCategory').value = '';
        document.getElementById('newPhotoDate').value = '';
        document.getElementById('photoPreview').style.display = 'none';

    } catch (err) {
        let msg = err.message;
        if (msg.includes('401') || msg.includes('Bad credentials')) {
            msg = '–ù–µ–≤—ñ—Ä–Ω–∏–π GitHub Token. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É.';
        } else if (msg.includes('404')) {
            msg = '–§–∞–π–ª photos.json –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏ –π–æ–≥–æ –Ω–∞ GitHub.';
        }
        showStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${msg}`, 'error');
    } finally {
        btn.disabled = false;
        btn.innerHTML = 'üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ñ–æ—Ç–æ –Ω–∞ —Å–∞–π—Ç';
    }
}

// ‚îÄ‚îÄ‚îÄ Photo List ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderPhotoList() {
    const wrap = document.getElementById('photoListWrap');
    wrap.innerHTML = '<p style="color:var(--color-text-secondary);">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>';

    if (!getToken()) {
        wrap.innerHTML = '<div class="notice notice-warn">–ó–±–µ—Ä–µ–∂—ñ—Ç—å GitHub Token –≤–∏—â–µ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π.</div>';
        return;
    }

    try {
        const { photos, sha: fileSha } = await loadPhotosFromGH();

        if (photos.length === 0) {
            wrap.innerHTML = '<p style="color:var(--color-text-secondary);">–§–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π —â–µ –Ω–µ–º–∞—î</p>';
            return;
        }

        wrap.innerHTML = `
            <p style="color:var(--color-text-secondary);margin-bottom:1rem;">–í—Å—å–æ–≥–æ: <strong>${photos.length}</strong> —Ñ–æ—Ç–æ</p>
            <div class="photo-list" id="photoListItems"></div>
        `;

        const list = document.getElementById('photoListItems');
        photos.forEach((p, idx) => {
            const item = document.createElement('div');
            item.className = 'photo-item';
            item.innerHTML = `
                <img src="${p.imageUrl}" alt="${p.title}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'72\' height=\'52\'%3E%3Crect fill=\'%23ddd\' width=\'100%25\' height=\'100%25\'/%3E%3C/svg%3E'">
                <div class="photo-item-info">
                    <h4>${p.title}</h4>
                    <p>
                        <span class="badge">${PERIOD_NAMES[p.period] || p.period}</span>
                        <span class="badge" style="background:#5d4037;">${CATEGORY_NAMES[p.category] || p.category}</span>
                        ${p.date ? `<span style="font-size:0.75rem;color:var(--color-text-secondary);">${p.date} —Ä.</span>` : ''}
                    </p>
                </div>
                <button class="btn btn-red" data-idx="${idx}" style="padding:0.5rem 0.875rem;font-size:0.8rem;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            `;
            list.appendChild(item);
        });

        // Delete handlers
        list.querySelectorAll('[data-idx]').forEach(btn => {
            btn.addEventListener('click', async function() {
                const idx = parseInt(this.dataset.idx);
                const title = photos[idx].title;
                if (!confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–æ—Ç–æ "${title}"?\n–¶—é –¥—ñ—é –Ω–µ –º–æ–∂–Ω–∞ —Å–∫–∞—Å—É–≤–∞—Ç–∏.`)) return;
                this.disabled = true;
                this.textContent = '...';
                try {
                    const { photos: fresh, sha } = await loadPhotosFromGH();
                    // Find by imageUrl to be safe
                    const removeUrl = photos[idx].imageUrl;
                    const updated = fresh.filter(p => p.imageUrl !== removeUrl);
                    await ghPut(PHOTOS_FILE, JSON.stringify(updated, null, 4), sha, `–í–∏–¥–∞–ª–µ–Ω–æ —Ñ–æ—Ç–æ: ${title}`);
                    renderPhotoList(); // refresh
                } catch(e) {
                    alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + e.message);
                    this.disabled = false;
                    this.textContent = '–í–∏–¥–∞–ª–∏—Ç–∏';
                }
            });
        });

    } catch(e) {
        let msg = e.message;
        if (msg.includes('401')) msg = '–ù–µ–≤—ñ—Ä–Ω–∏–π GitHub Token.';
        wrap.innerHTML = `<div class="notice notice-error">‚ùå ${msg}</div>`;
    }
}

}); // end DOMContentLoaded
</script>
</body>
</html>
