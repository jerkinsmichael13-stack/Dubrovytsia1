<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Цифровий архів найдавнішого міста Рівненщини - Дубровиці. Історія від 1005 року, фотоархів, метричні книги">
    <meta name="keywords" content="Дубровиця, історія, архів, Рівненська область, Україна, Полісся">
    <meta property="og:title" content="Дубровиця — Найдавніше місто Рівненщини">
    <meta property="og:description" content="Цифровий архів історичної спадщини міста Дубровиця">
    <meta property="og:type" content="website">
    <title>Дубровиця — Історія та спадщина</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="https://i.imgur.com/mXCrjjG.png" alt="Герб" class="logo-img" loading="lazy">
                <div class="logo-text">
                    <span class="logo-city">Дубровиця</span>
                    <span class="logo-subtitle">Цифровий архів</span>
                </div>
            </a>
            
            <nav class="nav" id="mainNav">
                <a href="index.html" class="nav-link active">Головна</a>
                <a href="history.html" class="nav-link">Історія</a>
                <a href="photo-archive.html" class="nav-link">Фотоархів</a>
                <a href="metrychni-knyhy.html" class="nav-link">Метричні книги</a>
                <a href="books.html" class="nav-link">Книги</a>
                <a href="contacts.html" class="nav-link">Контакти</a>
            </nav>

            <button class="theme-toggle" id="themeToggle" aria-label="Перемкнути тему">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <button class="mobile-toggle" id="mobileToggle" aria-label="Відкрити меню">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Hero Section with Video Background -->
    <section class="hero">
        <div class="hero-bg">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    Дубровиця
                </h1>
                <p class="hero-subtitle">
                    Найдавніше місто Рівненщини з 1015-річною історією
                </p>
                <div class="hero-meta">
                    <span>Рівненська область</span>
                    <span class="separator">·</span>
                    <span>Полісся</span>
                    <span class="separator">·</span>
                    <span>Україна</span>
                </div>
            </div>
            <div class="hero-scroll fade-in-up delay-3">
                <span class="scroll-text">Прокрутіть</span>
                <div class="scroll-line"></div>
            </div>
        </div>
    </section>

    <!-- Introduction -->
    <section class="intro-section">
        <div class="container">
            <div class="intro-content">
                <p class="intro-lead fade-in-up">
                    Дубровиця — найдавніше місто Рівненської області, перша писемна згадка про яке датується 1005 роком. 
                    Місто розташоване на мальовничих берегах річки Горинь у серці Волинського Полісся.
                </p>
                <p class="intro-text fade-in-up delay-1">
                    Цей цифровий архів створено для збереження, систематизації та популяризації історичної спадщини, 
                    культури та пам'яті нашого міста. Тут ви знайдете історичні фотографії, метричні книги, дослідження 
                    та матеріали, які розкривають багатовікову історію Дубровиці.
                </p>
            </div>
        </div>
    </section>

    <!-- Navigation Cards -->
    <section class="cards-section">
        <div class="container">
            <div class="cards-grid">
                <a href="history.html" class="card fade-in-up">
                    <div class="card-image">
                        <img src="https://i.imgur.com/QTP89kg.jpeg" alt="Історія" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Історія міста</h3>
                        <p class="card-description">
                            Досліджуйте понад тисячолітню історію Дубровиці від першої згадки у 1005 році до сьогодення
                        </p>
                        <span class="card-link">Читати далі →</span>
                    </div>
                </a>

                <a href="photo-archive.html" class="card fade-in-up delay-1">
                    <div class="card-image">
                        <img src="https://i.imgur.com/qcjgN1I.jpeg" alt="Фотоархів" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Фотоархів</h3>
                        <p class="card-description">
                            Унікальна колекція історичних фотографій від кінця XIX століття до наших днів
                        </p>
                        <span class="card-link">Переглянути →</span>
                    </div>
                </a>

                <a href="metrychni-knyhy.html" class="card fade-in-up delay-2">
                    <div class="card-image">
                        <img src="https://i.imgur.com/WeDmtIY.jpeg" alt="Метричні книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Метричні книги</h3>
                        <p class="card-description">
                            Генеалогічні дослідження: метричні записи парафій Дубровицького регіону
                        </p>
                        <span class="card-link">Досліджуйте →</span>
                    </div>
                </a>

                <a href="books.html" class="card fade-in-up delay-3">
                    <div class="card-image">
                        <img src="https://i.imgur.com/SPhDh6n.jpeg" alt="Книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Книги про Дубровицю</h3>
                        <p class="card-description">
                            Бібліографія досліджень, спогадів та літератури про історію регіону
                        </p>
                        <span class="card-link">Читати →</span>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item fade-in-up">
                    <div class="stat-number" data-target="1015">0</div>
                    <div class="stat-label">Років історії</div>
                </div>
                <div class="stat-item fade-in-up delay-1">
                    <div class="stat-number" data-target="500">0</div>
                    <div class="stat-label">Історичних фотографій</div>
                </div>
                <div class="stat-item fade-in-up delay-2">
                    <div class="stat-number" data-target="20">0</div>
                    <div class="stat-label">Книг та досліджень</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ═══ AERIAL INTERACTIVE MAP v3 ═══ -->
    <section id="aerialSection">
    <style>
    #aerialSection {
        padding: 5rem 0;
        background: #faf7f2;
        border-top: 1px solid #e8e0d4;
        border-bottom: 1px solid #e8e0d4;
        position: relative;
    }
    [data-theme="dark"] #aerialSection { background:#0e0c0a; border-color:#1e1b18; }
    #aerialSection *, #aerialSection *::before, #aerialSection *::after { box-sizing:border-box; }

    /* ── CONTAINER ── */
    .aer-wrap { max-width:1160px; margin:0 auto; padding:0 2rem; }

    /* ── HEADER ── */
    .aer-head { text-align:center; margin-bottom:2.5rem; }
    .aer-title {
        font-family:'Cormorant Garamond',Georgia,serif;
        font-size:clamp(1.9rem,3.2vw,2.6rem);
        font-weight:500; color:#1c1917; margin:0 0 0.5rem;
        letter-spacing:0.01em;
    }
    [data-theme="dark"] .aer-title { color:#f0e6c8; }
    .aer-title-line {
        display:block; width:44px; height:2px;
        background:linear-gradient(90deg,#c9a227,#e0bd5a);
        margin:0.6rem auto 0; border-radius:2px;
    }
    .aer-sub {
        font-family:'DM Sans',sans-serif; font-size:0.78rem;
        letter-spacing:0.13em; text-transform:uppercase;
        color:#a09080; margin:0.6rem 0 0;
    }

    /* ── GRID ── */
    .aer-grid {
        display:grid;
        grid-template-columns:1fr 260px;
        gap:1.8rem; align-items:start;
    }
    @media(max-width:820px){ .aer-grid{grid-template-columns:1fr;} }

    /* ── MAP WRAP ── */
    .aer-map {
        position:relative; border-radius:14px;
        overflow:hidden;
        box-shadow:0 4px 6px rgba(0,0,0,.04),
                   0 10px 28px rgba(0,0,0,.10),
                   0 24px 56px rgba(0,0,0,.10);
        background:#0a0a0a; line-height:0;
        border:1px solid rgba(201,162,39,0.15);
    }
    .aer-img {
        width:100%; height:auto; display:block;
        filter:sepia(0.08) contrast(1.06) brightness(0.97);
        pointer-events:none; user-select:none;
    }
    .aer-svg {
        position:absolute; top:0; left:0;
        width:100%; height:100%;
    }

    /* ── DATE BADGE ── */
    .aer-badge {
        position:absolute; top:13px; right:13px;
        background:rgba(8,6,4,0.82);
        backdrop-filter:blur(10px);
        border:1px solid rgba(201,162,39,0.28);
        border-radius:9px; padding:6px 13px;
        pointer-events:none;
    }
    .aer-badge-lbl {
        display:block; font-family:'DM Sans',sans-serif;
        font-size:0.5rem; letter-spacing:0.18em;
        text-transform:uppercase; color:#6b5a3e;
    }
    .aer-badge-date {
        display:block; font-family:'Cormorant Garamond',serif;
        font-size:0.98rem; color:#c9a227;
        letter-spacing:0.07em; font-weight:500;
    }

    /* ── SVG MARKERS ── */
    .aer-pin-ring {
        fill:none; stroke:rgba(201,162,39,0.35); stroke-width:1.5;
        transform-box:fill-box; transform-origin:center;
        animation:aerRing 2.8s ease-out infinite;
    }
    @keyframes aerRing {
        0%  { r:11; opacity:.7; }
        65% { r:22; opacity:0; }
        100%{ r:11; opacity:0; }
    }
    .aer-pin-circle {
        fill:#c9a227; stroke:rgba(255,255,255,0.9); stroke-width:1.8;
        cursor:pointer;
        transition:fill .18s, r .18s;
        filter:drop-shadow(0 2px 6px rgba(0,0,0,.5));
    }
    .aer-pin-circle:hover { fill:#f0c840; }
    .aer-pin-circle.aer-active { fill:#f0c840; stroke:#fff; stroke-width:2.2; }
    .aer-pin-label {
        font-family:'DM Sans',sans-serif; font-size:9.5px;
        font-weight:800; fill:#1a1000;
        text-anchor:middle; dominant-baseline:central;
        pointer-events:none; user-select:none;
    }
    .aer-marker-g { cursor:pointer; }

    /* ── TOOLTIP (inside map, bottom-aligned) ── */
    #aerTT {
        position:absolute;
        background:rgba(8,6,4,0.93);
        backdrop-filter:blur(14px);
        border:1px solid rgba(201,162,39,0.32);
        border-radius:10px;
        padding:11px 14px 12px;
        width:220px;
        pointer-events:none;
        opacity:0;
        transform:translateY(4px);
        transition:opacity .18s, transform .18s;
        z-index:20;
        box-shadow:0 8px 32px rgba(0,0,0,.55);
    }
    #aerTT.show { opacity:1; transform:translateY(0); }
    .tt-row { display:flex; align-items:center; gap:8px; margin-bottom:5px; }
    .tt-num {
        flex-shrink:0; width:20px; height:20px; border-radius:50%;
        background:#c9a227; color:#1a1000;
        font-family:'DM Sans',sans-serif; font-size:0.6rem; font-weight:800;
        display:flex; align-items:center; justify-content:center;
    }
    .tt-title {
        font-family:'Cormorant Garamond',serif;
        font-size:0.92rem; font-weight:600;
        color:#f0e6c8; line-height:1.2;
    }
    .tt-desc {
        font-family:'DM Sans',sans-serif;
        font-size:0.68rem; color:#9e9080; line-height:1.55;
        display:block; margin-top:1px;
    }
    .tt-close {
        position:absolute; top:7px; right:9px;
        width:18px; height:18px;
        background:rgba(255,255,255,0.08);
        border:none; border-radius:50%; cursor:pointer;
        color:#7a6a5a; font-size:0.75rem; line-height:18px;
        text-align:center; pointer-events:all;
        display:flex; align-items:center; justify-content:center;
        transition:background .15s, color .15s;
    }
    .tt-close:hover { background:rgba(255,255,255,0.18); color:#fff; }

    /* ── LEGEND ── */
    .aer-legend {
        background:#ffffff;
        border:1px solid #e0d8cd;
        border-radius:13px;
        padding:1.3rem 1.1rem 1.1rem;
        position:sticky; top:90px;
        box-shadow:0 2px 4px rgba(0,0,0,.04),
                   0 8px 20px rgba(0,0,0,.06);
    }
    [data-theme="dark"] .aer-legend { background:#161310; border-color:#2a2520; }
    .aer-leg-head {
        font-family:'Cormorant Garamond',serif;
        font-size:1.05rem; font-weight:600;
        color:#1c1917; margin:0 0 0.85rem;
        padding-bottom:0.65rem;
        border-bottom:1px solid #e0d8cd;
    }
    [data-theme="dark"] .aer-leg-head { color:#e0d4bc; border-color:#2a2520; }
    .aer-leg-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:3px; }
    .aer-leg-item {
        display:flex; align-items:center; gap:9px;
        padding:6px 9px; border-radius:7px;
        cursor:pointer;
        border:1px solid transparent;
        transition:background .15s, border-color .15s;
        font-family:'DM Sans',sans-serif;
        font-size:0.74rem; color:#44403c;
        user-select:none;
    }
    [data-theme="dark"] .aer-leg-item { color:#a09080; }
    .aer-leg-item:hover { background:#f4efe7; }
    [data-theme="dark"] .aer-leg-item:hover { background:rgba(255,255,255,0.05); }
    .aer-leg-item.aer-active {
        background:#fdf5e0;
        border-color:rgba(201,162,39,0.5);
    }
    [data-theme="dark"] .aer-leg-item.aer-active { background:rgba(201,162,39,0.1); }
    .aer-leg-num {
        flex-shrink:0; width:22px; height:22px; border-radius:50%;
        background:#c9a227; color:#1a1000;
        font-family:'DM Sans',sans-serif; font-size:0.6rem; font-weight:800;
        display:flex; align-items:center; justify-content:center;
        transition:transform .15s;
    }
    .aer-leg-item:hover .aer-leg-num,
    .aer-leg-item.aer-active .aer-leg-num { transform:scale(1.12); }
    .aer-leg-hint {
        margin-top:0.9rem; font-size:0.65rem; color:#b0a898;
        font-family:'DM Sans',sans-serif; line-height:1.55;
        font-style:italic; border-top:1px solid #e8e0d4;
        padding-top:0.75rem;
    }
    [data-theme="dark"] .aer-leg-hint { color:#4e4540; border-color:#2a2520; }
    </style>

    <div class="aer-wrap">
        <div class="aer-head">
            <h2 class="aer-title">Аерофотознімок 1944 року<span class="aer-title-line"></span></h2>
            <p class="aer-sub">Дубровиця &middot; 24 січня 1944 &middot; Інтерактивна карта</p>
        </div>

        <div class="aer-grid">
            <!-- MAP -->
            <div class="aer-map" id="aerMap">
                <img class="aer-img" src="https://i.imgur.com/dyP4WgZ.jpeg"
                     alt="Аерофотознімок Дубровиці 1944" id="aerImg">

                <!-- SVG markers — viewBox 1200×951 matches image natural size -->
                <svg class="aer-svg" viewBox="0 0 1200 951"
                     xmlns="http://www.w3.org/2000/svg" id="aerSVG">

                    <!-- Corrected positions based on annotated reference photo -->
                    <!-- 1 — Давнє городище  ~54% x, 64% y -->
                    <g class="aer-marker-g" data-id="1"
                       data-title="Давнє городище"
                       data-desc="Колись тут стояв замок Дубровицьких князів, зруйнований татарами у XIII ст.">
                        <circle class="aer-pin-ring" cx="648" cy="608" r="11"/>
                        <circle class="aer-pin-circle" cx="648" cy="608" r="9.5" id="pc1"/>
                        <text class="aer-pin-label" x="648" y="608">1</text>
                    </g>
                    <!-- 2 — Святомиколаївська церква  ~55% x, 77% y -->
                    <g class="aer-marker-g" data-id="2"
                       data-title="Святомиколаївська церква"
                       data-desc="Православна церква Святого Миколая — одна з найстаріших парафій Дубровиці.">
                        <circle class="aer-pin-ring" cx="660" cy="732" r="11" style="animation-delay:.6s"/>
                        <circle class="aer-pin-circle" cx="660" cy="732" r="9.5" id="pc2"/>
                        <text class="aer-pin-label" x="660" y="732">2</text>
                    </g>
                    <!-- 3 — Костел Іоанна Хрестителя  ~60% x, 50% y -->
                    <g class="aer-marker-g" data-id="3"
                       data-title="Костел Іоанна Хрестителя"
                       data-desc="Збудований у 1695–1702 рр. орденом піярів. Унікальна пам&#39;ятка барокової архітектури Полісся.">
                        <circle class="aer-pin-ring" cx="720" cy="475" r="11" style="animation-delay:1.1s"/>
                        <circle class="aer-pin-circle" cx="720" cy="475" r="9.5" id="pc3"/>
                        <text class="aer-pin-label" x="720" y="475">3</text>
                    </g>
                    <!-- 4 — Кам'яна церква  ~44% x, 31% y -->
                    <g class="aer-marker-g" data-id="4"
                       data-title="Кам&#39;яна церква"
                       data-desc="Мурована православна церква — помітний орієнтир у тогочасній забудові міста.">
                        <circle class="aer-pin-ring" cx="528" cy="295" r="11" style="animation-delay:.3s"/>
                        <circle class="aer-pin-circle" cx="528" cy="295" r="9.5" id="pc4"/>
                        <text class="aer-pin-label" x="528" y="295">4</text>
                    </g>
                    <!-- 5 — Синагога  ~45% x, 63% y -->
                    <g class="aer-marker-g" data-id="5"
                       data-title="Синагога"
                       data-desc="Єврейська громада була значною частиною Дубровиці аж до Голокосту 1942 року.">
                        <circle class="aer-pin-ring" cx="540" cy="599" r="11" style="animation-delay:.9s"/>
                        <circle class="aer-pin-circle" cx="540" cy="599" r="9.5" id="pc5"/>
                        <text class="aer-pin-label" x="540" y="599">5</text>
                    </g>
                    <!-- 6 — Нове русло Горині  ~88% x, 59% y -->
                    <g class="aer-marker-g" data-id="6"
                       data-title="Нове русло Горині"
                       data-desc="Сьогодні тут протікає основне русло річки Горинь — воно змінилося після 1944 р.">
                        <circle class="aer-pin-ring" cx="1056" cy="561" r="11" style="animation-delay:1.4s"/>
                        <circle class="aer-pin-circle" cx="1056" cy="561" r="9.5" id="pc6"/>
                        <text class="aer-pin-label" x="1056" y="561">6</text>
                    </g>
                    <!-- 7 — Стара Горинь  ~77% x, 56% y -->
                    <g class="aer-marker-g" data-id="7"
                       data-title="Стара Горинь (1944)"
                       data-desc="На момент зйомки — повноцінне русло річки Горинь, яке пізніше обміліло.">
                        <circle class="aer-pin-ring" cx="924" cy="532" r="11" style="animation-delay:.5s"/>
                        <circle class="aer-pin-circle" cx="924" cy="532" r="9.5" id="pc7"/>
                        <text class="aer-pin-label" x="924" y="532">7</text>
                    </g>
                    <!-- 8 — Єврейське кладовище  ~33% x, 12% y -->
                    <g class="aer-marker-g" data-id="8"
                       data-title="Єврейське кладовище"
                       data-desc="Старе єврейське кладовище на північній околиці міста — пам&#39;ятник трагічній долі громади.">
                        <circle class="aer-pin-ring" cx="396" cy="114" r="11" style="animation-delay:1.2s"/>
                        <circle class="aer-pin-circle" cx="396" cy="114" r="9.5" id="pc8"/>
                        <text class="aer-pin-label" x="396" y="114">8</text>
                    </g>
                    <!-- 9 — Центральна площа  ~50% x, 53% y -->
                    <g class="aer-marker-g" data-id="9"
                       data-title="Центральна площа"
                       data-desc="Ринкова площа — серце міського життя Дубровиці протягом багатьох століть.">
                        <circle class="aer-pin-ring" cx="600" cy="504" r="11" style="animation-delay:.7s"/>
                        <circle class="aer-pin-circle" cx="600" cy="504" r="9.5" id="pc9"/>
                        <text class="aer-pin-label" x="600" y="504">9</text>
                    </g>
                </svg>

                <!-- Tooltip: absolute inside the map container -->
                <div id="aerTT">
                    <button class="tt-close" id="aerTTClose" aria-label="Закрити">&#x2715;</button>
                    <div class="tt-row">
                        <span class="tt-num" id="aerTTNum"></span>
                        <span class="tt-title" id="aerTTTitle"></span>
                    </div>
                    <span class="tt-desc" id="aerTTDesc"></span>
                </div>

                <div class="aer-badge">
                    <span class="aer-badge-lbl">Аерофотознімок</span>
                    <span class="aer-badge-date">24 &middot; I &middot; 1944</span>
                </div>
            </div>

            <!-- LEGEND -->
            <div class="aer-legend">
                <p class="aer-leg-head">Позначення</p>
                <ul class="aer-leg-list" id="aerLegList">
                    <li class="aer-leg-item" data-leg="1"><span class="aer-leg-num">1</span>Давнє городище (замок)</li>
                    <li class="aer-leg-item" data-leg="2"><span class="aer-leg-num">2</span>Святомиколаївська церква</li>
                    <li class="aer-leg-item" data-leg="3"><span class="aer-leg-num">3</span>Костел Іоанна Хрестителя</li>
                    <li class="aer-leg-item" data-leg="4"><span class="aer-leg-num">4</span>Кам&apos;яна церква</li>
                    <li class="aer-leg-item" data-leg="5"><span class="aer-leg-num">5</span>Синагога</li>
                    <li class="aer-leg-item" data-leg="6"><span class="aer-leg-num">6</span>Нове русло Горині</li>
                    <li class="aer-leg-item" data-leg="7"><span class="aer-leg-num">7</span>Стара Горинь (1944)</li>
                    <li class="aer-leg-item" data-leg="8"><span class="aer-leg-num">8</span>Єврейське кладовище</li>
                    <li class="aer-leg-item" data-leg="9"><span class="aer-leg-num">9</span>Центральна площа</li>
                </ul>
                <p class="aer-leg-hint">Натисніть на маркер або пункт списку, щоб дізнатися більше</p>
            </div>
        </div>
    </div>

    <script>
    (function(){
        var mapEl   = document.getElementById('aerMap');
        var svgEl   = document.getElementById('aerSVG');
        var tt      = document.getElementById('aerTT');
        var ttNum   = document.getElementById('aerTTNum');
        var ttTitle = document.getElementById('aerTTTitle');
        var ttDesc  = document.getElementById('aerTTDesc');
        var ttClose = document.getElementById('aerTTClose');

        var markers  = svgEl.querySelectorAll('.aer-marker-g');
        var legItems = document.querySelectorAll('#aerLegList .aer-leg-item');
        var circles  = svgEl.querySelectorAll('.aer-pin-circle');

        var activeId = null;

        /* ── helpers ── */
        function clearAll() {
            circles.forEach(function(c){ c.classList.remove('aer-active'); });
            legItems.forEach(function(l){ l.classList.remove('aer-active'); });
            tt.classList.remove('show');
            activeId = null;
        }

        function positionTooltip(svgCX, svgCY) {
            /* Convert SVG viewBox coords → pixel position inside mapEl */
            var vb   = svgEl.viewBox.baseVal;          // 0 0 1200 951
            var rect = mapEl.getBoundingClientRect();
            var scaleX = rect.width  / vb.width;
            var scaleY = rect.height / vb.height;

            var px = svgCX * scaleX;   // px from map left
            var py = svgCY * scaleY;   // px from map top

            var ttW = 220, ttH = 90;
            var mapW = rect.width, mapH = rect.height;

            /* Prefer right of marker, flip left if overflow */
            var left = px + 16;
            var top  = py - ttH / 2;

            if (left + ttW > mapW - 10) left = px - ttW - 16;
            if (left < 6) left = 6;
            if (top < 6)  top = 6;
            if (top + ttH > mapH - 6) top = mapH - ttH - 6;

            tt.style.left = left + 'px';
            tt.style.top  = top  + 'px';
        }

        function activate(id, svgCX, svgCY) {
            if (activeId === id) { clearAll(); return; }
            clearAll();
            activeId = id;

            /* highlight circle */
            var c = document.getElementById('pc' + id);
            if (c) c.classList.add('aer-active');

            /* highlight legend */
            legItems.forEach(function(l){
                if (l.dataset.leg === id) l.classList.add('aer-active');
            });

            /* fill tooltip */
            var g = svgEl.querySelector('.aer-marker-g[data-id="'+id+'"]');
            ttNum.textContent   = id;
            ttTitle.textContent = g.dataset.title;
            ttDesc.textContent  = g.dataset.desc;

            positionTooltip(svgCX, svgCY);
            tt.classList.add('show');
        }

        /* ── marker clicks ── */
        markers.forEach(function(g){
            g.addEventListener('click', function(e){
                e.stopPropagation();
                var id = g.dataset.id;
                /* Get cx,cy from the ring circle (first circle child) */
                var ring = g.querySelector('.aer-pin-ring');
                var cx = parseFloat(ring.getAttribute('cx'));
                var cy = parseFloat(ring.getAttribute('cy'));
                activate(id, cx, cy);
            });
        });

        /* ── legend clicks ── */
        legItems.forEach(function(item){
            item.addEventListener('click', function(e){
                e.stopPropagation();
                var id = item.dataset.leg;
                var g  = svgEl.querySelector('.aer-marker-g[data-id="'+id+'"]');
                if (!g) return;
                var ring = g.querySelector('.aer-pin-ring');
                var cx = parseFloat(ring.getAttribute('cx'));
                var cy = parseFloat(ring.getAttribute('cy'));
                activate(id, cx, cy);
            });
        });

        /* ── close button ── */
        ttClose.addEventListener('click', function(e){
            e.stopPropagation();
            clearAll();
        });

        /* ── click outside → close ── */
        document.addEventListener('click', function(){ clearAll(); });
        mapEl.addEventListener('click', function(e){
            if (!e.target.closest('.aer-marker-g') && !e.target.closest('#aerTT')){
                clearAll();
            }
        });
    })();
    </script>
    </section>
    <!-- ═══ END AERIAL MAP ═══ -->

        <!-- Timeline Preview -->
    <section class="timeline-section">
        <div class="container">
            <h2 class="section-title fade-in-up">Ключові моменти історії</h2>
            <div class="timeline">
                <div class="timeline-item fade-in-up">
                    <div class="timeline-year">1005</div>
                    <div class="timeline-content">
                        <h3>Перша згадка</h3>
                        <p>Володимир Великий засновує єпископську кафедру в Турові, Дубровиця згадується серед міст єпархії</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-1">
                    <div class="timeline-year">XII ст.</div>
                    <div class="timeline-content">
                        <h3>Столиця князівства</h3>
                        <p>Дубровиця стає центром окремого удільного князівства</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-2">
                    <div class="timeline-year">1695-1702</div>
                    <div class="timeline-content">
                        <h3>Костел Іоана Хрестителя</h3>
                        <p>Спорудження костелу та колегіуму ордена піярів</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-3">
                    <div class="timeline-year">1940</div>
                    <div class="timeline-content">
                        <h3>Статус міста</h3>
                        <p>Дубровиця офіційно стає містом та районним центром</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="footer-title">Дубровиця</h4>
                    <p class="footer-text">
                        Цифровий архів історичної спадщини селища міського типу Дубровиця, 
                        Сарненський район, Рівненська область, Україна.
                    </p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Навігація</h4>
                    <nav class="footer-nav">
                        <a href="history.html">Історія</a>
                        <a href="photo-archive.html">Фотоархів</a>
                        <a href="metrychni-knyhy.html">Метричні книги</a>
                        <a href="books.html">Книги</a>
                    </nav>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Контакти</h4>
                    <p class="footer-text">
                        Маєте матеріали або пропозиції?<br>
                        <a href="contacts.html" class="footer-link">Зв'яжіться з нами</a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Дубровиця. Цифровий архів.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>
