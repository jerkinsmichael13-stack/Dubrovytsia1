<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Цифровий архів найдавнішого міста Рівненщини - Дубровиці. Історія від 1005 року, фотоархів, метричні книги">
    <meta name="keywords" content="Дубровиця, історія, архів, Рівненська область, Україна, Полісся">
    <meta property="og:title" content="Дубровиця — Найдавніше місто Рівненщини">
    <meta property="og:description" content="Цифровий архів історичної спадщини міста Дубровиця">
    <meta property="og:type" content="website">
    <title>Дубровиця — Історія та спадщина</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="https://i.imgur.com/mXCrjjG.png" alt="Герб" class="logo-img" loading="lazy">
                <div class="logo-text">
                    <span class="logo-city">Дубровиця</span>
                    <span class="logo-subtitle">Цифровий архів</span>
                </div>
            </a>
            
            <nav class="nav" id="mainNav">
                <a href="index.html" class="nav-link active">Головна</a>
                <a href="history.html" class="nav-link">Історія</a>
                <a href="photo-archive.html" class="nav-link">Фотоархів</a>
                <a href="metrychni-knyhy.html" class="nav-link">Метричні книги</a>
                <a href="books.html" class="nav-link">Книги</a>
                <a href="contacts.html" class="nav-link">Контакти</a>
            </nav>

            <button class="theme-toggle" id="themeToggle" aria-label="Перемкнути тему">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <button class="mobile-toggle" id="mobileToggle" aria-label="Відкрити меню">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Hero Section with Video Background -->
    <section class="hero">
        <div class="hero-bg">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    Дубровиця
                </h1>
                <p class="hero-subtitle">
                    Найдавніше місто Рівненщини з 1015-річною історією
                </p>
                <div class="hero-meta">
                    <span>Рівненська область</span>
                    <span class="separator">·</span>
                    <span>Полісся</span>
                    <span class="separator">·</span>
                    <span>Україна</span>
                </div>
            </div>
            <div class="hero-scroll fade-in-up delay-3">
                <span class="scroll-text">Прокрутіть</span>
                <div class="scroll-line"></div>
            </div>
        </div>
    </section>

    <!-- Introduction -->
    <section class="intro-section">
        <div class="container">
            <div class="intro-content">
                <p class="intro-lead fade-in-up">
                    Дубровиця — найдавніше місто Рівненської області, перша писемна згадка про яке датується 1005 роком. 
                    Місто розташоване на мальовничих берегах річки Горинь у серці Волинського Полісся.
                </p>
                <p class="intro-text fade-in-up delay-1">
                    Цей цифровий архів створено для збереження, систематизації та популяризації історичної спадщини, 
                    культури та пам'яті нашого міста. Тут ви знайдете історичні фотографії, метричні книги, дослідження 
                    та матеріали, які розкривають багатовікову історію Дубровиці.
                </p>
            </div>
        </div>
    </section>

    <!-- Navigation Cards -->
    <section class="cards-section">
        <div class="container">
            <div class="cards-grid">
                <a href="history.html" class="card fade-in-up">
                    <div class="card-image">
                        <img src="https://i.imgur.com/QTP89kg.jpeg" alt="Історія" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Історія міста</h3>
                        <p class="card-description">
                            Досліджуйте понад тисячолітню історію Дубровиці від першої згадки у 1005 році до сьогодення
                        </p>
                        <span class="card-link">Читати далі →</span>
                    </div>
                </a>

                <a href="photo-archive.html" class="card fade-in-up delay-1">
                    <div class="card-image">
                        <img src="https://i.imgur.com/qcjgN1I.jpeg" alt="Фотоархів" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Фотоархів</h3>
                        <p class="card-description">
                            Унікальна колекція історичних фотографій від кінця XIX століття до наших днів
                        </p>
                        <span class="card-link">Переглянути →</span>
                    </div>
                </a>

                <a href="metrychni-knyhy.html" class="card fade-in-up delay-2">
                    <div class="card-image">
                        <img src="https://i.imgur.com/WeDmtIY.jpeg" alt="Метричні книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Метричні книги</h3>
                        <p class="card-description">
                            Генеалогічні дослідження: метричні записи парафій Дубровицького регіону
                        </p>
                        <span class="card-link">Досліджуйте →</span>
                    </div>
                </a>

                <a href="books.html" class="card fade-in-up delay-3">
                    <div class="card-image">
                        <img src="https://i.imgur.com/SPhDh6n.jpeg" alt="Книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Книги про Дубровицю</h3>
                        <p class="card-description">
                            Бібліографія досліджень, спогадів та літератури про історію регіону
                        </p>
                        <span class="card-link">Читати →</span>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item fade-in-up">
                    <div class="stat-number" data-target="1015">0</div>
                    <div class="stat-label">Років історії</div>
                </div>
                <div class="stat-item fade-in-up delay-1">
                    <div class="stat-number" data-target="500">0</div>
                    <div class="stat-label">Історичних фотографій</div>
                </div>
                <div class="stat-item fade-in-up delay-2">
                    <div class="stat-number" data-target="20">0</div>
                    <div class="stat-label">Книг та досліджень</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ═══ AERIAL MAPS SECTION ═══ -->
    <section id="aerialSection">
    <style>
    /* ── AERIAL SECTION ──────────────────────────────── */
    #aerialSection {
        padding: 5rem 0;
        background: #faf7f2;
        border-top: 1px solid #e8e0d4;
    }
    [data-theme="dark"] #aerialSection { background:#0e0c0a; border-color:#1e1b18; }
    #aerialSection *, #aerialSection *::before, #aerialSection *::after { box-sizing:border-box; }
    .aer-wrap { max-width:1200px; margin:0 auto; padding:0 2rem; }

    /* Header */
    .aer-head { text-align:center; margin-bottom:3rem; }
    .aer-title {
        font-family:'Cormorant Garamond',Georgia,serif;
        font-size:clamp(1.9rem,3.2vw,2.6rem); font-weight:500;
        color:#1c1917; margin:0 0 0.5rem; letter-spacing:0.01em;
    }
    [data-theme="dark"] .aer-title { color:#f0e6c8; }
    .aer-title-line {
        display:block; width:44px; height:2px;
        background:linear-gradient(90deg,#c9a227,#e0bd5a);
        margin:0.6rem auto 0; border-radius:2px;
    }
    .aer-sub {
        font-family:'DM Sans',sans-serif; font-size:0.78rem;
        letter-spacing:0.13em; text-transform:uppercase;
        color:#a09080; margin:0.6rem 0 0;
    }

    /* Each aerial map block */
    .aer-block { margin-bottom:4rem; }
    .aer-block:last-child { margin-bottom:0; }
    .aer-block-title {
        font-family:'Cormorant Garamond',serif;
        font-size:1.3rem; font-weight:600; color:#1c1917;
        margin:0 0 1.2rem;
        display:flex; align-items:center; gap:0.8rem;
    }
    [data-theme="dark"] .aer-block-title { color:#e8d8b8; }
    .aer-block-title::before {
        content:''; display:inline-block; width:4px; height:22px;
        background:#c9a227; border-radius:2px; flex-shrink:0;
    }

    .aer-grid {
        display:grid;
        grid-template-columns:1fr 248px;
        gap:1.5rem; align-items:start;
    }
    @media(max-width:820px){ .aer-grid{grid-template-columns:1fr;} }

    /* ── MAP CONTAINER ── */
    .aer-map {
        position:relative; border-radius:12px;
        overflow:hidden;
        box-shadow:0 2px 4px rgba(0,0,0,.06),
                   0 8px 24px rgba(0,0,0,.10),
                   0 20px 48px rgba(0,0,0,.09);
        background:#0a0a0a; line-height:0;
        border:1px solid rgba(201,162,39,0.12);
        cursor:grab;
    }
    .aer-map:active { cursor:grabbing; }
    .aer-img {
        width:100%; height:auto; display:block;
        filter:sepia(0.07) contrast(1.05);
        pointer-events:none; user-select:none;
        transform-origin:0 0;
        transition:transform 0.05s linear;
        will-change:transform;
    }
    .aer-svg {
        position:absolute; top:0; left:0;
        width:100%; height:100%;
        pointer-events:none;
    }
    .aer-svg .aer-marker-g { pointer-events:all; }

    /* Zoom controls */
    .aer-zoom-btns {
        position:absolute; bottom:12px; left:12px;
        display:flex; flex-direction:column; gap:4px; z-index:10;
    }
    .aer-zb {
        width:32px; height:32px;
        background:rgba(8,6,4,0.8); backdrop-filter:blur(8px);
        border:1px solid rgba(201,162,39,0.25); border-radius:7px;
        color:#c9a227; font-size:1.1rem; font-weight:700;
        cursor:pointer; display:flex; align-items:center; justify-content:center;
        transition:background .15s, color .15s;
        font-family:monospace; line-height:1;
    }
    .aer-zb:hover { background:rgba(201,162,39,0.2); color:#f0c840; }

    /* Fullscreen btn */
    .aer-fs-btn {
        position:absolute; bottom:12px; right:12px; z-index:10;
        width:32px; height:32px;
        background:rgba(8,6,4,0.8); backdrop-filter:blur(8px);
        border:1px solid rgba(201,162,39,0.25); border-radius:7px;
        color:#c9a227; font-size:0.85rem;
        cursor:pointer; display:flex; align-items:center; justify-content:center;
        transition:background .15s; border:1px solid rgba(201,162,39,0.25);
    }
    .aer-fs-btn:hover { background:rgba(201,162,39,0.2); }

    /* Date badge */
    .aer-badge {
        position:absolute; top:12px; right:12px; z-index:5;
        background:rgba(8,6,4,0.82); backdrop-filter:blur(10px);
        border:1px solid rgba(201,162,39,0.28); border-radius:8px;
        padding:5px 11px; pointer-events:none; line-height:1.3;
    }
    .aer-badge-lbl {
        display:block; font-family:'DM Sans',sans-serif;
        font-size:0.52rem; letter-spacing:0.16em;
        text-transform:uppercase; color:#6b5a3e;
    }
    .aer-badge-date {
        display:block; font-family:'DM Sans',sans-serif;
        font-size:0.82rem; color:#c9a227;
        letter-spacing:0.04em; font-weight:600;
    }

    /* ── PINS ── */
    .aer-pin-ring {
        fill:none; stroke:rgba(201,162,39,0.4); stroke-width:1.5;
        transform-box:fill-box; transform-origin:center;
        animation:aerRing 2.8s ease-out infinite;
    }
    @keyframes aerRing {
        0%  { r:11; opacity:.8; }
        65% { r:21; opacity:0; }
        100%{ r:11; opacity:0; }
    }
    .aer-pin-circle {
        fill:#c9a227; stroke:rgba(255,255,255,0.92); stroke-width:1.8;
        cursor:pointer;
        transition:fill .15s;
        filter:drop-shadow(0 2px 5px rgba(0,0,0,.55));
    }
    .aer-pin-circle:hover { fill:#f0c840; }
    .aer-pin-circle.aer-active { fill:#fff7d4; stroke:#fff; stroke-width:2.2; }
    .aer-pin-label {
        font-family:'DM Sans',sans-serif; font-size:9px; font-weight:800;
        fill:#1a1000; text-anchor:middle; dominant-baseline:central;
        pointer-events:none; user-select:none;
    }
    .aer-marker-g { cursor:pointer; }

    /* ── TOOLTIP inside map ── */
    .aer-tooltip {
        position:absolute; z-index:20;
        background:rgba(8,6,4,0.93); backdrop-filter:blur(14px);
        border:1px solid rgba(201,162,39,0.32); border-radius:10px;
        padding:10px 13px 11px; width:210px;
        pointer-events:auto;
        opacity:0; transform:translateY(5px) scale(0.97);
        transition:opacity .18s, transform .18s;
        box-shadow:0 8px 28px rgba(0,0,0,.5);
        display:none;
    }
    .aer-tooltip.show {
        opacity:1; transform:translateY(0) scale(1); display:block;
    }
    .tt-close-btn {
        position:absolute; top:6px; right:7px;
        width:17px; height:17px; border-radius:50%;
        background:rgba(255,255,255,0.08); border:none;
        color:#7a6a5a; cursor:pointer; font-size:0.65rem;
        display:flex; align-items:center; justify-content:center;
        transition:background .15s;
    }
    .tt-close-btn:hover { background:rgba(255,255,255,0.2); color:#fff; }
    .tt-row { display:flex; align-items:center; gap:7px; margin-bottom:4px; }
    .tt-num {
        flex-shrink:0; width:19px; height:19px; border-radius:50%;
        background:#c9a227; color:#1a1000;
        font-size:0.58rem; font-weight:800; font-family:'DM Sans',sans-serif;
        display:flex; align-items:center; justify-content:center;
    }
    .tt-name {
        font-family:'Cormorant Garamond',serif;
        font-size:0.9rem; font-weight:600; color:#f0e6c8; line-height:1.2;
    }
    .tt-info {
        font-family:'DM Sans',sans-serif;
        font-size:0.67rem; color:#9e9080; line-height:1.5; display:block;
    }

    /* ── LEGEND ── */
    .aer-legend {
        background:#fff; border:1px solid #e0d8cd; border-radius:12px;
        padding:1.2rem 1rem; position:sticky; top:90px;
        box-shadow:0 2px 4px rgba(0,0,0,.04),0 6px 18px rgba(0,0,0,.06);
    }
    [data-theme="dark"] .aer-legend { background:#161310; border-color:#2a2520; }
    .aer-leg-head {
        font-family:'Cormorant Garamond',serif; font-size:1rem;
        font-weight:600; color:#1c1917; margin:0 0 0.75rem;
        padding-bottom:0.6rem; border-bottom:1px solid #e0d8cd;
    }
    [data-theme="dark"] .aer-leg-head { color:#e0d4bc; border-color:#2a2520; }
    .aer-leg-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:2px; }
    .aer-leg-item {
        display:flex; align-items:center; gap:8px; padding:5px 7px;
        border-radius:6px; cursor:pointer;
        border:1px solid transparent;
        transition:background .14s;
        font-family:'DM Sans',sans-serif; font-size:0.72rem; color:#44403c;
    }
    [data-theme="dark"] .aer-leg-item { color:#a09080; }
    .aer-leg-item:hover { background:#f4efe7; }
    [data-theme="dark"] .aer-leg-item:hover { background:rgba(255,255,255,0.04); }
    .aer-leg-item.aer-active { background:#fdf5e0; border-color:rgba(201,162,39,0.45); }
    [data-theme="dark"] .aer-leg-item.aer-active { background:rgba(201,162,39,0.09); }
    .aer-leg-num {
        flex-shrink:0; width:20px; height:20px; border-radius:50%;
        background:#c9a227; color:#1a1000;
        font-size:0.58rem; font-weight:800; font-family:'DM Sans',sans-serif;
        display:flex; align-items:center; justify-content:center;
        transition:transform .13s;
    }
    .aer-leg-item:hover .aer-leg-num,
    .aer-leg-item.aer-active .aer-leg-num { transform:scale(1.1); }
    .aer-leg-hint {
        margin-top:0.75rem; font-size:0.63rem; color:#b0a898;
        font-family:'DM Sans',sans-serif; line-height:1.5; font-style:italic;
        border-top:1px solid #ede7db; padding-top:0.65rem;
    }
    [data-theme="dark"] .aer-leg-hint { color:#4e4540; border-color:#2a2520; }

    /* ── FULLSCREEN OVERLAY ── */
    .aer-fullscreen {
        position:fixed; inset:0; z-index:9999;
        background:rgba(5,4,3,0.96); backdrop-filter:blur(4px);
        display:flex; align-items:center; justify-content:center;
        opacity:0; pointer-events:none;
        transition:opacity .25s;
    }
    .aer-fullscreen.open { opacity:1; pointer-events:all; }
    .aer-fullscreen img {
        max-width:95vw; max-height:92vh;
        border-radius:8px; object-fit:contain;
    }
    .aer-fullscreen-close {
        position:absolute; top:16px; right:20px;
        background:rgba(255,255,255,0.12); border:none; border-radius:50%;
        width:38px; height:38px; color:#fff; font-size:1.2rem;
        cursor:pointer; display:flex; align-items:center; justify-content:center;
        transition:background .15s;
    }
    .aer-fullscreen-close:hover { background:rgba(255,255,255,0.25); }
    </style>

    <div class="aer-wrap">
        <div class="aer-head">
            <h2 class="aer-title">Аерофотознімки Дубровиці<span class="aer-title-line"></span></h2>
            <p class="aer-sub">Унікальні знімки міста часів Другої світової війни</p>
        </div>

        <!-- ════ MAP 1: 1944 ════ -->
        <div class="aer-block" id="aerBlock1944">
            <p class="aer-block-title">Аерофотознімок 24 січня 1944 року</p>
            <div class="aer-grid">
                <div class="aer-map" id="aerMap1944">
                    <img class="aer-img" id="aerImg1944"
                         src="https://i.imgur.com/dyP4WgZ.jpeg"
                         alt="Аерофотознімок Дубровиці 24 січня 1944">
                    <svg class="aer-svg" viewBox="0 0 1200 951"
                         xmlns="http://www.w3.org/2000/svg" id="aerSVG1944">
                        <!-- 1 — Давнє городище -->
                        <g class="aer-marker-g" data-id="1" data-title="Давнє городище" data-desc="Колись тут стояв замок Дубровицьких князів, зруйнований татарами у XIII ст.">
                            <circle class="aer-pin-ring" cx="648" cy="608" r="11"/>
                            <circle class="aer-pin-circle" cx="648" cy="608" r="9.5"/>
                            <text class="aer-pin-label" x="648" y="608">1</text>
                        </g>
                        <!-- 2 — Святомиколаївська церква -->
                        <g class="aer-marker-g" data-id="2" data-title="Святомиколаївська церква" data-desc="Православна церква Святого Миколая — одна з найстаріших парафій Дубровиці." style="animation-delay:.6s">
                            <circle class="aer-pin-ring" cx="660" cy="732" r="11" style="animation-delay:.6s"/>
                            <circle class="aer-pin-circle" cx="660" cy="732" r="9.5"/>
                            <text class="aer-pin-label" x="660" y="732">2</text>
                        </g>
                        <!-- 3 — Костел Іоанна Хрестителя -->
                        <g class="aer-marker-g" data-id="3" data-title="Костел Іоанна Хрестителя" data-desc="Збудований у 1695–1702 рр. орденом піярів. Унікальна пам'ятка барокової архітектури Полісся.">
                            <circle class="aer-pin-ring" cx="720" cy="475" r="11" style="animation-delay:1.1s"/>
                            <circle class="aer-pin-circle" cx="720" cy="475" r="9.5"/>
                            <text class="aer-pin-label" x="720" y="475">3</text>
                        </g>
                        <!-- 4 — Кам'яна церква -->
                        <g class="aer-marker-g" data-id="4" data-title="Кам'яна церква" data-desc="Мурована православна церква — помітний орієнтир у тогочасній забудові міста.">
                            <circle class="aer-pin-ring" cx="528" cy="295" r="11" style="animation-delay:.3s"/>
                            <circle class="aer-pin-circle" cx="528" cy="295" r="9.5"/>
                            <text class="aer-pin-label" x="528" y="295">4</text>
                        </g>
                        <!-- 5 — Синагога -->
                        <g class="aer-marker-g" data-id="5" data-title="Синагога" data-desc="Єврейська громада була значною частиною Дубровиці аж до Голокосту 1942 року.">
                            <circle class="aer-pin-ring" cx="540" cy="599" r="11" style="animation-delay:.9s"/>
                            <circle class="aer-pin-circle" cx="540" cy="599" r="9.5"/>
                            <text class="aer-pin-label" x="540" y="599">5</text>
                        </g>
                        <!-- 6 — Нове русло Горині -->
                        <g class="aer-marker-g" data-id="6" data-title="Нове русло Горині" data-desc="Сьогодні тут протікає основне русло річки Горинь — воно змінилося після 1944 р.">
                            <circle class="aer-pin-ring" cx="1056" cy="561" r="11" style="animation-delay:1.4s"/>
                            <circle class="aer-pin-circle" cx="1056" cy="561" r="9.5"/>
                            <text class="aer-pin-label" x="1056" y="561">6</text>
                        </g>
                        <!-- 7 — Стара Горинь -->
                        <g class="aer-marker-g" data-id="7" data-title="Стара Горинь (1944)" data-desc="На момент зйомки — повноцінне русло річки Горинь, яке пізніше обміліло.">
                            <circle class="aer-pin-ring" cx="924" cy="532" r="11" style="animation-delay:.5s"/>
                            <circle class="aer-pin-circle" cx="924" cy="532" r="9.5"/>
                            <text class="aer-pin-label" x="924" y="532">7</text>
                        </g>
                        <!-- 8 — Єврейське кладовище -->
                        <g class="aer-marker-g" data-id="8" data-title="Єврейське кладовище" data-desc="Старе єврейське кладовище на північній околиці міста — пам'ятник трагічній долі громади.">
                            <circle class="aer-pin-ring" cx="396" cy="114" r="11" style="animation-delay:1.2s"/>
                            <circle class="aer-pin-circle" cx="396" cy="114" r="9.5"/>
                            <text class="aer-pin-label" x="396" y="114">8</text>
                        </g>
                        <!-- 9 — Центральна площа -->
                        <g class="aer-marker-g" data-id="9" data-title="Центральна площа" data-desc="Ринкова площа — серце міського життя Дубровиці протягом багатьох століть.">
                            <circle class="aer-pin-ring" cx="600" cy="504" r="11" style="animation-delay:.7s"/>
                            <circle class="aer-pin-circle" cx="600" cy="504" r="9.5"/>
                            <text class="aer-pin-label" x="600" y="504">9</text>
                        </g>
                    </svg>

                    <div class="aer-tooltip" id="aerTT1944">
                        <button class="tt-close-btn" aria-label="Закрити">&#x2715;</button>
                        <div class="tt-row">
                            <span class="tt-num" id="aerTN1944"></span>
                            <span class="tt-name" id="aerTTT1944"></span>
                        </div>
                        <span class="tt-info" id="aerTD1944"></span>
                    </div>

                    <div class="aer-zoom-btns">
                        <button class="aer-zb" data-map="1944" data-dir="+">+</button>
                        <button class="aer-zb" data-map="1944" data-dir="-">−</button>
                        <button class="aer-zb" data-map="1944" data-dir="r" title="Скинути" style="font-size:0.8rem;">⌂</button>
                    </div>
                    <button class="aer-fs-btn" data-src="https://i.imgur.com/dyP4WgZ.jpeg" title="На весь екран">⛶</button>
                    <div class="aer-badge">
                        <span class="aer-badge-lbl">Аерофотознімок</span>
                        <span class="aer-badge-date">24 Jan 1944</span>
                    </div>
                </div>
                <div class="aer-legend">
                    <p class="aer-leg-head">Позначення</p>
                    <ul class="aer-leg-list" id="aerLeg1944">
                        <li class="aer-leg-item" data-leg="1"><span class="aer-leg-num">1</span>Давнє городище (замок)</li>
                        <li class="aer-leg-item" data-leg="2"><span class="aer-leg-num">2</span>Святомиколаївська церква</li>
                        <li class="aer-leg-item" data-leg="3"><span class="aer-leg-num">3</span>Костел Іоанна Хрестителя</li>
                        <li class="aer-leg-item" data-leg="4"><span class="aer-leg-num">4</span>Кам'яна церква</li>
                        <li class="aer-leg-item" data-leg="5"><span class="aer-leg-num">5</span>Синагога</li>
                        <li class="aer-leg-item" data-leg="6"><span class="aer-leg-num">6</span>Нове русло Горині</li>
                        <li class="aer-leg-item" data-leg="7"><span class="aer-leg-num">7</span>Стара Горинь (1944)</li>
                        <li class="aer-leg-item" data-leg="8"><span class="aer-leg-num">8</span>Єврейське кладовище</li>
                        <li class="aer-leg-item" data-leg="9"><span class="aer-leg-num">9</span>Центральна площа</li>
                    </ul>
                    <p class="aer-leg-hint">Натисніть маркер або пункт у списку · Scroll для збільшення</p>
                </div>
            </div>
        </div>

        <!-- ════ MAP 2: 1943 ════ -->
        <div class="aer-block" id="aerBlock1943" style="border-top:1px solid #e8e0d4;padding-top:3.5rem;margin-top:1rem;">
            <p class="aer-block-title">Аерофотознімок жовтень 1943 року</p>
            <div class="aer-grid">
                <div class="aer-map" id="aerMap1943">
                    <img class="aer-img" id="aerImg1943"
                         src="https://i.imgur.com/EhsjkKX.jpeg"
                         alt="Аерофотознімок Дубровиці жовтень 1943">
                    <svg class="aer-svg" viewBox="0 0 1200 1200"
                         xmlns="http://www.w3.org/2000/svg" id="aerSVG1943">
                        <!-- Empty — pins can be added via admin panel -->
                    </svg>

                    <div class="aer-tooltip" id="aerTT1943">
                        <button class="tt-close-btn" aria-label="Закрити">&#x2715;</button>
                        <div class="tt-row">
                            <span class="tt-num" id="aerTN1943"></span>
                            <span class="tt-name" id="aerTTT1943"></span>
                        </div>
                        <span class="tt-info" id="aerTD1943"></span>
                    </div>

                    <div class="aer-zoom-btns">
                        <button class="aer-zb" data-map="1943" data-dir="+">+</button>
                        <button class="aer-zb" data-map="1943" data-dir="-">−</button>
                        <button class="aer-zb" data-map="1943" data-dir="r" style="font-size:0.8rem;">⌂</button>
                    </div>
                    <button class="aer-fs-btn" data-src="https://i.imgur.com/EhsjkKX.jpeg" title="На весь екран">⛶</button>
                    <div class="aer-badge">
                        <span class="aer-badge-lbl">Аерофотознімок</span>
                        <span class="aer-badge-date">Oct 1943</span>
                    </div>
                </div>
                <div class="aer-legend">
                    <p class="aer-leg-head">Позначення</p>
                    <ul class="aer-leg-list" id="aerLeg1943">
                        <!-- Dynamically loaded from aerial_pins_1943.json -->
                    </ul>
                    <p class="aer-leg-hint" id="aerHint1943">Позначень ще не додано. Використайте адмін-панель → Редактор карт.</p>
                </div>
            </div>
        </div>

    </div><!-- /aer-wrap -->

    <!-- Fullscreen overlay -->
    <div class="aer-fullscreen" id="aerFS">
        <button class="aer-fullscreen-close" id="aerFSClose">&#x2715;</button>
        <img id="aerFSImg" src="" alt="">
    </div>

    <script>
    (function(){
    // ── CONFIG ──────────────────────────────────────────────────────
    var MAPS = {
        '1944': {
            mapEl:   document.getElementById('aerMap1944'),
            svgEl:   document.getElementById('aerSVG1944'),
            imgEl:   document.getElementById('aerImg1944'),
            ttEl:    document.getElementById('aerTT1944'),
            ttNum:   document.getElementById('aerTN1944'),
            ttTitle: document.getElementById('aerTTT1944'),
            ttDesc:  document.getElementById('aerTD1944'),
            legEl:   document.getElementById('aerLeg1944'),
            scale:1, ox:0, oy:0, dragging:false, sx:0, sy:0, lx:0, ly:0, activeId:null
        },
        '1943': {
            mapEl:   document.getElementById('aerMap1943'),
            svgEl:   document.getElementById('aerSVG1943'),
            imgEl:   document.getElementById('aerImg1943'),
            ttEl:    document.getElementById('aerTT1943'),
            ttNum:   document.getElementById('aerTN1943'),
            ttTitle: document.getElementById('aerTTT1943'),
            ttDesc:  document.getElementById('aerTD1943'),
            legEl:   document.getElementById('aerLeg1943'),
            scale:1, ox:0, oy:0, dragging:false, sx:0, sy:0, lx:0, ly:0, activeId:null
        }
    };

    // ── TRANSFORM (pan & zoom) ─────────────────────────────────────
    function applyT(m, animate) {
        var rect = m.mapEl.getBoundingClientRect();
        var maxX = rect.width  * (m.scale-1) / 2;
        var maxY = rect.height * (m.scale-1) / 2;
        m.ox = Math.min(maxX, Math.max(-maxX, m.ox));
        m.oy = Math.min(maxY, Math.max(-maxY, m.oy));
        var tr = 'translate('+m.ox+'px,'+m.oy+'px) scale('+m.scale+')';
        m.imgEl.style.transition = animate ? 'transform 0.3s ease' : '';
        m.imgEl.style.transform = tr;
        m.svgEl.style.transition = m.imgEl.style.transition;
        m.svgEl.style.transform  = tr;
    }

    function zoom(m, delta, cx, cy) {
        var rect = m.mapEl.getBoundingClientRect();
        var old  = m.scale;
        m.scale  = Math.min(5, Math.max(1, m.scale + delta));
        if (m.scale === old) return;
        var mx = (cx || rect.left + rect.width/2)  - rect.left - rect.width/2;
        var my = (cy || rect.top  + rect.height/2) - rect.top  - rect.height/2;
        m.ox += mx * (1 - m.scale/old);
        m.oy += my * (1 - m.scale/old);
        applyT(m, true);
    }

    // ── TOOLTIP ───────────────────────────────────────────────────
    function showTT(m, id, title, desc, svgCX, svgCY) {
        m.activeId = id;
        m.ttNum.textContent   = id;
        m.ttTitle.textContent = title;
        m.ttDesc.textContent  = desc;

        // position: convert SVG viewbox → pixel coords inside map
        var vb   = m.svgEl.viewBox.baseVal;
        var rect = m.mapEl.getBoundingClientRect();
        var scX  = rect.width  / vb.width  * m.scale;
        var scY  = rect.height / vb.height * m.scale;
        var px   = svgCX * scX + m.ox + rect.width/2  * (1 - m.scale) + rect.width*(m.scale-1)/2;
        var py   = svgCY * scY + m.oy + rect.height/2 * (1 - m.scale) + rect.height*(m.scale-1)/2;
        // simpler: just use percentage position
        var pctX = svgCX / vb.width;
        var pctY = svgCY / vb.height;
        var leftPx = pctX * rect.width;
        var topPx  = pctY * rect.height;

        var ttW = 210, ttH = 95, mapW = rect.width, mapH = rect.height;
        var left = leftPx + 14;
        var top  = topPx  - ttH/2;
        if (left + ttW > mapW - 8) left = leftPx - ttW - 14;
        if (left < 6) left = 6;
        if (top  < 6) top  = 6;
        if (top + ttH > mapH - 6) top = mapH - ttH - 6;

        m.ttEl.style.left = left + 'px';
        m.ttEl.style.top  = top  + 'px';
        m.ttEl.style.display = 'block';
        // force reflow for animation
        m.ttEl.offsetHeight;
        m.ttEl.classList.add('show');
    }

    function hideTT(m) {
        m.activeId = null;
        m.ttEl.classList.remove('show');
        setTimeout(function(){ m.ttEl.style.display='none'; }, 180);
        m.svgEl.querySelectorAll('.aer-pin-circle').forEach(function(c){ c.classList.remove('aer-active'); });
        if (m.legEl) m.legEl.querySelectorAll('.aer-leg-item').forEach(function(l){ l.classList.remove('aer-active'); });
    }

    function activatePin(m, id) {
        hideTT(m);
        var g = m.svgEl.querySelector('.aer-marker-g[data-id="'+id+'"]');
        if (!g) return;
        g.querySelector('.aer-pin-circle').classList.add('aer-active');
        if (m.legEl) {
            var li = m.legEl.querySelector('.aer-leg-item[data-leg="'+id+'"]');
            if (li) li.classList.add('aer-active');
        }
        var ring = g.querySelector('.aer-pin-ring');
        showTT(m, id, g.dataset.title, g.dataset.desc,
               parseFloat(ring.getAttribute('cx')),
               parseFloat(ring.getAttribute('cy')));
    }

    // ── INIT EACH MAP ─────────────────────────────────────────────
    Object.keys(MAPS).forEach(function(key){
        var m = MAPS[key];
        if (!m.mapEl) return;

        // Wheel zoom
        m.mapEl.addEventListener('wheel', function(e){
            e.preventDefault();
            zoom(m, e.deltaY < 0 ? 0.35 : -0.35, e.clientX, e.clientY);
        }, {passive:false});

        // Zoom buttons
        m.mapEl.querySelectorAll('.aer-zb[data-map="'+key+'"]').forEach(function(btn){
            btn.addEventListener('click', function(e){
                e.stopPropagation();
                if (btn.dataset.dir==='+') zoom(m, 0.5);
                else if (btn.dataset.dir==='-') zoom(m, -0.5);
                else { m.scale=1; m.ox=0; m.oy=0; applyT(m,true); }
            });
        });

        // Drag
        m.mapEl.addEventListener('mousedown', function(e){
            if (e.button!==0) return;
            m.dragging=true; m.sx=e.clientX-m.lx; m.sy=e.clientY-m.ly;
        });
        document.addEventListener('mousemove', function(e){
            if (!m.dragging) return;
            m.lx=e.clientX-m.sx; m.ly=e.clientY-m.sy;
            m.ox=m.lx; m.oy=m.ly; applyT(m,false);
        });
        document.addEventListener('mouseup', function(){
            if (m.dragging){ m.dragging=false; m.lx=m.ox; m.ly=m.oy; }
        });

        // Touch
        var lt=0;
        m.mapEl.addEventListener('touchstart', function(e){
            if (e.touches.length===1){
                m.dragging=true;
                m.sx=e.touches[0].clientX-m.lx;
                m.sy=e.touches[0].clientY-m.ly;
            } else if (e.touches.length===2) {
                m.dragging=false;
                lt=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,
                              e.touches[0].clientY-e.touches[1].clientY);
            }
        },{passive:true});
        m.mapEl.addEventListener('touchmove', function(e){
            e.preventDefault();
            if (e.touches.length===1 && m.dragging){
                m.lx=e.touches[0].clientX-m.sx;
                m.ly=e.touches[0].clientY-m.sy;
                m.ox=m.lx; m.oy=m.ly; applyT(m,false);
            } else if (e.touches.length===2){
                var d=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,
                                 e.touches[0].clientY-e.touches[1].clientY);
                zoom(m,(d-lt)*0.008); lt=d;
            }
        },{passive:false});
        m.mapEl.addEventListener('touchend', function(){
            m.dragging=false; m.lx=m.ox; m.ly=m.oy;
        });

        // Marker clicks
        m.svgEl.querySelectorAll('.aer-marker-g').forEach(function(g){
            g.addEventListener('click', function(e){
                e.stopPropagation();
                if (m.activeId === g.dataset.id) { hideTT(m); return; }
                activatePin(m, g.dataset.id);
            });
        });

        // Legend clicks
        if (m.legEl) {
            m.legEl.querySelectorAll('.aer-leg-item').forEach(function(li){
                li.addEventListener('click', function(e){
                    e.stopPropagation();
                    if (m.activeId===li.dataset.leg){ hideTT(m); return; }
                    activatePin(m, li.dataset.leg);
                });
            });
        }

        // Tooltip close button
        var closeBtn = m.ttEl.querySelector('.tt-close-btn');
        if (closeBtn) closeBtn.addEventListener('click', function(e){
            e.stopPropagation(); hideTT(m);
        });

        // Click outside
        m.mapEl.addEventListener('click', function(e){
            if (!e.target.closest('.aer-marker-g') && !e.target.closest('.aer-tooltip'))
                hideTT(m);
        });
    });

    // ── FULLSCREEN ────────────────────────────────────────────────
    var fsEl    = document.getElementById('aerFS');
    var fsImg   = document.getElementById('aerFSImg');
    var fsClose = document.getElementById('aerFSClose');
    document.querySelectorAll('.aer-fs-btn').forEach(function(btn){
        btn.addEventListener('click', function(e){
            e.stopPropagation();
            fsImg.src = btn.dataset.src;
            fsEl.classList.add('open');
        });
    });
    fsClose.addEventListener('click', function(){ fsEl.classList.remove('open'); });
    fsEl.addEventListener('click', function(e){ if(e.target===fsEl) fsEl.classList.remove('open'); });
    document.addEventListener('keydown', function(e){ if(e.key==='Escape') fsEl.classList.remove('open'); });

    // ── LOAD 1943 PINS from GitHub ────────────────────────────────
    var GITHUB_RAW = 'https://raw.githubusercontent.com/jerkinsmichael13-stack/Dubrovytsia1/main/';
    (function loadPins1943(){
        fetch(GITHUB_RAW + 'aerial_pins_1943.json?v=' + Date.now())
            .then(function(r){ return r.ok ? r.json() : []; })
            .then(function(pins){
                if (!pins || !pins.length) return;
                var m = MAPS['1943'];
                var hint = document.getElementById('aerHint1943');
                if (hint) hint.style.display = 'none';
                pins.forEach(function(pin){
                    // Add SVG marker
                    var ns = 'http://www.w3.org/2000/svg';
                    var g = document.createElementNS(ns,'g');
                    g.setAttribute('class','aer-marker-g');
                    g.setAttribute('data-id', String(pin.id));
                    g.setAttribute('data-title', pin.title);
                    g.setAttribute('data-desc',  pin.desc||'');
                    var ring = document.createElementNS(ns,'circle');
                    ring.setAttribute('class','aer-pin-ring');
                    ring.setAttribute('cx', pin.cx); ring.setAttribute('cy', pin.cy);
                    ring.setAttribute('r','11');
                    var circ = document.createElementNS(ns,'circle');
                    circ.setAttribute('class','aer-pin-circle');
                    circ.setAttribute('cx', pin.cx); circ.setAttribute('cy', pin.cy);
                    circ.setAttribute('r','9.5');
                    var txt = document.createElementNS(ns,'text');
                    txt.setAttribute('class','aer-pin-label');
                    txt.setAttribute('x', pin.cx); txt.setAttribute('y', pin.cy);
                    txt.textContent = String(pin.id);
                    g.appendChild(ring); g.appendChild(circ); g.appendChild(txt);
                    m.svgEl.appendChild(g);
                    // click handler
                    g.addEventListener('click', function(e){
                        e.stopPropagation();
                        if (m.activeId===String(pin.id)){ hideTT(m); return; }
                        activatePin(m, String(pin.id));
                    });
                    // Add legend item
                    var li = document.createElement('li');
                    li.className = 'aer-leg-item';
                    li.setAttribute('data-leg', String(pin.id));
                    li.innerHTML = '<span class="aer-leg-num">'+pin.id+'</span>'+pin.title;
                    m.legEl.appendChild(li);
                    li.addEventListener('click', function(e){
                        e.stopPropagation();
                        if (m.activeId===String(pin.id)){ hideTT(m); return; }
                        activatePin(m, String(pin.id));
                    });
                });
            })
            .catch(function(){});
    })();

    })();
    </script>
    </section>
    <!-- ═══ END AERIAL MAPS ═══ -->

    
        <!-- Timeline Preview -->
    <section class="timeline-section">
        <div class="container">
            <h2 class="section-title fade-in-up">Ключові моменти історії</h2>
            <div class="timeline">
                <div class="timeline-item fade-in-up">
                    <div class="timeline-year">1005</div>
                    <div class="timeline-content">
                        <h3>Перша згадка</h3>
                        <p>Володимир Великий засновує єпископську кафедру в Турові, Дубровиця згадується серед міст єпархії</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-1">
                    <div class="timeline-year">XII ст.</div>
                    <div class="timeline-content">
                        <h3>Столиця князівства</h3>
                        <p>Дубровиця стає центром окремого удільного князівства</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-2">
                    <div class="timeline-year">1695-1702</div>
                    <div class="timeline-content">
                        <h3>Костел Іоана Хрестителя</h3>
                        <p>Спорудження костелу та колегіуму ордена піярів</p>
                    </div>
                </div>
                <div class="timeline-item fade-in-up delay-3">
                    <div class="timeline-year">1940</div>
                    <div class="timeline-content">
                        <h3>Статус міста</h3>
                        <p>Дубровиця офіційно стає містом та районним центром</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="footer-title">Дубровиця</h4>
                    <p class="footer-text">
                        Цифровий архів історичної спадщини селища міського типу Дубровиця, 
                        Сарненський район, Рівненська область, Україна.
                    </p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Навігація</h4>
                    <nav class="footer-nav">
                        <a href="history.html">Історія</a>
                        <a href="photo-archive.html">Фотоархів</a>
                        <a href="metrychni-knyhy.html">Метричні книги</a>
                        <a href="books.html">Книги</a>
                    </nav>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Контакти</h4>
                    <p class="footer-text">
                        Маєте матеріали або пропозиції?<br>
                        <a href="contacts.html" class="footer-link">Зв'яжіться з нами</a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Дубровиця. Цифровий архів.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>
