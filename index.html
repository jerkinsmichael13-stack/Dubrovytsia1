<!DOCTYPE html>
<html lang="uk" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Цифровий архів найдавнішого міста Рівненщини - Дубровиці. Історія від 1005 року, фотоархів, метричні книги">
    <meta name="keywords" content="Дубровиця, історія, архів, Рівненська область, Україна, Полісся">
    <meta property="og:title" content="Дубровиця — Найдавніше місто Рівненщини">
    <meta property="og:description" content="Цифровий архів історичної спадщини міста Дубровиця">
    <meta property="og:type" content="website">
    <title>Дубровиця — Історія та спадщина</title>
    <script>!function(){var t=localStorage.getItem('theme')||'light';document.documentElement.setAttribute('data-theme',t)}()</script>
    <link rel="preload" as="image" href="https://i.imgur.com/FfgAmadh.jpeg">
    <link rel="preload" as="image" href="https://i.imgur.com/cMQeU7Ph.jpeg">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">


<style>
/* ════════════════════════════════════════════════════
   LIGHT THEME OVERRIDES + MOBILE FIXES
   Applied on top of section-specific dark styles.
   Does NOT touch dark theme (data-theme="dark").
════════════════════════════════════════════════════ */

/* ── Aerial section (#AER) — already supports themes, minor mobile ── */
@media (max-width: 480px) {
    .AW { padding: 0 1rem; }
    .AT { font-size: 1.6rem; }
    .ABT { font-size: 1.05rem; }
    .LEG { display: none; } /* legend hidden on very small, pins have tooltips */
    .MBOX { max-height: 60vw; }
}

/* ── Comparison section (#CMP) — light theme ── */
:root:not([data-theme="dark"]) #CMP {
    background: #f4efe7;
}
:root:not([data-theme="dark"]) #CMP::before {
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(201,162,39,.06) 0%, transparent 70%);
}
:root:not([data-theme="dark"]) .CT {
    color: #1c1917;
}
:root:not([data-theme="dark"]) .CT em { color: #c9a227; }
:root:not([data-theme="dark"]) .CS {
    color: rgba(28,25,23,.4);
}
:root:not([data-theme="dark"]) .CYB .cy {
    background: linear-gradient(135deg, #a8841c, #c9a227);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
:root:not([data-theme="dark"]) .CYB.yr .cy {
    background: linear-gradient(135deg, #2d6daa, #4a9ad4);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
:root:not([data-theme="dark"]) .CYB .cl,
:root:not([data-theme="dark"]) .CYB .cd { color: rgba(28,25,23,.4); }
:root:not([data-theme="dark"]) .CYD { color: rgba(201,162,39,.4); }
:root:not([data-theme="dark"]) .COT { color: #1c1917; }
:root:not([data-theme="dark"]) .COD { color: rgba(44,40,36,.65); }
:root:not([data-theme="dark"]) .CE span { color: #b8902a; }
:root:not([data-theme="dark"]) .CE::before,
:root:not([data-theme="dark"]) .CE::after {
    background: linear-gradient(90deg, transparent, rgba(180,140,30,.4));
}

/* Mobile — CMP */
@media (max-width: 640px) {
    .CW { padding: 0 1rem; }
    .CT { font-size: 1.7rem !important; }
    .CYR { grid-template-columns: 1fr auto 1fr; gap: .6rem; }
    .CYB .cy { font-size: 2rem; }
    .CYB .cl { font-size: .55rem; }
    .CYD { font-size: 1rem; }
}

/* ── Plater section (#PLTR) — light theme ── */
:root:not([data-theme="dark"]) #PLTR {
    background: #ede7db;
}
:root:not([data-theme="dark"]) #PLTR::before {
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(201,162,39,.05) 0%, transparent 70%);
}
:root:not([data-theme="dark"]) .PH .CT { color: #1c1917; }
:root:not([data-theme="dark"]) .PT { color: #1c1917; }
:root:not([data-theme="dark"]) .PT em { color: #a8701a; }
:root:not([data-theme="dark"]) .PSB { color: rgba(28,25,23,.4); }
:root:not([data-theme="dark"]) .PYR .cy {
    background: linear-gradient(135deg, #a8841c, #c9a227);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
/* Plater fact cards — light theme */
:root:not([data-theme="dark"]) .POT { color: #1c1917; }
:root:not([data-theme="dark"]) .POD { color: rgba(44,40,36,.65); }
:root:not([data-theme="dark"]) .PGLH { color: #2c1f06; }
:root:not([data-theme="dark"]) .PGLH::after { background: rgba(0,0,0,.1); }

/* Mobile — PLTR */
@media (max-width: 640px) {
    .PW { padding: 0 1rem; }
}

/* ── Wide/Region comparison — light ── */
:root:not([data-theme="dark"]) #WM,
:root:not([data-theme="dark"]) #WMAP {
    background: #f4efe7;
}
:root:not([data-theme="dark"]) .WT { color: #1c1917; }
:root:not([data-theme="dark"]) .WS { color: rgba(28,25,23,.4); }
:root:not([data-theme="dark"]) .WOT { color: #1c1917; }
:root:not([data-theme="dark"]) .WOD { color: rgba(44,40,36,.65); }

/* Mobile — WM */
@media (max-width: 640px) {
    .WW { padding: 0 1rem; }
    .WT { font-size: 1.7rem !important; }
    .WOB { padding: 1.6rem 1.2rem; }
    .COB { padding: 1.6rem 1.2rem; }
    .POB { padding: 1.6rem 1.2rem; }
}

/* ── Universal mobile text readability ── */
@media (max-width: 480px) {
    .COD, .WOD, .POD { font-size: .8rem !important; line-height: 1.75 !important; }
    .COI, .POI, .WOI { font-size: 1.6rem; }
    .COT, .WOT, .POT { font-size: 1.1rem !important; }
    /* Prevent overflow on narrow screens */
    .COBS, .WOBS, .POBS { gap: 0; }
}
</style>
    <link rel="stylesheet" href="style_premium.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="https://i.imgur.com/mXCrjjG.png" alt="Герб" class="logo-img" loading="lazy">
                <div class="logo-text">
                    <span class="logo-city">Дубровиця</span>
                    <span class="logo-subtitle">Цифровий архів</span>
                </div>
            </a>
            
            <nav class="nav" id="mainNav">
                <a href="index.html" class="nav-link active">Головна</a>
                <a href="history.html" class="nav-link">Історія</a>
                <a href="photo-archive.html" class="nav-link">Фотоархів</a>
                <a href="architecture.html" class="nav-link">Пам'ятки</a>
                <a href="metrychni-knyhy.html" class="nav-link">Метричні книги</a>
                <a href="books.html" class="nav-link">Книги</a>
                <a href="contacts.html" class="nav-link">Контакти</a>
            </nav>

            <button class="theme-toggle" id="themeToggle" aria-label="Перемкнути тему">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>

            <button class="mobile-toggle" id="mobileToggle" aria-label="Відкрити меню">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Hero Section with Video Background -->
    <section class="hero">
        <div class="hero-bg">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    Дубровиця
                </h1>
                <p class="hero-subtitle">
                    Найдавніше місто Рівненщини з 1015-річною історією
                </p>
                <div class="hero-meta">
                    <span>Рівненська область</span>
                    <span class="separator">·</span>
                    <span>Полісся</span>
                    <span class="separator">·</span>
                    <span>Україна</span>
                </div>
            </div>
            <div class="hero-scroll fade-in-up delay-3">
                <span class="scroll-text">Прокрутіть</span>
                <div class="scroll-line"></div>
            </div>
        </div>
    </section>

    <!-- Introduction -->
    <section class="intro-section">
        <div class="container">
            <div class="intro-content">
                <p class="intro-lead fade-in-up">
                    Дубровиця — найдавніше місто Рівненської області, перша писемна згадка про яке датується 1005 роком. 
                    Місто розташоване на мальовничих берегах річки Горинь у серці Волинського Полісся.
                </p>
                <p class="intro-text fade-in-up delay-1">
                    Цей цифровий архів створено для збереження, систематизації та популяризації історичної спадщини, 
                    культури та пам'яті нашого міста. Тут ви знайдете історичні фотографії, метричні книги, дослідження 
                    та матеріали, які розкривають багатовікову історію Дубровиці.
                </p>
            </div>
        </div>
    </section>

    <!-- Navigation Cards -->
    <section class="cards-section">
        <div class="container">
            <div class="cards-grid">
                <a href="history.html" class="card fade-in-up">
                    <div class="card-image">
                        <img src="https://i.imgur.com/QTP89kg.jpeg" alt="Історія" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Історія міста</h3>
                        <p class="card-description">
                            Досліджуйте понад тисячолітню історію Дубровиці від першої згадки у 1005 році до сьогодення
                        </p>
                        <span class="card-link">Читати далі →</span>
                    </div>
                </a>

                <a href="photo-archive.html" class="card fade-in-up delay-1">
                    <div class="card-image">
                        <img src="https://i.imgur.com/qcjgN1I.jpeg" alt="Фотоархів" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Фотоархів</h3>
                        <p class="card-description">
                            Унікальна колекція історичних фотографій від кінця XIX століття до наших днів
                        </p>
                        <span class="card-link">Переглянути →</span>
                    </div>
                </a>

                <a href="metrychni-knyhy.html" class="card fade-in-up delay-2">
                    <div class="card-image">
                        <img src="https://i.imgur.com/WeDmtIY.jpeg" alt="Метричні книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Метричні книги</h3>
                        <p class="card-description">
                            Генеалогічні дослідження: метричні записи парафій Дубровицького регіону
                        </p>
                        <span class="card-link">Досліджуйте →</span>
                    </div>
                </a>

                <a href="books.html" class="card fade-in-up delay-3">
                    <div class="card-image">
                        <img src="https://i.imgur.com/SPhDh6n.jpeg" alt="Книги" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Книги про Дубровицю</h3>
                        <p class="card-description">
                            Бібліографія досліджень, спогадів та літератури про історію регіону
                        </p>
                        <span class="card-link">Читати →</span>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item fade-in-up">
                    <div class="stat-number" data-target="1015">0</div>
                    <div class="stat-label">Років історії</div>
                </div>
                <div class="stat-item fade-in-up delay-1">
                    <div class="stat-number" data-target="500">0</div>
                    <div class="stat-label">Історичних фотографій</div>
                </div>
                <div class="stat-item fade-in-up delay-2">
                    <div class="stat-number" data-target="20">0</div>
                    <div class="stat-label">Книг та досліджень</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ═══ AERIAL MAPS SECTION ═══ -->
    <section id="AER">
    <style>
    #AER{padding:5rem 0;background:#faf7f2;border-top:1px solid #e8e0d4;}
    [data-theme="dark"] #AER{background:#0e0c0a;border-color:#1e1b18;}
    #AER *{box-sizing:border-box;}
    .AW{max-width:1200px;margin:0 auto;padding:0 2rem;}
    .AH{text-align:center;margin-bottom:3rem;}
    .AT{font-family:'Cormorant Garamond',Georgia,serif;font-size:clamp(1.9rem,3.2vw,2.6rem);font-weight:500;color:#1c1917;margin:0 0 .5rem;}
    [data-theme="dark"] .AT{color:#f0e6c8;}
    .AL{display:block;width:44px;height:2px;background:linear-gradient(90deg,#c9a227,#e0bd5a);margin:.6rem auto 0;border-radius:2px;}
    .AS{font-family:'DM Sans',sans-serif;font-size:.78rem;letter-spacing:.13em;text-transform:uppercase;color:#a09080;margin:.6rem 0 0;}
    .ABLK{margin-bottom:4rem;}
    .ABT{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:600;color:#1c1917;margin:0 0 1.2rem;display:flex;align-items:center;gap:.8rem;}
    [data-theme="dark"] .ABT{color:#e8d8b8;}
    .ABT::before{content:'';display:inline-block;width:4px;height:22px;background:#c9a227;border-radius:2px;flex-shrink:0;}
    .AG{display:grid;grid-template-columns:1fr 248px;gap:1.5rem;align-items:start;}
    @media(max-width:820px){.AG{grid-template-columns:1fr;}}
    /* Map container: auto height based on image, clips on zoom */
    .MBOX{position:relative;border-radius:12px;overflow:hidden;
          box-shadow:0 4px 12px rgba(0,0,0,.08),0 16px 40px rgba(0,0,0,.13);
          border:1px solid rgba(201,162,39,.12);background:#0a0a0a;
          cursor:grab;touch-action:none;line-height:0;max-height:80vh;}
    .MBOX:active{cursor:grabbing;}
    /* image: natural size with contain, expands box height */
    .MIMG{display:block;width:100%;height:auto;
          filter:sepia(.07) contrast(1.05);
          transform-origin:0 0;
          pointer-events:none;user-select:none;}
    /* pin layer: sits on top of image, absolute */
    .MLAY{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:visible;}
    /* pins */
    .PIN{position:absolute;pointer-events:all;cursor:pointer;
         transform:translate(-50%,-50%);}
    .PRING{position:absolute;top:50%;left:50%;
           width:22px;height:22px;border-radius:50%;
           background:rgba(201,162,39,.22);
           transform:translate(-50%,-50%);
           animation:PR 2.8s ease-out infinite;}
    @keyframes PR{0%{transform:translate(-50%,-50%) scale(1);opacity:.8}
                  65%{transform:translate(-50%,-50%) scale(2.4);opacity:0}
                  100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
    .PDOT{position:relative;z-index:2;width:20px;height:20px;border-radius:50%;
          background:#c9a227;border:2px solid rgba(255,255,255,.9);
          box-shadow:0 1px 6px rgba(0,0,0,.55);
          display:flex;align-items:center;justify-content:center;
          font-family:'DM Sans',sans-serif;font-size:8px;font-weight:800;color:#1a1000;
          transition:transform .14s,background .14s;}
    .PIN:hover .PDOT,.PIN.act .PDOT{background:#f0c840;transform:scale(1.2);}
    /* tooltip — absolute inside MBOX, рухається разом зі скролом */
    .MTTIP{position:absolute;z-index:50;
           background:rgba(8,6,4,.94);backdrop-filter:blur(14px);
           border:1px solid rgba(201,162,39,.36);border-radius:10px;
           padding:11px 14px 12px;width:220px;max-width:calc(100% - 24px);
           pointer-events:auto;
           opacity:0;transform:translateY(4px);
           transition:opacity .18s,transform .18s;
           visibility:hidden;
           box-shadow:0 8px 30px rgba(0,0,0,.55);}
    .MTTIP.show{opacity:1;transform:translateY(0);visibility:visible;}
    .TTX{position:absolute;top:7px;right:8px;width:18px;height:18px;
         border-radius:50%;background:rgba(255,255,255,.09);border:none;
         color:#7a6a5a;cursor:pointer;font-size:.7rem;
         display:flex;align-items:center;justify-content:center;transition:background .14s;}
    .TTX:hover{background:rgba(255,255,255,.22);color:#fff;}
    .TTR{display:flex;align-items:center;gap:7px;margin-bottom:4px;}
    .TTN{flex-shrink:0;width:20px;height:20px;border-radius:50%;background:#c9a227;
         color:#1a1000;font-size:.6rem;font-weight:800;font-family:'DM Sans',sans-serif;
         display:flex;align-items:center;justify-content:center;}
    .TTT{font-family:'Cormorant Garamond',serif;font-size:.92rem;font-weight:600;color:#f0e6c8;line-height:1.2;}
    .TTD{font-family:'DM Sans',sans-serif;font-size:.68rem;color:#9e9080;line-height:1.5;display:block;margin-top:2px;}
    /* zoom btns */
    .ZW{position:absolute;bottom:12px;left:12px;display:flex;flex-direction:column;gap:4px;z-index:10;}
    .ZB{width:32px;height:32px;background:rgba(8,6,4,.82);backdrop-filter:blur(8px);
        border:1px solid rgba(201,162,39,.28);border-radius:7px;color:#c9a227;
        font-size:1.1rem;font-weight:700;cursor:pointer;
        display:flex;align-items:center;justify-content:center;
        font-family:monospace;border:1px solid rgba(201,162,39,.28);
        transition:background .14s;}
    .ZB:hover{background:rgba(201,162,39,.22);color:#f0c840;}
    /* fullscreen btn */
    .FSB{position:absolute;bottom:12px;right:12px;z-index:10;
         width:32px;height:32px;background:rgba(8,6,4,.82);backdrop-filter:blur(8px);
         border:1px solid rgba(201,162,39,.28);border-radius:7px;color:#c9a227;
         font-size:.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;
         transition:background .14s;}
    .FSB:hover{background:rgba(201,162,39,.22);}
    /* badge */
    .BADGE{position:absolute;top:12px;right:12px;z-index:5;
           background:rgba(8,6,4,.82);backdrop-filter:blur(10px);
           border:1px solid rgba(201,162,39,.28);border-radius:8px;
           padding:5px 11px;pointer-events:none;line-height:1.35;}
    .BADGE .bl{display:block;font-family:'DM Sans',sans-serif;font-size:.5rem;letter-spacing:.16em;text-transform:uppercase;color:#6b5a3e;}
    .BADGE .bd{display:block;font-family:'DM Sans',sans-serif;font-size:.8rem;color:#c9a227;font-weight:600;}
    /* legend */
    .LEG{background:#fff;border:1px solid #e0d8cd;border-radius:12px;
         padding:1.2rem 1rem;position:sticky;top:90px;
         box-shadow:0 2px 4px rgba(0,0,0,.04),0 6px 18px rgba(0,0,0,.06);}
    [data-theme="dark"] .LEG{background:#161310;border-color:#2a2520;}
    .LEGH{font-family:'Cormorant Garamond',serif;font-size:1rem;font-weight:600;
          color:#1c1917;margin:0 0 .75rem;padding-bottom:.6rem;border-bottom:1px solid #e0d8cd;}
    [data-theme="dark"] .LEGH{color:#e0d4bc;border-color:#2a2520;}
    .LEGL{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:2px;}
    .LEGI{display:flex;align-items:center;gap:8px;padding:5px 7px;border-radius:6px;
          cursor:pointer;border:1px solid transparent;transition:background .13s;
          font-family:'DM Sans',sans-serif;font-size:.72rem;color:#44403c;}
    [data-theme="dark"] .LEGI{color:#a09080;}
    .LEGI:hover{background:#f4efe7;}
    .LEGI.act{background:#fdf5e0;border-color:rgba(201,162,39,.45);}
    .LEGN{flex-shrink:0;width:20px;height:20px;border-radius:50%;background:#c9a227;
          color:#1a1000;font-size:.58rem;font-weight:800;font-family:'DM Sans',sans-serif;
          display:flex;align-items:center;justify-content:center;transition:transform .13s;}
    .LEGI:hover .LEGN,.LEGI.act .LEGN{transform:scale(1.12);}
    .LEGHINT{margin-top:.75rem;font-size:.63rem;color:#b0a898;font-family:'DM Sans',sans-serif;
             line-height:1.5;font-style:italic;border-top:1px solid #ede7db;padding-top:.65rem;}
    [data-theme="dark"] .LEGHINT{color:#4e4540;border-color:#2a2520;}
    .MSEP{border:none;border-top:1px solid #e8e0d4;margin:3rem 0;}
    [data-theme="dark"] .MSEP{border-color:#1e1b18;}
    /* fullscreen overlay */
    #MFSO{position:fixed;inset:0;z-index:99999;background:rgba(4,3,2,.97);
          display:flex;align-items:center;justify-content:center;
          opacity:0;pointer-events:none;transition:opacity .24s;}
    #MFSO.open{opacity:1;pointer-events:all;}
    #MFSO img{max-width:95vw;max-height:92vh;object-fit:contain;border-radius:6px;}
    #MFSO .fc{position:absolute;top:16px;right:20px;width:38px;height:38px;
              background:rgba(255,255,255,.12);border:none;border-radius:50%;
              color:#fff;font-size:1.2rem;cursor:pointer;
              display:flex;align-items:center;justify-content:center;}
    #MFSO .fc:hover{background:rgba(255,255,255,.25);}
    </style>

    <div class="AW">
      <div class="AH">
        <h2 class="AT">Аерофотознімки Дубровиці<span class="AL"></span></h2>
        <p class="AS">Унікальні знімки міста часів Другої світової війни</p>
      </div>

      <!-- MAP 1944 -->
      <div class="ABLK">
        <p class="ABT">Аерофотознімок 24 січня 1944 року</p>
        <div class="AG">
          <div class="MBOX" id="M44">
            <img class="MIMG" id="I44" src="https://i.imgur.com/dyP4WgZ.jpeg" alt="1944" draggable="false">
            <div class="MLAY" id="P44"></div>
            <div class="ZW">
              <button class="ZB" id="z44p">+</button>
              <button class="ZB" id="z44m">&#8722;</button>
              <button class="ZB" id="z44r" style="font-size:.78rem">&#8962;</button>
            </div>
            <button class="FSB" id="fs44">&#x26F6;</button>
            <div class="BADGE"><span class="bl">Аерофотознімок</span><span class="bd">24 Jan 1944</span></div>
            <div class="MTTIP" id="TIP44">
              <button class="TTX" data-mid="44">&#x2715;</button>
              <div class="TTR"><span class="TTN" id="TN44"></span><span class="TTT" id="TT44"></span></div>
              <span class="TTD" id="TD44"></span>
            </div>
          </div>
          <div class="LEG">
            <p class="LEGH">Позначення</p>
            <ul class="LEGL" id="L44"></ul>
            <p class="LEGHINT">Натисніть маркер або пункт · Scroll для збільшення</p>
          </div>
        </div>
      </div>

      <hr class="MSEP">

      <!-- MAP 1943 -->
      <div class="ABLK">
        <p class="ABT">Аерофотознімок жовтень 1943 року</p>
        <div class="AG">
          <div class="MBOX" id="M43">
            <img class="MIMG" id="I43" src="https://i.imgur.com/EhsjkKX.jpeg" alt="1943" draggable="false">
            <div class="MLAY" id="P43"></div>
            <div class="ZW">
              <button class="ZB" id="z43p">+</button>
              <button class="ZB" id="z43m">&#8722;</button>
              <button class="ZB" id="z43r" style="font-size:.78rem">&#8962;</button>
            </div>
            <button class="FSB" id="fs43">&#x26F6;</button>
            <div class="BADGE"><span class="bl">Аерофотознімок</span><span class="bd">Oct 1943</span></div>
            <div class="MTTIP" id="TIP43">
              <button class="TTX" data-mid="43">&#x2715;</button>
              <div class="TTR"><span class="TTN" id="TN43"></span><span class="TTT" id="TT43"></span></div>
              <span class="TTD" id="TD43"></span>
            </div>
          </div>
          <div class="LEG">
            <p class="LEGH">Позначення</p>
            <ul class="LEGL" id="L43">
              <li style="font-size:.72rem;color:#a09080;font-family:'DM Sans',sans-serif;padding:.4rem .25rem">Завантаження...</li>
            </ul>
            <p class="LEGHINT">Позначення додаються через адмін-панель</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Fullscreen overlay -->
    <div id="MFSO"><button class="fc" id="MFSC">&#x2715;</button><img id="MFSI" src="" alt=""></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

      var DATA = { '44': [], '43': [] };
      // State: scale + translate from top-left (transform-origin: 0 0)
      var ST = {
        '44': { sc: 1, tx: 0, ty: 0 },
        '43': { sc: 1, tx: 0, ty: 0 }
      };
      var activeMid = null, activeN = null;

      // ── BUILD PINS ─────────────────────────────────────────────
      function buildPins(mid) {
        var layer = document.getElementById('P'+mid);
        layer.innerHTML = '';
        DATA[mid].forEach(function(p) {
          var el = document.createElement('div');
          el.className = 'PIN';
          el.id = 'PIN_'+mid+'_'+p.n;
          el.innerHTML = '<div class="PRING"></div><div class="PDOT">'+p.n+'</div>';
          el.addEventListener('click', function(e) {
            e.stopPropagation();
            togglePin(mid, p.n, p.t, p.d);
          });
          layer.appendChild(el);
        });
        updatePinPositions(mid);
      }

      function buildLegend(mid) {
        var leg = document.getElementById('L'+mid);
        leg.innerHTML = '';
        DATA[mid].forEach(function(p) {
          var li = document.createElement('li');
          li.className = 'LEGI';
          li.id = 'LI_'+mid+'_'+p.n;
          li.innerHTML = '<span class="LEGN">'+p.n+'</span>'+p.t;
          li.addEventListener('click', function(e) {
            e.stopPropagation();
            togglePin(mid, p.n, p.t, p.d);
          });
          leg.appendChild(li);
        });
      }

      // ── TOOLTIP — absolute inside MBOX, never leaves the map ───
      function togglePin(mid, n, title, desc) {
        if (activeMid === mid && activeN === n) { hideTooltip(); return; }
        hideTooltip();
        activeMid = mid; activeN = n;
        var pin = document.getElementById('PIN_'+mid+'_'+n);
        var li  = document.getElementById('LI_'+mid+'_'+n);
        if (pin) pin.classList.add('act');
        if (li)  li.classList.add('act');
        positionTooltip(mid, n, title, desc);
      }

      function hideTooltip() {
        ['44','43'].forEach(function(m) {
          document.getElementById('TIP'+m).classList.remove('show');
        });
        if (activeMid) {
          var pin = document.getElementById('PIN_'+activeMid+'_'+activeN);
          var li  = document.getElementById('LI_'+activeMid+'_'+activeN);
          if (pin) pin.classList.remove('act');
          if (li)  li.classList.remove('act');
        }
        activeMid = null; activeN = null;
      }

      function positionTooltip(mid, n, title, desc) {
        var tip = document.getElementById('TIP'+mid);
        var box = document.getElementById('M'+mid);
        var pin = document.getElementById('PIN_'+mid+'_'+n);

        document.getElementById('TN'+mid).textContent = n;
        document.getElementById('TT'+mid).textContent = title;
        document.getElementById('TD'+mid).textContent = desc;

        // Show hidden to measure real size
        tip.style.visibility = 'hidden';
        tip.classList.add('show');
        var tw = tip.offsetWidth, th = tip.offsetHeight;
        tip.style.visibility = '';

        // Pin absolute pos (center of pin dot) — already set by updatePinPositions
        var pinX = parseFloat(pin.style.left) || box.offsetWidth/2;
        var pinY = parseFloat(pin.style.top)  || box.offsetHeight/2;
        var bw = box.offsetWidth, bh = box.offsetHeight;
        var GAP = 14, MARGIN = 8;

        // Try right, then left
        var left = pinX + GAP;
        if (left + tw > bw - MARGIN) left = pinX - tw - GAP;
        // Try above center, clamp vertical
        var top = pinY - th / 2;
        // Clamp inside box
        left = Math.max(MARGIN, Math.min(bw - tw - MARGIN, left));
        top  = Math.max(MARGIN, Math.min(bh - th - MARGIN, top));

        tip.style.left = left + 'px';
        tip.style.top  = top  + 'px';
      }

      // Close buttons
      document.querySelectorAll('.TTX').forEach(function(btn) {
        btn.addEventListener('click', function(e) { e.stopPropagation(); hideTooltip(); });
      });

      // ── TRANSFORM: transform-origin 0 0, translate+scale ───────
      // screenX = tx + pinX_pct * imgW * sc
      // screenY = ty + pinY_pct * imgH * sc
      // Zoom toward pivot (px, py) in box coords:
      //   tx' = px - (px - tx) * (newSc / oldSc)

      function getImg(mid) { return document.getElementById('I'+mid); }
      function getBox(mid) { return document.getElementById('M'+mid); }

      function clamp(mid) {
        var s = ST[mid];
        var img = getImg(mid), box = getBox(mid);
        var iw = img.offsetWidth * s.sc, ih = img.offsetHeight * s.sc;
        var bw = box.offsetWidth,         bh = box.offsetHeight;
        // Image must cover box (no empty space)
        s.tx = Math.min(0, Math.max(bw - iw, s.tx));
        s.ty = Math.min(0, Math.max(bh - ih, s.ty));
      }

      function applyTransform(mid, animate) {
        var s = ST[mid], img = getImg(mid);
        img.style.transition = animate ? 'transform .25s cubic-bezier(.25,.46,.45,.94)' : 'none';
        img.style.transform = 'translate('+s.tx+'px,'+s.ty+'px) scale('+s.sc+')';
        updatePinPositions(mid);
        // Reposition open tooltip
        if (activeMid === mid && activeN !== null) {
          positionTooltip(mid, activeN,
            document.getElementById('TT'+mid).textContent,
            document.getElementById('TD'+mid).textContent);
        }
      }

      function updatePinPositions(mid) {
        var s = ST[mid], img = getImg(mid), box = getBox(mid);
        var w = img.offsetWidth, h = img.offsetHeight;
        var bw = box.offsetWidth, bh = box.offsetHeight;
        if (!w || !h) return;
        DATA[mid].forEach(function(p) {
          var pin = document.getElementById('PIN_'+mid+'_'+p.n);
          if (!pin) return;
          var nx = s.tx + (p.x / 100 * w) * s.sc;
          var ny = s.ty + (p.y / 100 * h) * s.sc;
          pin.style.left = nx + 'px';
          pin.style.top  = ny + 'px';
          var vis = nx > -20 && nx < bw + 20 && ny > -20 && ny < bh + 20;
          pin.style.opacity = vis ? '1' : '0';
          pin.style.pointerEvents = vis ? '' : 'none';
        });
      }

      function doZoom(mid, factor, pivotX, pivotY) {
        var s = ST[mid], box = getBox(mid);
        var px = (pivotX !== undefined) ? pivotX : box.offsetWidth / 2;
        var py = (pivotY !== undefined) ? pivotY : box.offsetHeight / 2;
        var oldSc = s.sc;
        s.sc = Math.min(8, Math.max(1, oldSc * factor));
        if (s.sc === oldSc) return;
        var ratio = s.sc / oldSc;
        s.tx = px - (px - s.tx) * ratio;
        s.ty = py - (py - s.ty) * ratio;
        clamp(mid);
        applyTransform(mid, true);
      }

      function doReset(mid) {
        ST[mid] = { sc: 1, tx: 0, ty: 0 };
        applyTransform(mid, true);
        hideTooltip();
      }

      // ── BUTTONS ────────────────────────────────────────────────
      ['44','43'].forEach(function(mid) {
        document.getElementById('z'+mid+'p').addEventListener('click', function(e) {
          e.stopPropagation(); doZoom(mid, 1.5);
        });
        document.getElementById('z'+mid+'m').addEventListener('click', function(e) {
          e.stopPropagation(); doZoom(mid, 1/1.5);
        });
        document.getElementById('z'+mid+'r').addEventListener('click', function(e) {
          e.stopPropagation(); doReset(mid);
        });
        document.getElementById('fs'+mid).addEventListener('click', function(e) {
          e.stopPropagation();
          document.getElementById('MFSI').src = getImg(mid).src;
          document.getElementById('MFSO').classList.add('open');
        });
      });

      // ── DRAG & WHEEL ───────────────────────────────────────────
      ['44','43'].forEach(function(mid) {
        var box = getBox(mid);
        var dragging = false, startX = 0, startY = 0;

        box.addEventListener('mousedown', function(e) {
          if (e.button !== 0) return;
          if (e.target.closest('.PIN,.ZB,.FSB,.MTTIP')) return;
          dragging = true;
          startX = e.clientX - ST[mid].tx;
          startY = e.clientY - ST[mid].ty;
          box.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', function(e) {
          if (!dragging) return;
          ST[mid].tx = e.clientX - startX;
          ST[mid].ty = e.clientY - startY;
          clamp(mid); applyTransform(mid, false);
        });

        document.addEventListener('mouseup', function() {
          if (dragging) { dragging = false; box.style.cursor = ''; }
        });

        // Wheel: smooth multiplicative zoom toward cursor
        box.addEventListener('wheel', function(e) {
          e.preventDefault();
          var rect = box.getBoundingClientRect();
          var px = e.clientX - rect.left;
          var py = e.clientY - rect.top;
          // Normalize delta — small steps for smooth feel
          var raw = e.deltaY !== 0 ? e.deltaY : (e.detail ? e.detail * 40 : 0);
          var factor = Math.pow(0.998, raw); // ~1.08x per 100px scroll
          doZoom(mid, factor, px, py);
        }, { passive: false });

        box.addEventListener('click', function(e) {
          if (!e.target.closest('.PIN') && !e.target.closest('.MTTIP')) hideTooltip();
        });

        // ── TOUCH ──────────────────────────────────────────────
        var lastDist = 0, tdragging = false, tsx = 0, tsy = 0;

        box.addEventListener('touchstart', function(e) {
          if (e.touches.length === 1) {
            tdragging = true;
            tsx = e.touches[0].clientX - ST[mid].tx;
            tsy = e.touches[0].clientY - ST[mid].ty;
          } else if (e.touches.length === 2) {
            tdragging = false;
            lastDist = Math.hypot(
              e.touches[0].clientX - e.touches[1].clientX,
              e.touches[0].clientY - e.touches[1].clientY);
          }
        }, { passive: true });

        box.addEventListener('touchmove', function(e) {
          e.preventDefault();
          if (e.touches.length === 1 && tdragging) {
            ST[mid].tx = e.touches[0].clientX - tsx;
            ST[mid].ty = e.touches[0].clientY - tsy;
            clamp(mid); applyTransform(mid, false);
          } else if (e.touches.length === 2) {
            var t0 = e.touches[0], t1 = e.touches[1];
            var dist = Math.hypot(t0.clientX - t1.clientX, t0.clientY - t1.clientY);
            if (lastDist > 0) {
              var rect = box.getBoundingClientRect();
              var mx = ((t0.clientX + t1.clientX) / 2) - rect.left;
              var my = ((t0.clientY + t1.clientY) / 2) - rect.top;
              doZoom(mid, dist / lastDist, mx, my);
            }
            lastDist = dist;
          }
        }, { passive: false });

        box.addEventListener('touchend', function(e) {
          if (e.touches.length < 2) lastDist = 0;
          if (e.touches.length === 1) {
            tsx = e.touches[0].clientX - ST[mid].tx;
            tsy = e.touches[0].clientY - ST[mid].ty;
            tdragging = true;
          } else if (e.touches.length === 0) {
            tdragging = false;
          }
        }, { passive: true });
      });

      // ── FULLSCREEN ─────────────────────────────────────────────
      document.getElementById('MFSC').addEventListener('click', function() {
        document.getElementById('MFSO').classList.remove('open');
      });
      document.getElementById('MFSO').addEventListener('click', function(e) {
        if (e.target === this) this.classList.remove('open');
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          hideTooltip();
          document.getElementById('MFSO').classList.remove('open');
        }
      });

      // ── LOAD PINS FROM GITHUB ──────────────────────────────────
      function normalizePin(p) {
        var x = p.x !== undefined ? p.x : (p.pct ? p.pct.x : 50);
        var y = p.y !== undefined ? p.y : (p.pct ? p.pct.y : 50);
        return { n: p.id||p.n||1, x: +x||0, y: +y||0, t: p.title||p.t||'', d: p.desc||p.d||'' };
      }

      function loadMap(mid, file, legId) {
        var leg = document.getElementById(legId);
        fetch('https://raw.githubusercontent.com/jerkinsmichael13-stack/Dubrovytsia1/main/'+file+'?v='+Date.now())
          .then(function(r) { return r.ok ? r.json() : []; })
          .then(function(data) {
            if (!Array.isArray(data) || !data.length) {
              if (leg) leg.innerHTML = '<li style="font-size:.72rem;color:#a09080;font-family:\'DM Sans\',sans-serif;padding:.4rem .25rem">Позначень ще немає</li>';
              return;
            }
            DATA[mid] = data.map(normalizePin).filter(function(p){ return !isNaN(p.x)&&!isNaN(p.y); });
            buildPins(mid);
            buildLegend(mid);
          })
          .catch(function() {
            if (leg) leg.innerHTML = '<li style="font-size:.72rem;color:#a09080;font-family:\'DM Sans\',sans-serif;padding:.4rem .25rem">Помилка завантаження</li>';
          });
      }

      loadMap('44', 'aerial_pins_1944.json', 'L44');
      loadMap('43', 'aerial_pins_1943.json', 'L43');

      window.addEventListener('resize', function() {
        ['44','43'].forEach(function(mid) { clamp(mid); applyTransform(mid, false); });
      });

    }); // DOMContentLoaded
    </script>
    </section>
    <!-- ═══ END AERIAL MAPS ═══ -->

    <!-- ═══ TOPOGRAPHIC PLAN 1855 ═══ -->
    <section id="TOPO">
    <style>
    /* ═══════════════════════════════════════════
       TOPO SECTION — Топографічний план 1855 р.
    ═══════════════════════════════════════════ */
    #TOPO{padding:6rem 0 5rem;background:#f0ebe0;position:relative;overflow:hidden;border-top:1px solid rgba(180,150,80,.15);}
    [data-theme="dark"] #TOPO{background:#0c0a07;border-color:rgba(201,162,39,.08);}
    #TOPO::before{content:'';position:absolute;inset:0;pointer-events:none;
      background:radial-gradient(ellipse 70% 50% at 50% -10%, rgba(201,162,39,.08) 0%, transparent 60%),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c9a227' fill-opacity='0.025'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
    #TOPO *{box-sizing:border-box;}
    .TPW{max-width:1260px;margin:0 auto;padding:0 2rem;}

    /* ── HEADER ── */
    .TPH{text-align:center;margin-bottom:3.5rem;}
    .TPE{display:inline-flex;align-items:center;gap:.8rem;margin-bottom:1.1rem;}
    .TPE::before,.TPE::after{content:'';display:block;width:40px;height:1px;}
    .TPE::before{background:linear-gradient(90deg,transparent,rgba(201,162,39,.6));}
    .TPE::after{background:linear-gradient(90deg,rgba(201,162,39,.6),transparent);}
    .TPE span{font-family:'DM Sans',sans-serif;font-size:.62rem;letter-spacing:.3em;text-transform:uppercase;color:#c9a227;}
    .TPT{font-family:'Cormorant Garamond',Georgia,serif;font-size:clamp(2rem,3.8vw,3rem);font-weight:400;color:#1c1917;line-height:1.1;margin:0 0 .5rem;}
    [data-theme="dark"] .TPT{color:#f0e6c8;}
    .TPT em{font-style:italic;color:#c9a227;}
    .TPS{font-family:'DM Sans',sans-serif;font-size:.75rem;letter-spacing:.12em;text-transform:uppercase;color:rgba(28,25,23,.4);margin:0;}
    [data-theme="dark"] .TPS{color:rgba(240,230,200,.3);}

    /* ── MAIN GRID ── */
    .TPG{display:grid;grid-template-columns:1fr 300px;gap:2rem;align-items:start;}
    @media(max-width:900px){.TPG{grid-template-columns:1fr;}}

    /* ── MAP WRAPPER ── */
    .TPMBOX{position:relative;border-radius:4px;overflow:hidden;
      box-shadow:0 0 0 1px rgba(201,162,39,.18),0 2px 8px rgba(0,0,0,.06),0 12px 40px rgba(0,0,0,.16);
      background:#1a1206;cursor:grab;user-select:none;}
    .TPMBOX:active{cursor:grabbing;}
    .TPMIMG{display:block;width:100%;height:auto;transform-origin:0 0;will-change:transform;max-height:68vh;object-fit:cover;}
    .TPMBOX::before,.TPMBOX::after{content:'';position:absolute;width:28px;height:28px;z-index:6;pointer-events:none;}
    .TPMBOX::before{top:10px;left:10px;border-top:1.5px solid rgba(201,162,39,.5);border-left:1.5px solid rgba(201,162,39,.5);}
    .TPMBOX::after{bottom:10px;right:10px;border-bottom:1.5px solid rgba(201,162,39,.5);border-right:1.5px solid rgba(201,162,39,.5);}

    /* PIN layer */
    .TPLAY{position:absolute;inset:0;pointer-events:none;z-index:4;}

    /* PIN dot */
    .TPPIN{position:absolute;transform:translate(-50%,-50%);cursor:pointer;pointer-events:all;z-index:5;}
    .TPPIN .TPPring{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      width:18px;height:18px;border-radius:50%;border:1.5px solid rgba(201,162,39,.45);
      animation:tpPulse 2.2s ease-out infinite;pointer-events:none;}
    .TPPIN .TPPdot{width:12px;height:12px;border-radius:50%;background:#c9a227;border:1.5px solid #fff;
      box-shadow:0 1px 5px rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;
      font-family:'DM Sans',sans-serif;font-size:.38rem;font-weight:800;color:#1a1000;
      transition:transform .14s,background .14s;}
    .TPPIN:hover .TPPdot,.TPPIN.act .TPPdot{background:#f0c840;transform:scale(1.2);}
    @keyframes tpPulse{0%{transform:translate(-50%,-50%) scale(.9);opacity:.7}70%{transform:translate(-50%,-50%) scale(2);opacity:0}100%{transform:translate(-50%,-50%) scale(2);opacity:0}}

    /* PIN tooltip */
    .TPMTTIP{position:absolute;z-index:50;background:rgba(8,6,4,.94);backdrop-filter:blur(14px);
      border:1px solid rgba(201,162,39,.36);border-radius:10px;padding:11px 14px 12px;width:220px;
      max-width:calc(100% - 24px);pointer-events:auto;opacity:0;transform:translateY(4px);
      transition:opacity .18s,transform .18s;visibility:hidden;box-shadow:0 8px 30px rgba(0,0,0,.55);}
    .TPMTTIP.show{opacity:1;transform:translateY(0);visibility:visible;}
    .TPTTX{position:absolute;top:7px;right:8px;width:18px;height:18px;border-radius:50%;
      background:rgba(255,255,255,.09);border:none;color:#7a6a5a;cursor:pointer;font-size:.7rem;
      display:flex;align-items:center;justify-content:center;transition:background .14s;}
    .TPTTX:hover{background:rgba(255,255,255,.22);color:#fff;}
    .TPTTR{display:flex;align-items:center;gap:7px;margin-bottom:4px;}
    .TPTTNUM{flex-shrink:0;width:20px;height:20px;border-radius:50%;background:#c9a227;
      color:#1a1000;font-size:.6rem;font-weight:800;font-family:'DM Sans',sans-serif;
      display:flex;align-items:center;justify-content:center;}
    .TPTTTIT{font-family:'Cormorant Garamond',serif;font-size:.92rem;font-weight:600;color:#f0e6c8;line-height:1.2;}
    .TPTTDSC{font-family:'DM Sans',sans-serif;font-size:.68rem;color:#9e9080;line-height:1.5;display:block;margin-top:2px;}

    /* ── MAP CONTROLS ── */
    .TPZW{position:absolute;bottom:14px;left:14px;display:flex;flex-direction:column;gap:5px;z-index:10;}
    .TPZB{width:34px;height:34px;background:rgba(8,5,2,.88);backdrop-filter:blur(10px);
      border:1px solid rgba(201,162,39,.32);border-radius:8px;color:#c9a227;font-size:1.1rem;font-weight:700;
      cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:monospace;
      transition:background .14s,transform .1s;}
    .TPZB:hover{background:rgba(201,162,39,.22);transform:scale(1.06);}
    .TPFSB{position:absolute;bottom:14px;right:14px;z-index:10;width:34px;height:34px;
      background:rgba(8,5,2,.88);backdrop-filter:blur(10px);border:1px solid rgba(201,162,39,.32);
      border-radius:8px;color:#c9a227;cursor:pointer;display:flex;align-items:center;justify-content:center;
      transition:background .14s,transform .1s;}
    .TPFSB:hover{background:rgba(201,162,39,.22);transform:scale(1.06);}
    .TPFSB svg{width:16px;height:16px;}
    .TPBADGE{position:absolute;top:14px;right:14px;z-index:5;background:rgba(8,5,2,.88);
      backdrop-filter:blur(12px);border:1px solid rgba(201,162,39,.3);border-radius:8px;
      padding:6px 12px;pointer-events:none;line-height:1.4;}
    .TPBADGE .bl{display:block;font-family:'DM Sans',sans-serif;font-size:.48rem;letter-spacing:.2em;text-transform:uppercase;color:#5a4a2e;}
    .TPBADGE .bd{display:block;font-family:'Cormorant Garamond',serif;font-size:.95rem;color:#c9a227;font-weight:500;letter-spacing:.04em;}
    .TPHINT{position:absolute;bottom:14px;left:50%;transform:translateX(-50%);background:rgba(8,5,2,.72);
      backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.07);border-radius:100px;
      padding:.4rem 1.2rem;font-family:'DM Sans',sans-serif;font-size:.6rem;letter-spacing:.15em;
      text-transform:uppercase;color:rgba(255,255,255,.4);pointer-events:none;white-space:nowrap;
      transition:opacity .5s;z-index:8;}
    .TPMBOX.moved .TPHINT{opacity:0;}

    /* ── SIDEBAR ── */
    .TPSB{display:flex;flex-direction:column;gap:1.2rem;position:sticky;top:90px;}
    .TPCARD{background:#fff;border:1px solid #e8e0d0;border-radius:12px;padding:1.4rem 1.3rem;
      box-shadow:0 2px 8px rgba(0,0,0,.04),0 6px 24px rgba(0,0,0,.05);}
    [data-theme="dark"] .TPCARD{background:#161210;border-color:#2a2218;}
    .TPCARDH{font-family:'Cormorant Garamond',serif;font-size:1.05rem;font-weight:600;color:#1c1917;
      margin:0 0 .8rem;padding-bottom:.7rem;border-bottom:1px solid #ede5d5;display:flex;align-items:center;gap:.5rem;}
    [data-theme="dark"] .TPCARDH{color:#e0d4b8;border-color:#2a2218;}
    .TPCARDH svg{width:16px;height:16px;color:#c9a227;flex-shrink:0;}

    /* pin legend list */
    .TPLEGLIST{display:flex;flex-direction:column;gap:2px;margin-bottom:.5rem;}
    .TPLEGLI{display:flex;align-items:center;gap:8px;padding:5px 7px;border-radius:6px;
      cursor:pointer;border:1px solid transparent;transition:background .13s;
      font-family:'DM Sans',sans-serif;font-size:.72rem;color:#44403c;}
    [data-theme="dark"] .TPLEGLI{color:#a09080;}
    .TPLEGLI:hover{background:#f4efe7;}
    .TPLEGLI.act{background:#fdf5e0;border-color:rgba(201,162,39,.45);}
    .TPLEGN{flex-shrink:0;width:20px;height:20px;border-radius:50%;background:#c9a227;
      color:#1a1000;font-size:.58rem;font-weight:800;font-family:'DM Sans',sans-serif;
      display:flex;align-items:center;justify-content:center;transition:transform .13s;}
    .TPLEGLI:hover .TPLEGN,.TPLEGLI.act .TPLEGN{transform:scale(1.12);}
    .TPLEGMT{font-family:'DM Sans',sans-serif;font-size:.6rem;font-style:italic;color:#b0a080;line-height:1.5;
      border-top:1px solid #ede5d5;padding-top:.6rem;margin-top:.4rem;}
    [data-theme="dark"] .TPLEGMT{color:#4e4530;border-color:#2a2218;}

    /* stat rows */
    .TPSTAT{display:flex;flex-direction:column;gap:.55rem;}
    .TPROW{display:flex;justify-content:space-between;align-items:baseline;gap:.5rem;padding:.3rem 0;border-bottom:1px solid #f0e8d8;}
    [data-theme="dark"] .TPROW{border-color:#1e1a14;}
    .TPROW:last-child{border-bottom:none;}
    .TPRL{font-family:'DM Sans',sans-serif;font-size:.68rem;color:#a09070;text-transform:uppercase;letter-spacing:.06em;}
    .TPRV{font-family:'Cormorant Garamond',serif;font-size:.95rem;font-weight:500;color:#1c1917;text-align:right;}
    [data-theme="dark"] .TPRV{color:#d4c8a8;}

    /* legend image card */
    .TPLEGCARD{background:#fff;border:1px solid #e8e0d0;border-radius:12px;overflow:hidden;
      box-shadow:0 2px 8px rgba(0,0,0,.04),0 6px 24px rgba(0,0,0,.05);}
    [data-theme="dark"] .TPLEGCARD{background:#161210;border-color:#2a2218;}
    .TPLEGHEAD{padding:.9rem 1.3rem .75rem;border-bottom:1px solid #ede5d5;}
    [data-theme="dark"] .TPLEGHEAD{border-color:#2a2218;}
    .TPLEGHT{font-family:'Cormorant Garamond',serif;font-size:1rem;font-weight:600;color:#1c1917;margin:0;}
    [data-theme="dark"] .TPLEGHT{color:#e0d4b8;}
    .TPLEGBODY{padding:.8rem;}
    .TPLEGIMG{width:100%;border-radius:6px;display:block;cursor:zoom-in;transition:transform .2s;}
    .TPLEGIMG:hover{transform:scale(1.02);}
    .TPLEGFOOTER{padding:.2rem 1rem .8rem;font-family:'DM Sans',sans-serif;font-size:.62rem;color:#a09070;font-style:italic;line-height:1.5;text-align:center;}
    [data-theme="dark"] .TPLEGFOOTER{color:#5a4a30;}

    /* ── FULLSCREEN OVERLAY ── */
    #TPFSO{position:fixed;inset:0;z-index:99999;background:rgba(4,3,1,.97);backdrop-filter:blur(20px);
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem;
      opacity:0;pointer-events:none;transition:opacity .28s ease;}
    #TPFSO.open{opacity:1;pointer-events:all;}
    #TPFSC{position:fixed;top:1.2rem;right:1.2rem;z-index:100001;width:44px;height:44px;
      background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);border-radius:50%;
      color:rgba(255,255,255,.8);cursor:pointer;display:flex;align-items:center;justify-content:center;
      transition:background .2s,transform .2s;}
    #TPFSC svg{width:18px;height:18px;}
    #TPFSC:hover{background:#c9a227;border-color:#c9a227;color:#0f0a00;transform:rotate(90deg);}
    #TPFSTITLE{font-family:'Cormorant Garamond',serif;font-size:clamp(.8rem,2vw,1rem);font-weight:300;
      letter-spacing:.08em;color:rgba(240,220,160,.4);text-align:center;pointer-events:none;max-width:600px;padding:0 1rem;}

    /* Fullscreen image with pan+zoom */
    #TPFSFRAME{position:relative;width:min(96vw,1400px);height:min(82vh,900px);border-radius:4px;overflow:hidden;
      box-shadow:0 0 0 1px rgba(201,162,39,.2),0 40px 100px rgba(0,0,0,.8);cursor:grab;user-select:none;}
    #TPFSFRAME:active{cursor:grabbing;}
    #TPFSFRAME::before,#TPFSFRAME::after{content:'';position:absolute;width:28px;height:28px;z-index:5;pointer-events:none;}
    #TPFSFRAME::before{top:10px;left:10px;border-top:1px solid rgba(201,162,39,.4);border-left:1px solid rgba(201,162,39,.4);}
    #TPFSFRAME::after{bottom:10px;right:10px;border-bottom:1px solid rgba(201,162,39,.4);border-right:1px solid rgba(201,162,39,.4);}
    #TPFSIMG{display:block;width:100%;height:100%;object-fit:contain;transform-origin:0 0;will-change:transform;}

    /* Fullscreen zoom controls */
    #TPFSZW{position:absolute;bottom:14px;left:14px;display:flex;flex-direction:column;gap:4px;z-index:20;}
    .TPFSZB{width:34px;height:34px;background:rgba(8,5,2,.88);backdrop-filter:blur(10px);
      border:1px solid rgba(201,162,39,.32);border-radius:8px;color:#c9a227;font-size:1.1rem;font-weight:700;
      cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:monospace;
      transition:background .14s,transform .1s;}
    .TPFSZB:hover{background:rgba(201,162,39,.22);transform:scale(1.06);}
    #TPFSHINT{position:absolute;bottom:14px;left:50%;transform:translateX(-50%);
      background:rgba(8,5,2,.72);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.07);
      border-radius:100px;padding:.4rem 1.2rem;font-family:'DM Sans',sans-serif;font-size:.6rem;
      letter-spacing:.15em;text-transform:uppercase;color:rgba(255,255,255,.4);pointer-events:none;
      white-space:nowrap;transition:opacity .5s;z-index:18;}
    #TPFSFRAME.fsmoved #TPFSHINT{opacity:0;}

    #TPFSMETA{display:flex;gap:2rem;align-items:center;justify-content:center;flex-wrap:wrap;padding:0 1rem;pointer-events:none;}
    .TPFSMT{font-family:'DM Sans',sans-serif;font-size:.6rem;letter-spacing:.16em;text-transform:uppercase;}
    .TPFSMT .label{color:rgba(201,162,39,.5);display:block;margin-bottom:.2rem;}
    .TPFSMT .val{color:rgba(240,220,160,.7);}

    /* ── BOTTOM BAR ── */
    .TPBOTTOM{margin-top:2.5rem;background:#fff;border:1px solid #e8e0d0;border-radius:12px;
      padding:1.5rem 2rem;display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;
      box-shadow:0 2px 8px rgba(0,0,0,.03),0 6px 24px rgba(0,0,0,.04);}
    [data-theme="dark"] .TPBOTTOM{background:#161210;border-color:#2a2218;}
    @media(max-width:640px){.TPBOTTOM{grid-template-columns:1fr;gap:1.2rem;}}
    .TPBITEM{display:flex;flex-direction:column;gap:.4rem;}
    .TPBICO{width:32px;height:32px;border-radius:8px;background:rgba(201,162,39,.1);
      display:flex;align-items:center;justify-content:center;margin-bottom:.3rem;}
    .TPBICO svg{width:16px;height:16px;color:#c9a227;}
    .TPBTH{font-family:'Cormorant Garamond',serif;font-size:1rem;font-weight:600;color:#1c1917;}
    [data-theme="dark"] .TPBTH{color:#e0d4b8;}
    .TPBTD{font-family:'DM Sans',sans-serif;font-size:.72rem;color:rgba(44,36,28,.6);line-height:1.65;}
    [data-theme="dark"] .TPBTD{color:rgba(180,160,120,.5);}

    @media(max-width:640px){.TPZW{bottom:10px;left:10px;}.TPBADGE{top:10px;right:10px;}.TPFSB{bottom:10px;right:10px;}.TPT{font-size:1.7rem;}}
    @media(max-width:600px){#TPFSFRAME{width:98vw;height:65vw;}}
    </style>

    <div class="TPW">
      <div class="TPH">
        <div class="TPE"><span>Топографічний план</span></div>
        <h2 class="TPT">План міста <em>Дубровиці</em></h2>
        <p class="TPS">Рукописна карта · 1855 рік</p>
      </div>

      <p style="font-family:'Cormorant Garamond',serif;font-size:1.25rem;font-weight:600;color:#1c1917;margin:0 0 1.2rem;display:flex;align-items:center;gap:.8rem;" class="TPBL">
        <span style="display:inline-block;width:4px;height:22px;background:#c9a227;border-radius:2px;flex-shrink:0;"></span>
        Топографічний план забудови міста, 1855 рік
      </p>
      <style>[data-theme="dark"] .TPBL{color:#e0d4b8!important;}</style>

      <div class="TPG">
        <!-- MAP -->
        <div class="TPMBOX" id="TPMAP">
          <img class="TPMIMG" id="TPIMG" src="https://i.imgur.com/R4FTjy1.jpeg" alt="Топографічний план Дубровиці 1855 р." draggable="false" loading="eager">
          <div class="TPLAY" id="TPLAY">
            <!-- Tooltip -->
            <div class="TPMTTIP" id="TPTTIP">
              <button class="TPTTX" id="TPTTX">&#x2715;</button>
              <div class="TPTTR"><span class="TPTTNUM" id="TPTTNUM"></span><span class="TPTTTIT" id="TPTTTIT"></span></div>
              <span class="TPTTDSC" id="TPTTDSC"></span>
            </div>
          </div>
          <div class="TPZW">
            <button class="TPZB" id="tpzp" title="Збільшити">+</button>
            <button class="TPZB" id="tpzm" title="Зменшити">&#8722;</button>
            <button class="TPZB" id="tpzr" title="Скинути" style="font-size:.75rem">&#8962;</button>
          </div>
          <button class="TPFSB" id="tpfsb" title="Повний розмір">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>
          </button>
          <div class="TPBADGE"><span class="bl">Топографічний план</span><span class="bd">Дубровиця · 1855 р.</span></div>
          <div class="TPHINT" id="TPHINT">Тягніть для переміщення · Scroll для збільшення</div>
        </div>

        <!-- SIDEBAR -->
        <div class="TPSB">
          <!-- Pins legend card -->
          <div class="TPCARD">
            <h4 class="TPCARDH">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0112 2a8 8 0 018 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
              Позначення пінів
            </h4>
            <ul class="TPLEGLIST" id="TPLEGLIST">
              <li style="font-size:.72rem;color:#a09080;font-family:'DM Sans',sans-serif;padding:.4rem .25rem">Завантаження...</li>
            </ul>
            <p class="TPLEGMT">Натисніть маркер або пункт · Scroll для збільшення</p>
          </div>

          <!-- Map info card -->
          <div class="TPCARD">
            <h4 class="TPCARDH">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 9m0 8V9m0 0L9 7"/></svg>
              Про карту
            </h4>
            <p style="font-family:'DM Sans',sans-serif;font-size:.75rem;line-height:1.75;color:rgba(44,36,28,.72);margin:0 0 .6rem;">
              Рукописна топографічна карта міста Дубровиці 1855 року, складена в часи Волинської губернії Російської імперії. Масштаб — 30 саженів у дюймі (близько 1:2 500). Власник міста на той час — граф Ф. Платер.
            </p>
            <p style="font-family:'DM Sans',sans-serif;font-size:.75rem;line-height:1.75;color:rgba(44,36,28,.72);margin:0 0 .7rem;">
              На плані позначено вулиці, церкви, єврейські будинки, поміщицькі та казенні будівлі, річку Горинь і її притоки.
            </p>
            <p style="font-family:'DM Sans',sans-serif;font-size:.65rem;line-height:1.6;color:rgba(44,36,28,.45);margin:0;padding-top:.6rem;border-top:1px solid #ede5d5;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px;display:inline;vertical-align:middle;margin-right:3px;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              Зображення тут у зниженій якості. Для перегляду у повному розмірі та повній якості — натисніть кнопку <strong style="color:#c9a227;">⤢</strong> у куті карти.
            </p>
          </div>

          <!-- Legend image card -->
          <div class="TPLEGCARD">
            <div class="TPLEGHEAD"><h4 class="TPLEGHT">Пояснення кольорів</h4></div>
            <div class="TPLEGBODY">
              <img class="TPLEGIMG" id="tplegimg" src="https://i.imgur.com/NDtjFcH.jpeg" alt="Легенда топографічного плану Дубровиці" loading="lazy">
            </div>
            <div class="TPLEGFOOTER">«Изъяснение Красокъ» — оригінальна легенда рукописного плану міста</div>
          </div>
        </div>
      </div>

      <!-- Bottom info bar -->
      <div class="TPBOTTOM">
        <div class="TPBITEM">
          <div class="TPBICO"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg></div>
          <div class="TPBTH">Кольорова класифікація</div>
          <div class="TPBTD">На плані різними кольорами позначено будівлі за їхнім призначенням: казенні, поміщицькі, обивательські, єврейські, церковні, постоялі двори, ґанки та водні об'єкти.</div>
        </div>
        <div class="TPBITEM">
          <div class="TPBICO"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg></div>
          <div class="TPBTH">Історичний контекст</div>
          <div class="TPBTD">У 1855 році Дубровиця входила до складу Волинської губернії Російської імперії. Місто належало графу Ф. Платеру. На плані видно річку Горинь та головні вулиці.</div>
        </div>
        <div class="TPBITEM">
          <div class="TPBICO"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0112 2a8 8 0 018 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg></div>
          <div class="TPBTH">Топографічна точність</div>
          <div class="TPBTD">Масштаб — 30 саженів в одному дюймі (бл. 1:2 500). Карта складена за традиціями Російського Генерального штабу і відображає планування міста середини XIX ст.</div>
        </div>
      </div>
    </div>

    <!-- FULLSCREEN OVERLAY with pan+zoom -->
    <div id="TPFSO">
      <button id="TPFSC"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      <div id="TPFSTITLE">Топографічний план міста Дубровиці · 1855 рік</div>
      <div id="TPFSFRAME">
        <img id="TPFSIMG" src="" alt="Топографічний план Дубровиці 1855 р.">
        <div id="TPFSZW">
          <button class="TPFSZB" id="tpfszp">+</button>
          <button class="TPFSZB" id="tpfszm">&#8722;</button>
          <button class="TPFSZB" id="tpfszr" style="font-size:.75rem">&#8962;</button>
        </div>
        <div id="TPFSHINT">Тягніть · Scroll для збільшення</div>
      </div>
      <div id="TPFSMETA">
        <div class="TPFSMT"><span class="label">Рік</span><span class="val">1855</span></div>
        <div class="TPFSMT"><span class="label">Масштаб</span><span class="val">30 саженів / дюйм</span></div>
        <div class="TPFSMT"><span class="label">Губернія</span><span class="val">Волинська</span></div>
        <div class="TPFSMT"><span class="label">Власник</span><span class="val">Граф Ф. Платер</span></div>
      </div>
    </div>

    <script>
    (function() {
      var FULLRES = 'https://i.imgur.com/RCmzgIa.jpeg';
      var GH_FILE = 'topo_pins_1855.json';
      var GH_RAW  = 'https://raw.githubusercontent.com/jerkinsmichael13-stack/Dubrovytsia1/main/';

      var img  = document.getElementById('TPIMG');
      var box  = document.getElementById('TPMAP');
      var play = document.getElementById('TPLAY');
      var tip  = document.getElementById('TPTTIP');
      var hint = document.getElementById('TPHINT');
      var st   = { sc: 1, tx: 0, ty: 0 };
      var dragging = false, startX = 0, startY = 0;
      var pins = [];
      var activePin = null;

      // ── CLAMP & APPLY TRANSFORM ──────────────────────────────
      function clampSt() {
        var iw = img.offsetWidth * st.sc, ih = img.offsetHeight * st.sc;
        var bw = box.offsetWidth, bh = box.offsetHeight;
        st.tx = Math.min(0, Math.max(bw - iw, st.tx));
        st.ty = Math.min(0, Math.max(bh - ih, st.ty));
      }
      function applyTr(anim) {
        img.style.transition = anim ? 'transform .28s cubic-bezier(.25,.46,.45,.94)' : 'none';
        img.style.transform  = 'translate('+st.tx+'px,'+st.ty+'px) scale('+st.sc+')';
        updatePinPositions();
        if (activePin !== null) repositionTooltip(activePin);
      }
      function doZoom(factor, px, py) {
        var bw = box.offsetWidth, bh = box.offsetHeight;
        px = (px !== undefined) ? px : bw/2;
        py = (py !== undefined) ? py : bh/2;
        var old = st.sc;
        st.sc = Math.min(8, Math.max(1, old * factor));
        if (st.sc === old) return;
        var r = st.sc / old;
        st.tx = px - (px - st.tx)*r; st.ty = py - (py - st.ty)*r;
        clampSt(); applyTr(true);
        box.classList.add('moved'); hint.style.opacity = '0';
      }
      function doReset() {
        st = { sc:1, tx:0, ty:0 }; applyTr(true);
        box.classList.remove('moved'); hint.style.opacity = '1';
        hideTip();
      }

      // ── DRAG ────────────────────────────────────────────────
      box.addEventListener('mousedown', function(e) {
        if (e.button !== 0) return;
        if (e.target.closest('.TPZB,.TPFSB,.TPPIN,.TPMTTIP')) return;
        dragging = true; startX = e.clientX - st.tx; startY = e.clientY - st.ty;
      });
      document.addEventListener('mousemove', function(e) {
        if (!dragging) return;
        st.tx = e.clientX - startX; st.ty = e.clientY - startY;
        clampSt(); applyTr(false);
        box.classList.add('moved'); hint.style.opacity = '0';
      });
      document.addEventListener('mouseup', function() { dragging = false; });

      // ── WHEEL ───────────────────────────────────────────────
      box.addEventListener('wheel', function(e) {
        e.preventDefault();
        var rect = box.getBoundingClientRect();
        doZoom(Math.pow(0.998, e.deltaY), e.clientX - rect.left, e.clientY - rect.top);
      }, { passive: false });

      // ── TOUCH ───────────────────────────────────────────────
      var lastDist = 0, tdrag = false, tsx = 0, tsy = 0;
      box.addEventListener('touchstart', function(e) {
        if (e.touches.length === 1) { tdrag=true; tsx=e.touches[0].clientX-st.tx; tsy=e.touches[0].clientY-st.ty; }
        else if (e.touches.length === 2) { tdrag=false; lastDist=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY); }
      }, { passive:true });
      box.addEventListener('touchmove', function(e) {
        e.preventDefault();
        if (e.touches.length===1 && tdrag) { st.tx=e.touches[0].clientX-tsx; st.ty=e.touches[0].clientY-tsy; clampSt(); applyTr(false); }
        else if (e.touches.length===2) {
          var d = Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);
          if (lastDist>0) { var rect=box.getBoundingClientRect(); doZoom(d/lastDist,((e.touches[0].clientX+e.touches[1].clientX)/2)-rect.left,((e.touches[0].clientY+e.touches[1].clientY)/2)-rect.top); }
          lastDist=d;
        }
      }, { passive:false });
      box.addEventListener('touchend', function(e) {
        if (e.touches.length<2) lastDist=0;
        if (e.touches.length===0) tdrag=false;
        else { tsx=e.touches[0].clientX-st.tx; tsy=e.touches[0].clientY-st.ty; tdrag=true; }
      }, { passive:true });

      // ── BUTTONS ─────────────────────────────────────────────
      document.getElementById('tpzp').addEventListener('click', function(e){ e.stopPropagation(); doZoom(1.5); });
      document.getElementById('tpzm').addEventListener('click', function(e){ e.stopPropagation(); doZoom(1/1.5); });
      document.getElementById('tpzr').addEventListener('click', function(e){ e.stopPropagation(); doReset(); });

      // ── PINS ────────────────────────────────────────────────
      function buildPins() {
        // Remove old pin els (keep tooltip)
        play.querySelectorAll('.TPPIN').forEach(function(el){ el.remove(); });
        pins.forEach(function(p) {
          var el = document.createElement('div');
          el.className = 'TPPIN'; el.id = 'TPPIN_'+p.id;
          el.innerHTML = '<div class="TPPring"></div><div class="TPPdot">'+p.id+'</div>';
          el.addEventListener('click', function(e){ e.stopPropagation(); togglePin(p); });
          play.appendChild(el);
        });
        updatePinPositions();
      }

      function updatePinPositions() {
        var w = img.offsetWidth, h = img.offsetHeight;
        if (!w || !h) return;
        pins.forEach(function(p) {
          var el = document.getElementById('TPPIN_'+p.id); if (!el) return;
          var nx = st.tx + (p.x/100 * w) * st.sc;
          var ny = st.ty + (p.y/100 * h) * st.sc;
          el.style.left = nx+'px'; el.style.top = ny+'px';
          var vis = nx>-20 && nx<box.offsetWidth+20 && ny>-20 && ny<box.offsetHeight+20;
          el.style.opacity = vis ? '1' : '0';
          el.style.pointerEvents = vis ? '' : 'none';
        });
      }

      function buildLegend() {
        var ul = document.getElementById('TPLEGLIST'); ul.innerHTML = '';
        if (!pins.length) {
          ul.innerHTML = '<li style="font-size:.72rem;color:#a09080;font-family:\'DM Sans\',sans-serif;padding:.4rem .25rem">Позначень ще немає</li>';
          return;
        }
        pins.forEach(function(p) {
          var li = document.createElement('li'); li.className = 'TPLEGLI'; li.id = 'TPLEG_'+p.id;
          li.innerHTML = '<span class="TPLEGN">'+p.id+'</span>'+escHtml(p.title);
          li.addEventListener('click', function(e){ e.stopPropagation(); togglePin(p); });
          ul.appendChild(li);
        });
      }

      function escHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      function togglePin(p) {
        if (activePin === p.id) { hideTip(); return; }
        hideTip(); activePin = p.id;
        document.getElementById('TPPIN_'+p.id)?.classList.add('act');
        document.getElementById('TPLEG_'+p.id)?.classList.add('act');
        document.getElementById('TPTTNUM').textContent = p.id;
        document.getElementById('TPTTTIT').textContent = p.title;
        document.getElementById('TPTTDSC').textContent = p.desc || '';
        repositionTooltip(p.id);
        tip.classList.add('show');
      }

      function hideTip() {
        tip.classList.remove('show');
        if (activePin !== null) {
          document.getElementById('TPPIN_'+activePin)?.classList.remove('act');
          document.getElementById('TPLEG_'+activePin)?.classList.remove('act');
        }
        activePin = null;
      }

      function repositionTooltip(pinId) {
        var p = pins.find(function(x){ return x.id === pinId; }); if (!p) return;
        var w = img.offsetWidth, h = img.offsetHeight;
        var pinX = st.tx + (p.x/100 * w) * st.sc;
        var pinY = st.ty + (p.y/100 * h) * st.sc;
        var bw = box.offsetWidth, bh = box.offsetHeight;
        // show hidden to measure
        tip.style.visibility = 'hidden'; tip.classList.add('show');
        var tw = tip.offsetWidth, th = tip.offsetHeight;
        tip.style.visibility = '';
        var GAP=14, MAR=8;
        var left = pinX+GAP;
        if (left+tw > bw-MAR) left = pinX-tw-GAP;
        var top = pinY - th/2;
        left = Math.max(MAR, Math.min(bw-tw-MAR, left));
        top  = Math.max(MAR, Math.min(bh-th-MAR, top));
        tip.style.left = left+'px'; tip.style.top = top+'px';
      }

      document.getElementById('TPTTX').addEventListener('click', function(e){ e.stopPropagation(); hideTip(); });
      box.addEventListener('click', function(e){ if (!e.target.closest('.TPPIN,.TPMTTIP')) hideTip(); });

      // ── LOAD PINS ────────────────────────────────────────────
      fetch(GH_RAW + GH_FILE + '?v=' + Date.now())
        .then(function(r){ return r.ok ? r.json() : []; })
        .then(function(data) {
          if (!Array.isArray(data)) return;
          pins = data.map(function(p){ return { id:p.id||p.n||1, x:parseFloat(p.x)||0, y:parseFloat(p.y)||0, title:p.title||p.t||'', desc:p.desc||p.d||'' }; });
          buildPins(); buildLegend();
        })
        .catch(function() {
          document.getElementById('TPLEGLIST').innerHTML = '<li style="font-size:.72rem;color:#a09080;font-family:\'DM Sans\',sans-serif;padding:.4rem .25rem">Позначень ще немає</li>';
        });

      // ── FULLSCREEN (map) ─────────────────────────────────────
      var fsst = { sc:1, tx:0, ty:0 };
      var fsdrag = false, fsx = 0, fsy = 0;
      var fsFrame = document.getElementById('TPFSFRAME');
      var fsImg   = document.getElementById('TPFSIMG');

      function fsClamp() {
        var iw = fsImg.offsetWidth * fsst.sc, ih = fsImg.offsetHeight * fsst.sc;
        var bw = fsFrame.offsetWidth, bh = fsFrame.offsetHeight;
        fsst.tx = Math.min(0, Math.max(bw-iw, fsst.tx));
        fsst.ty = Math.min(0, Math.max(bh-ih, fsst.ty));
      }
      function fsApply(anim) {
        fsImg.style.transition = anim ? 'transform .28s cubic-bezier(.25,.46,.45,.94)' : 'none';
        fsImg.style.transform  = 'translate('+fsst.tx+'px,'+fsst.ty+'px) scale('+fsst.sc+')';
      }
      function fsZoom(factor, px, py) {
        px = px!==undefined ? px : fsFrame.offsetWidth/2;
        py = py!==undefined ? py : fsFrame.offsetHeight/2;
        var old = fsst.sc;
        fsst.sc = Math.min(10, Math.max(1, old*factor));
        if (fsst.sc===old) return;
        var r = fsst.sc/old;
        fsst.tx = px-(px-fsst.tx)*r; fsst.ty = py-(py-fsst.ty)*r;
        fsClamp(); fsApply(true);
        fsFrame.classList.add('fsmoved');
      }
      function fsReset() { fsst={sc:1,tx:0,ty:0}; fsApply(true); fsFrame.classList.remove('fsmoved'); }

      document.getElementById('tpfszp').addEventListener('click', function(e){ e.stopPropagation(); fsZoom(1.5); });
      document.getElementById('tpfszm').addEventListener('click', function(e){ e.stopPropagation(); fsZoom(1/1.5); });
      document.getElementById('tpfszr').addEventListener('click', function(e){ e.stopPropagation(); fsReset(); });

      fsFrame.addEventListener('mousedown', function(e){ if(e.button!==0) return; if(e.target.closest('.TPFSZB')) return; fsdrag=true; fsx=e.clientX-fsst.tx; fsy=e.clientY-fsst.ty; });
      document.addEventListener('mousemove', function(e){ if(!fsdrag) return; fsst.tx=e.clientX-fsx; fsst.ty=e.clientY-fsy; fsClamp(); fsApply(false); fsFrame.classList.add('fsmoved'); });
      document.addEventListener('mouseup', function(){ fsdrag=false; });
      fsFrame.addEventListener('wheel', function(e){ e.preventDefault(); var r=fsFrame.getBoundingClientRect(); fsZoom(Math.pow(0.998,e.deltaY),e.clientX-r.left,e.clientY-r.top); }, { passive:false });

      document.getElementById('tpfsb').addEventListener('click', function(e) {
        e.stopPropagation();
        fsReset();
        fsImg.src = FULLRES;
        document.getElementById('TPFSO').classList.add('open');
        document.body.style.overflow = 'hidden';
      });
      document.getElementById('TPFSC').addEventListener('click', function() {
        document.getElementById('TPFSO').classList.remove('open');
        document.body.style.overflow = '';
        fsReset();
      });
      document.getElementById('TPFSO').addEventListener('click', function(e) {
        if (e.target===this) { this.classList.remove('open'); document.body.style.overflow=''; fsReset(); }
      });

      // Click legend image -> fullscreen
      document.getElementById('tplegimg').addEventListener('click', function() {
        fsReset(); fsImg.src = this.src;
        document.getElementById('TPFSTITLE').textContent = 'Легенда топографічного плану · «Изъяснение Красокъ» · 1855 рік';
        document.getElementById('TPFSO').classList.add('open'); document.body.style.overflow='hidden';
      });

      document.addEventListener('keydown', function(e) {
        if (e.key==='Escape') { document.getElementById('TPFSO').classList.remove('open'); document.body.style.overflow=''; hideTip(); fsReset(); }
      });

      window.addEventListener('resize', function(){ clampSt(); applyTr(false); if(document.getElementById('TPFSO').classList.contains('open')) fsClamp(); });
    })();
    </script>
    </section>
    <!-- ═══ END TOPO PLAN ═══ -->

    <!-- ═══ BEFORE/AFTER COMPARISON SLIDER ═══ -->
    <section id="CMP">
    <style>
    /* ── WRAPPER ── */
    #CMP{padding:5rem 0 6rem;background:#f4efe7;position:relative;overflow:hidden;}
    [data-theme="dark"] #CMP{background:#0d0b09;}
    #CMP::before{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 80% 60% at 50% 0%,rgba(201,162,39,.07) 0%,transparent 70%);
      pointer-events:none;}
    #CMP *{box-sizing:border-box;}
    .CW{max-width:1240px;margin:0 auto;padding:0 2rem;}

    /* ── HEADER ── */
    .CH{text-align:center;margin-bottom:3rem;}
    .CE{display:inline-flex;align-items:center;gap:.75rem;margin-bottom:1.2rem;}
    .CE::before,.CE::after{content:'';display:block;width:32px;height:1px;background:linear-gradient(90deg,transparent,rgba(201,162,39,.5));}
    .CE::after{background:linear-gradient(90deg,rgba(201,162,39,.5),transparent);}
    .CE span{font-family:'DM Sans',sans-serif;font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:#c9a227;}
    .CT{font-family:'Cormorant Garamond',Georgia,serif;font-size:clamp(2.2rem,4vw,3.2rem);font-weight:300;
        color:#1c1917;line-height:1.1;margin:0 0 .6rem;}
    [data-theme="dark"] .CT{color:#f0e6c8;}
    .CT em{font-style:italic;color:#c9a227;}
    .CS{font-family:'DM Sans',sans-serif;font-size:.8rem;letter-spacing:.1em;color:rgba(28,25,23,.45);margin:0;}
    [data-theme="dark"] .CS{color:rgba(240,230,200,.35);}

    /* ── YEAR STRIP ── */
    .CYR{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:1.5rem;margin:0 0 2rem;}
    .CYB{display:flex;flex-direction:column;gap:.2rem;}
    .CYB.yr{text-align:right;}
    .CYB .cy{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;line-height:1;
             background:linear-gradient(135deg,#c9a227,#f0c840);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .CYB.yr .cy{background:linear-gradient(135deg,#6aadf5,#a8d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .CYB .cl{font-size:.62rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(28,25,23,.4);}
    [data-theme="dark"] .CYB .cl{color:rgba(240,230,200,.3);}
    .CYB .cd{font-size:.72rem;font-family:'DM Sans',sans-serif;color:rgba(28,25,23,.5);margin-top:.1rem;}
    [data-theme="dark"] .CYB .cd{color:rgba(240,230,200,.5);}
    .CYD{text-align:center;font-size:1.4rem;color:rgba(201,162,39,.4);}
    [data-theme="dark"] .CYD{color:rgba(201,162,39,.3);}

    /* ── SLIDER FRAME ── */
    .CSF{position:relative;width:100%;aspect-ratio:16/9;border-radius:3px;overflow:hidden;
         cursor:ew-resize;user-select:none;-webkit-user-select:none;
         box-shadow:0 0 0 1px rgba(201,162,39,.12),0 30px 80px rgba(0,0,0,.7),0 8px 24px rgba(0,0,0,.4);}
    @media(max-width:600px){.CSF{aspect-ratio:3/2;cursor:default;}}

    /* images */
    .CSF .ci-base{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
                  pointer-events:none;display:block;
                  filter:saturate(1.15) contrast(1.06) brightness(1.03);}
    .CSF .ci-ov{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
                pointer-events:none;display:block;
                clip-path:inset(0 50% 0 0);
                will-change:clip-path;transform:translateZ(0);
                filter:contrast(1.12) brightness(1.06) saturate(0.05);}

    /* vignette */
    .CSF::after{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 55%,rgba(0,0,0,.45) 100%);
      pointer-events:none;z-index:5;}

    /* ── DIVIDER ── */
    .CDL{position:absolute;top:0;bottom:0;left:50%;z-index:15;pointer-events:none;
         transform:translateX(-50%);width:1px;
         background:linear-gradient(to bottom,
           transparent 0%,
           rgba(255,255,255,.15) 4%,
           rgba(255,255,255,.9) 20%,
           #fff 50%,
           rgba(255,255,255,.9) 80%,
           rgba(255,255,255,.15) 96%,
           transparent 100%);}

    /* ── HANDLE ── */
    .CDH{position:absolute;top:50%;left:50%;z-index:20;
         transform:translate(-50%,-50%);pointer-events:none;
         display:flex;flex-direction:column;align-items:center;gap:0;}
    /* vertical tick top */
    .CDH::before,.CDH::after{content:'';display:block;width:1px;height:28px;background:rgba(255,255,255,.7);}
    /* main disc */
    .CDISC{width:44px;height:44px;border-radius:50%;
           background:linear-gradient(135deg,#fff 0%,#f0ead8 100%);
           box-shadow:0 2px 20px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,.4),inset 0 1px 0 rgba(255,255,255,.8);
           display:flex;align-items:center;justify-content:center;
           transition:transform .15s;}
    .CSF.cdrag .CDISC{transform:scale(1.12);}
    .CDISC svg{width:18px;height:18px;fill:#1a1200;opacity:.7;}

    /* ── CORNER LABELS ── */
    .CCLB{position:absolute;z-index:16;pointer-events:none;}
    .CCLB.cll{top:1.2rem;left:1.2rem;}
    .CCLB.clr{top:1.2rem;right:1.2rem;text-align:right;}
    .CCLB .ccy{display:block;font-family:'Cormorant Garamond',serif;font-size:2rem;font-weight:300;line-height:1;
               text-shadow:0 0 20px rgba(0,0,0,1),0 2px 8px rgba(0,0,0,1),0 0 4px rgba(0,0,0,1);}
    .CCLB.cll .ccy{color:#f5d060;}
    .CCLB.clr .ccy{color:#a8d8ff;}
    .CCLB .ccs{display:block;font-size:.62rem;letter-spacing:.14em;text-transform:uppercase;
               color:#fff;margin-top:.2rem;font-weight:500;
               text-shadow:0 1px 8px rgba(0,0,0,1),0 0 12px rgba(0,0,0,1);}

    /* ── HINT ── */
    .CIP{position:absolute;bottom:1.4rem;left:50%;transform:translateX(-50%);z-index:20;
         background:rgba(0,0,0,.6);backdrop-filter:blur(12px);
         border:1px solid rgba(255,255,255,.08);border-radius:100px;
         padding:.45rem 1.2rem .45rem 1rem;
         display:flex;align-items:center;gap:.6rem;
         font-size:.62rem;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.4);
         pointer-events:none;transition:opacity .5s;}
    .CIP svg{width:14px;height:14px;opacity:.5;flex-shrink:0;}
    .CSF.cmoved .CIP{opacity:0;}

    /* ── FACT CARDS ── */
    .COBS{display:grid;grid-template-columns:repeat(4,1fr);gap:0;margin-top:3rem;}
    [data-theme="dark"] .COBS{background:transparent;}
    @media(max-width:900px){.COBS{grid-template-columns:repeat(2,1fr);gap:0;}}
    @media(max-width:500px){.COBS{grid-template-columns:1fr;}}
    .COB{padding:2.4rem 2rem;background:transparent;position:relative;overflow:hidden;
         transition:background .22s;border-top:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .COB{border-top-color:rgba(255,255,255,.07);}
    .COB:not(:last-child){border-right:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .COB:not(:last-child){border-right-color:rgba(255,255,255,.07);}
    @media(max-width:900px){.COB:nth-child(2){border-right:none;}.COB:nth-child(n+3){border-top:1px solid rgba(0,0,0,.08);}}
    .COB::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
                 background:linear-gradient(90deg,transparent,rgba(201,162,39,.0),transparent);
                 transition:background .22s;}
    .COB:hover{background:rgba(201,162,39,.04);}
    [data-theme="dark"] .COB:hover{background:rgba(201,162,39,.05);}
    .COB:hover::before{background:linear-gradient(90deg,transparent,rgba(201,162,39,.5),transparent);}
    .COI{font-size:2rem;margin-bottom:1.1rem;display:block;}
    .COT{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:500;
         color:#1c1917;margin-bottom:.7rem;line-height:1.2;}
    [data-theme="dark"] .COT{color:#e8d8a8;}
    .COD{font-size:.85rem;font-family:'DM Sans',sans-serif;font-weight:300;line-height:1.8;
         color:rgba(44,40,36,.65);}
    [data-theme="dark"] .COD{color:rgba(240,230,200,.45);}
    </style>

    <div class="CW">
      <div class="CH">
        <div class="CE"><span>Цифровий архів · Дубровиця</span></div>
        <h2 class="CT">Місто в розрізі часу:<br><em>1944 та 2021</em></h2>
        <p class="CS">Перетягніть лінію — побачте, як змінилося місто за 77 років</p>
      </div>

      <div class="CYR">
        <div class="CYB">
          <span class="cy">1944</span>
          <span class="cl">Люфтваффе</span>
          <span class="cd">24 січня 1944 р.</span>
        </div>
        <div class="CYD">↔</div>
        <div class="CYB yr">
          <span class="cy">2021</span>
          <span class="cl">Супутник</span>
          <span class="cd">Google Maps</span>
        </div>
      </div>

      <div class="CSF" id="CSLIDER">
        <!-- Base: 2021 satellite (right side when slider is left) -->
        <img class="ci-base" src="https://i.imgur.com/Oj9x49gh.jpeg" alt="Дубровиця 2021" draggable="false" decoding="async">
        <!-- Overlay: 1944 aerial (left side, clips right) -->
        <img class="ci-ov" id="COVI" src="https://i.imgur.com/RUwocO8h.jpeg" alt="Дубровиця 1944" draggable="false" decoding="async">

        <div class="CDL" id="CDIV"></div>

        <div class="CDH" id="CHDL">
          <div class="CDISC">
            <svg viewBox="0 0 24 24"><path d="M8.5 5L3 12l5.5 7V5zm7 0v14L21 12l-5.5-7z"/></svg>
          </div>
        </div>

        <div class="CCLB cll">
          <span class="ccy">1944</span>
          <span class="ccs">Аерофото · Люфтваффе</span>
        </div>
        <div class="CCLB clr">
          <span class="ccy">2021</span>
          <span class="ccs">Супутниковий знімок</span>
        </div>

        <div style="position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);z-index:16;pointer-events:none;
          display:inline-flex;align-items:center;gap:.4rem;padding:.3rem .8rem;
          background:rgba(8,6,4,.72);backdrop-filter:blur(8px);
          border:1px solid rgba(201,162,39,.2);border-radius:100px;
          font-family:'DM Sans',sans-serif;font-size:.58rem;letter-spacing:.06em;color:rgba(255,255,255,.45);white-space:nowrap;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" style="width:11px;height:11px;flex-shrink:0;color:#c9a227;opacity:.7;"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
          Аерофото колоризоване за допомогою ШІ
        </div>

        <div class="CIP" id="CHINT">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 19l-7-7 7-7"/></svg>
          Тягніть для порівняння
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5l7 7-7 7"/></svg>
        </div>
        <button class="SFS-BTN" onclick="openSliderFS('https://i.imgur.com/RUwocO8.jpeg','https://i.imgur.com/Oj9x49g.jpeg','1944 · Аерофото Люфтваффе','2021 · Супутниковий знімок')" title="Відкрити у повному екрані">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
        </button>
      </div>

      <div class="COBS">
        <div class="COB">
          <span class="COI">🏰</span>
          <p class="COT">Давнє городище</p>
          <p class="COD">На аерознімку 1944 р. внизу чітко видно контури давнього городища — залишки замку Дубровицьких князів. Замок знищили татари під час навали у XIII ст. У радянський час залишки городища були остаточно зрівняні з землею.</p>
        </div>
        <div class="COB">
          <span class="COI">🌊</span>
          <p class="COT">Старуха — нове життя старого русла</p>
          <p class="COD">На знімку 1944 р. добре видно старе русло Горині. Після меліорацій річку відвели в нове русло, а на місці старого утворилася водойма, яку місцеві досі називають «Старухою».</p>
        </div>
        <div class="COB">
          <span class="COI">✡️</span>
          <p class="COT">Єврейська забудова</p>
          <p class="COD">До 1942 р. євреї складали значну частину населення Дубровиці. На знімку 1944 р. видно будівлі єврейської громади — більшість з них зникла після Голокосту та Другої світової.</p>
        </div>
        <div class="COB">
          <span class="COI">🏟️</span>
          <p class="COT">Стадіон і нова забудова</p>
          <p class="COD">На сучасному знімку чітко видно стадіон і радянську забудову, що з'явилася після 1945 р. На місці пустирів і городів — вулиці та будинки.</p>
        </div>
      </div>
    </div>

    <script>
    (function(){
      var fr=document.getElementById('CSLIDER');
      var ov=document.getElementById('COVI');
      var dv=document.getElementById('CDIV');
      var hd=document.getElementById('CHDL');
      var drag=false,rafId=null,pendingX=null;

      function apply(p){
        p=Math.max(0,Math.min(100,p));
        ov.style.clipPath='inset(0 '+(100-p).toFixed(2)+'% 0 0)';
        dv.style.left=p+'%';
        hd.style.left=p+'%';
        fr.classList.add('cmoved');
      }
      function gp(cx){var r=fr.getBoundingClientRect();return((cx-r.left)/r.width)*100;}
      function onRAF(){rafId=null;if(pendingX!==null){apply(gp(pendingX));pendingX=null;}}
      function schedule(cx){pendingX=cx;if(!rafId)rafId=requestAnimationFrame(onRAF);}

      fr.addEventListener('mousedown',function(e){e.preventDefault();drag=true;fr.classList.add('cdrag');apply(gp(e.clientX));});
      window.addEventListener('mousemove',function(e){if(drag)schedule(e.clientX);});
      window.addEventListener('mouseup',function(){drag=false;fr.classList.remove('cdrag');});
      fr.addEventListener('touchstart',function(e){drag=true;fr.classList.add('cdrag');apply(gp(e.touches[0].clientX));},{passive:true});
      window.addEventListener('touchmove',function(e){if(drag)schedule(e.touches[0].clientX);},{passive:true});
      window.addEventListener('touchend',function(){drag=false;fr.classList.remove('cdrag');});

      /* intro: sweep right→left */
      var pos=80,run=true;
      function sw(){
        if(!run||drag)return;
        pos-=0.6;
        if(pos<=30){run=false;return;}
        apply(pos);
        requestAnimationFrame(sw);
      }
      setTimeout(function(){apply(80);requestAnimationFrame(sw);},600);
    })();
    </script>
    </section>
    <!-- ═══ END COMPARISON SLIDER ═══ -->

    <!-- ═══ PLATER ESTATE SECTION ═══ -->
    <section id="PLTR">
    <style>
    #PLTR{padding:5rem 0 6rem;background:#ede7db;position:relative;overflow:hidden;}
    [data-theme="dark"] #PLTR{background:#0a0907;}
    #PLTR::before{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 70% 50% at 50% 0%,rgba(139,90,43,.08) 0%,transparent 70%);
      pointer-events:none;}
    #PLTR *{box-sizing:border-box;}
    .PW{max-width:1240px;margin:0 auto;padding:0 2rem;}

    /* header */
    .PH{text-align:center;margin-bottom:3rem;}
    .PE{display:inline-flex;align-items:center;gap:.75rem;margin-bottom:1.2rem;}
    .PE::before,.PE::after{content:'';display:block;width:32px;height:1px;}
    .PE::before{background:linear-gradient(90deg,transparent,rgba(139,90,43,.6));}
    .PE::after{background:linear-gradient(90deg,rgba(139,90,43,.6),transparent);}
    .PE span{font-family:'DM Sans',sans-serif;font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:#a06830;}
    .PT{font-family:'Cormorant Garamond',serif;font-size:clamp(2.2rem,4vw,3.2rem);font-weight:300;
        color:#1c1917;line-height:1.1;margin:0 0 .6rem;}
    [data-theme="dark"] .PT{color:#f0e6c8;}
    .PT em{font-style:italic;color:#c8924a;}
    .PSB{font-family:'DM Sans',sans-serif;font-size:.8rem;letter-spacing:.1em;color:rgba(28,25,23,.45);margin:0;}
    [data-theme="dark"] .PSB{color:rgba(240,230,200,.35);}

    /* year strip */
    .PYR{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:1.5rem;margin:0 0 2rem;}
    .PYB{display:flex;flex-direction:column;gap:.2rem;}
    .PYB.pr{text-align:right;}
    .PYB .py{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;line-height:1;
             background:linear-gradient(135deg,#c8924a,#e8b870);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .PYB.pr .py{background:linear-gradient(135deg,#6aadf5,#a8d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .PYB .pl{font-size:.62rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(28,25,23,.4);}
    [data-theme="dark"] .PYB .pl{color:rgba(240,230,200,.3);}
    .PYB .pd{font-size:.72rem;font-family:'DM Sans',sans-serif;color:rgba(28,25,23,.5);margin-top:.1rem;}
    [data-theme="dark"] .PYB .pd{color:rgba(240,230,200,.5);}
    .PYD{text-align:center;font-size:1.4rem;color:rgba(200,146,74,.4);}
    [data-theme="dark"] .PYD{color:rgba(200,146,74,.3);}

    /* slider frame — same as CMP but separate IDs */
    .PSF{position:relative;width:100%;aspect-ratio:16/9;border-radius:3px;overflow:hidden;
         cursor:ew-resize;user-select:none;-webkit-user-select:none;
         box-shadow:0 0 0 1px rgba(200,146,74,.12),0 30px 80px rgba(0,0,0,.7);}
    @media(max-width:600px){.PSF{aspect-ratio:3/2;}}
    .PSF .pb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:block;
             filter:saturate(1.1) contrast(1.05) brightness(1.02);}
    .PSF .po{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:block;
             clip-path:inset(0 50% 0 0);will-change:clip-path;transform:translateZ(0);
             filter:contrast(1.15) brightness(1.08) saturate(0.04);}
    .PSF::after{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 55%,rgba(0,0,0,.45) 100%);
      pointer-events:none;z-index:5;}
    .PDL{position:absolute;top:0;bottom:0;left:50%;z-index:15;pointer-events:none;
         transform:translateX(-50%);width:1px;
         background:linear-gradient(to bottom,transparent 0%,rgba(255,255,255,.15) 4%,rgba(255,255,255,.9) 20%,#fff 50%,rgba(255,255,255,.9) 80%,rgba(255,255,255,.15) 96%,transparent 100%);}
    .PDH{position:absolute;top:50%;left:50%;z-index:20;
         transform:translate(-50%,-50%);pointer-events:none;
         display:flex;flex-direction:column;align-items:center;gap:0;}
    .PDH::before,.PDH::after{content:'';display:block;width:1px;height:28px;background:rgba(255,255,255,.7);}
    .PDISC{width:44px;height:44px;border-radius:50%;
           background:linear-gradient(135deg,#fff 0%,#f5ead0 100%);
           box-shadow:0 2px 20px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,.4);
           display:flex;align-items:center;justify-content:center;transition:transform .15s;}
    .PSF.pdrag .PDISC{transform:scale(1.12);}
    .PDISC svg{width:18px;height:18px;fill:#1a0e00;opacity:.7;}
    .PCLB{position:absolute;z-index:16;pointer-events:none;}
    .PCLB.pll{top:1.2rem;left:1.2rem;}
    .PCLB.plr{top:1.2rem;right:1.2rem;text-align:right;}
    .PCLB .pcy{display:block;font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:300;line-height:1;
               text-shadow:0 0 20px rgba(0,0,0,1),0 2px 8px rgba(0,0,0,1);}
    .PCLB.pll .pcy{color:#e8c080;}
    .PCLB.plr .pcy{color:#a8d8ff;}
    .PCLB .pcs{display:block;font-size:.6rem;letter-spacing:.14em;text-transform:uppercase;
               color:#fff;margin-top:.15rem;font-weight:500;
               text-shadow:0 1px 8px rgba(0,0,0,1),0 0 12px rgba(0,0,0,1);}
    .PIP{position:absolute;bottom:1.4rem;left:50%;transform:translateX(-50%);z-index:20;
         background:rgba(0,0,0,.6);backdrop-filter:blur(12px);
         border:1px solid rgba(255,255,255,.08);border-radius:100px;
         padding:.45rem 1.2rem .45rem 1rem;
         display:flex;align-items:center;gap:.6rem;
         font-size:.62rem;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.4);
         pointer-events:none;transition:opacity .5s;}
    .PIP svg{width:14px;height:14px;opacity:.5;flex-shrink:0;}
    .PSF.pmoved .PIP{opacity:0;}

    /* fact cards */
    .POBS{display:grid;grid-template-columns:repeat(4,1fr);gap:0;margin-top:3rem;}
    [data-theme="dark"] .POBS{background:transparent;}
    @media(max-width:900px){.POBS{grid-template-columns:repeat(2,1fr);}}
    @media(max-width:500px){.POBS{grid-template-columns:1fr;}}
    .POB{padding:2.4rem 2rem;background:transparent;position:relative;overflow:hidden;transition:background .22s;
         border-top:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .POB{border-top-color:rgba(255,255,255,.07);}
    .POB:not(:last-child){border-right:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .POB:not(:last-child){border-right-color:rgba(255,255,255,.07);}
    .POB::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
                 background:linear-gradient(90deg,transparent,rgba(200,146,74,.0),transparent);transition:background .22s;}
    .POB:hover{background:rgba(200,146,74,.04);}
    [data-theme="dark"] .POB:hover{background:rgba(200,146,74,.05);}
    .POB:hover::before{background:linear-gradient(90deg,transparent,rgba(200,146,74,.5),transparent);}
    .POI{font-size:2rem;margin-bottom:1.1rem;display:block;}
    .POT{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:500;color:#1c1917;margin-bottom:.7rem;line-height:1.2;}
    [data-theme="dark"] .POT{color:#e8c890;}
    .POD{font-size:.85rem;font-family:'DM Sans',sans-serif;font-weight:300;line-height:1.8;color:rgba(44,40,36,.65);}
    [data-theme="dark"] .POD{color:rgba(240,230,200,.45);}

    /* photo gallery */
    .PGL{margin-top:3rem;}
    .PGLH{font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:300;color:#1c1917;
          margin:0 0 1.2rem;display:flex;align-items:center;gap:.8rem;}
    [data-theme="dark"] .PGLH{color:#e0d0a8;}
    .PGLH::after{content:'';flex:1;height:1px;background:rgba(0,0,0,.1);}
    [data-theme="dark"] .PGLH::after{background:rgba(255,255,255,.06);}
    .PGRID{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;}
    @media(max-width:700px){.PGRID{grid-template-columns:1fr 1fr;}}
    @media(max-width:420px){.PGRID{grid-template-columns:1fr;}}
    .PGITEM{position:relative;border-radius:3px;overflow:hidden;cursor:pointer;
            aspect-ratio:4/3;background:#111;
            box-shadow:0 2px 12px rgba(0,0,0,.4);}
    .PGITEM img{width:100%;height:100%;object-fit:cover;display:block;
                filter:contrast(1.05) brightness(1.02);
                transition:transform .4s ease,filter .4s ease;}
    .PGITEM:hover img{transform:scale(1.04);filter:contrast(1.08) brightness(1.05);}
    .PGCAP{position:absolute;bottom:0;left:0;right:0;padding:.7rem .9rem;
           background:linear-gradient(to top,rgba(0,0,0,.85) 0%,transparent 100%);
           font-family:'DM Sans',sans-serif;font-size:.65rem;letter-spacing:.08em;
           color:rgba(255,255,255,.6);line-height:1.4;}

    /* lightbox */
    #PLB{position:fixed;inset:0;z-index:99999;background:rgba(4,3,2,.96);
         display:flex;align-items:center;justify-content:center;
         opacity:0;pointer-events:none;transition:opacity .24s;}
    #PLB.open{opacity:1;pointer-events:all;}
    #PLB img{max-width:92vw;max-height:88vh;object-fit:contain;border-radius:3px;}
    #PLB .plbc{position:absolute;top:1.2rem;right:1.4rem;width:40px;height:40px;
               background:rgba(255,255,255,.1);border:none;border-radius:50%;
               color:#fff;font-size:1.2rem;cursor:pointer;
               display:flex;align-items:center;justify-content:center;transition:background .15s;}
    #PLB .plbc:hover{background:rgba(255,255,255,.22);}
    #PLB .plbcap{position:absolute;bottom:1.5rem;left:50%;transform:translateX(-50%);
                 font-family:'DM Sans',sans-serif;font-size:.72rem;letter-spacing:.1em;
                 color:rgba(255,255,255,.4);white-space:nowrap;}
    </style>

    <div class="PW">
      <div class="PH">
        <div class="PE"><span>Втрачена спадщина · Воробин</span></div>
        <h2 class="PT">Маєток графів <em>Плятерів</em></h2>
        <p class="PSB">Перетягніть лінію — порівняйте маєток 1944 та 2021 рр.</p>
      </div>

      <div class="PYR">
        <div class="PYB">
          <span class="py">1944</span>
          <span class="pl">Аерофото Люфтваффе</span>
          <span class="pd">Маєток вже знищений</span>
        </div>
        <div class="PYD">↔</div>
        <div class="PYB pr">
          <span class="py">2021</span>
          <span class="pl">Супутник</span>
          <span class="pd">Воробинська лікарня</span>
        </div>
      </div>

      <div class="PSF" id="PSLIDER">
        <img class="pb" src="https://i.imgur.com/YH48cvzh.jpeg" alt="Маєток Плятерів 2021" draggable="false" decoding="async">
        <img class="po" id="POVI" src="https://i.imgur.com/aGqVNvZh.jpeg" alt="Маєток Плятерів 1944" draggable="false" decoding="async">
        <div class="PDL" id="PDIV"></div>
        <div class="PDH" id="PHDL">
          <div class="PDISC">
            <svg viewBox="0 0 24 24"><path d="M8.5 5L3 12l5.5 7V5zm7 0v14L21 12l-5.5-7z"/></svg>
          </div>
        </div>
        <div class="PCLB pll"><span class="pcy">1944</span><span class="pcs">Аерофото · Люфтваффе</span></div>
        <div class="PCLB plr"><span class="pcy">2021</span><span class="pcs">Супутниковий знімок</span></div>
        <div class="PIP" id="PHINT">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 19l-7-7 7-7"/></svg>
          Тягніть для порівняння
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5l7 7-7 7"/></svg>
        </div>
        <button class="SFS-BTN" onclick="openSliderFS('https://i.imgur.com/aGqVNvZ.jpeg','https://i.imgur.com/YH48cvz.jpeg','1944 · Аерофото Люфтваффе','2021 · Супутниковий знімок')" title="Відкрити у повному екрані">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
        </button>
      </div>

      <div class="POBS">
        <div class="POB">
          <span class="POI">🏰</span>
          <p class="POT">Маєток Плятерів у Воробині</p>
          <p class="POD">Розкішний маєтковий комплекс графів Плятерів з палацом, парком, ставками та господарськими будівлями. Один з найвизначніших шляхетських маєтків Волинського Полісся.</p>
        </div>
        <div class="POB">
          <span class="POI">⚔️</span>
          <p class="POT">Пограбування та занепад</p>
          <p class="POD">Після революції 1917 р. маєток був пограбований. У 1920–1930-х рр. будівлі стояли порожніми і руйнувалися. Фотографії тих років фіксують вже розграбований, але ще існуючий палац.</p>
        </div>
        <div class="POB">
          <span class="POI">💥</span>
          <p class="POT">Знищений під час війни</p>
          <p class="POD">На аерофотознімку Люфтваффе 1944 р. від маєтку не лишилося майже нічого — лише контури фундаментів і залишки парку. До 1944 р. палацу вже не існувало.</p>
        </div>
        <div class="POB">
          <span class="POI">🏥</span>
          <p class="POT">Сьогодні — Воробинська лікарня</p>
          <p class="POD">На місці колишнього маєтку тепер розташована центральна міська лікарня Дубровиці — в народі «Воробинська». Від розкішного палацу не лишилося жодного сліду.</p>
        </div>
      </div>

      <!-- Photo Gallery -->
      <div class="PGL">
        <p class="PGLH">Архівні фотографії маєтку</p>
        <div style="display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .85rem;background:rgba(201,162,39,.08);border:1px solid rgba(201,162,39,.22);border-radius:100px;margin-bottom:1rem;font-family:'DM Sans',sans-serif;font-size:.65rem;color:rgba(28,25,23,.55);letter-spacing:.04em;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" style="width:13px;height:13px;flex-shrink:0;color:#c9a227;"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
          Деякі фотографії колоризовані за допомогою ШІ
        </div>
        <div class="PGRID">
          <div class="PGITEM" onclick="openPLB(this)">
            <img src="https://i.imgur.com/jpyssNA.jpeg" alt="Палац Плятерів 1925" loading="lazy" style="object-position:top;">
            <div class="PGCAP">Палац в 1925 році</div>
          </div>
          <div class="PGITEM" onclick="openPLB(this)">
            <img src="https://i.imgur.com/CT4rMSK.jpeg" alt="Пограбований маєток 1920-1930" loading="lazy">
            <div class="PGCAP">Пограбований маєток · 1920–1930 рр.</div>
          </div>
          <div class="PGITEM" onclick="openPLB(this)">
            <img src="https://i.imgur.com/5SOfOuh.jpeg" alt="Пограбований маєток 1920-1930" loading="lazy">
            <div class="PGCAP">Пограбований маєток · 1920–1930 рр.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lightbox -->
    <div id="PLB">
      <button class="plbc" onclick="document.getElementById('PLB').classList.remove('open')">&#x2715;</button>
      <img id="PLBI" src="" alt="">
      <div class="plbcap" id="PLBCAP"></div>
    </div>

    <script>
    /* Plater slider */
    (function(){
      var fr=document.getElementById('PSLIDER'),ov=document.getElementById('POVI'),
          dv=document.getElementById('PDIV'),hd=document.getElementById('PHDL');
      var drag=false,rafId=null,pendingX=null;
      function apply(p){
        p=Math.max(0,Math.min(100,p));
        ov.style.clipPath='inset(0 '+(100-p).toFixed(2)+'% 0 0)';
        dv.style.left=p+'%'; hd.style.left=p+'%';
        fr.classList.add('pmoved');
      }
      function gp(cx){var r=fr.getBoundingClientRect();return((cx-r.left)/r.width)*100;}
      function onRAF(){rafId=null;if(pendingX!==null){apply(gp(pendingX));pendingX=null;}}
      function schedule(cx){pendingX=cx;if(!rafId)rafId=requestAnimationFrame(onRAF);}
      fr.addEventListener('mousedown',function(e){e.preventDefault();drag=true;fr.classList.add('pdrag');apply(gp(e.clientX));});
      window.addEventListener('mousemove',function(e){if(drag)schedule(e.clientX);});
      window.addEventListener('mouseup',function(){drag=false;fr.classList.remove('pdrag');});
      fr.addEventListener('touchstart',function(e){drag=true;fr.classList.add('pdrag');apply(gp(e.touches[0].clientX));},{passive:true});
      window.addEventListener('touchmove',function(e){if(drag)schedule(e.touches[0].clientX);},{passive:true});
      window.addEventListener('touchend',function(){drag=false;fr.classList.remove('pdrag');});
      var pos=80,run=true;
      function sw(){if(!run||drag)return;pos-=0.6;if(pos<=30){run=false;return;}apply(pos);requestAnimationFrame(sw);}
      setTimeout(function(){apply(80);requestAnimationFrame(sw);},1000);
    })();

    /* Lightbox */
    function openPLB(el){
      var img=el.querySelector('img'), cap=el.querySelector('.PGCAP');
      document.getElementById('PLBI').src=img.src;
      document.getElementById('PLBCAP').textContent=cap?cap.textContent:'';
      document.getElementById('PLB').classList.add('open');
    }
    document.getElementById('PLB').addEventListener('click',function(e){
      if(e.target===this)this.classList.remove('open');
    });
    document.addEventListener('keydown',function(e){
      if(e.key==='Escape')document.getElementById('PLB').classList.remove('open');
    });
    </script>
    </section>
    <!-- ═══ END PLATER SECTION ═══ -->

    <!-- ═══ WIDE AREA COMPARISON ═══ -->
    <section id="WIDE">
    <style>
    #WIDE{padding:5rem 0 6rem;background:#f4efe7;position:relative;overflow:hidden;}
    [data-theme="dark"] #WIDE{background:#080b0d;}
    #WIDE::before{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 70% 50% at 50% 0%,rgba(42,90,139,.08) 0%,transparent 70%);
      pointer-events:none;}
    #WIDE *{box-sizing:border-box;}
    .WW{max-width:1240px;margin:0 auto;padding:0 2rem;}
    .WW-FULL{width:100%;} /* full-bleed wrapper for the slider */
    .WH{text-align:center;margin-bottom:3rem;}
    .WE{display:inline-flex;align-items:center;gap:.75rem;margin-bottom:1.2rem;}
    .WE::before,.WE::after{content:'';display:block;width:32px;height:1px;}
    .WE::before{background:linear-gradient(90deg,transparent,rgba(42,100,180,.5));}
    .WE::after{background:linear-gradient(90deg,rgba(42,100,180,.5),transparent);}
    .WE span{font-family:'DM Sans',sans-serif;font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:#4a80c0;}
    .WT{font-family:'Cormorant Garamond',serif;font-size:clamp(2.2rem,4vw,3.2rem);font-weight:300;
        color:#1c1917;line-height:1.1;margin:0 0 .6rem;}
    [data-theme="dark"] .WT{color:#f0e6c8;}
    .WT em{font-style:italic;color:#7ab0e0;}
    .WSB{font-family:'DM Sans',sans-serif;font-size:.8rem;letter-spacing:.1em;color:rgba(28,25,23,.45);margin:0;}
    [data-theme="dark"] .WSB{color:rgba(240,230,200,.35);}
    /* year strip */
    .WYR{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:1.5rem;margin:0 0 1.5rem;}
    @media(max-width:600px){.WYR{gap:.5rem;margin-bottom:1rem;}}
    .WYB{display:flex;flex-direction:column;gap:.2rem;}
    .WYB.wr{text-align:right;}
    .WYB .wy{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;line-height:1;
             background:linear-gradient(135deg,#c9a227,#f0c840);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    @media(max-width:600px){.WYB .wy{font-size:2rem;}}
    .WYB.wr .wy{background:linear-gradient(135deg,#6aadf5,#a8d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .WYB .wl{font-size:.62rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(28,25,23,.4);}
    @media(max-width:600px){.WYB .wl{font-size:.5rem;letter-spacing:.1em;}}
    [data-theme="dark"] .WYB .wl{color:rgba(240,230,200,.3);}
    .WYB .wd{font-size:.72rem;font-family:'DM Sans',sans-serif;color:rgba(28,25,23,.5);margin-top:.1rem;}
    @media(max-width:600px){.WYB .wd{font-size:.6rem;}}
    [data-theme="dark"] .WYB .wd{color:rgba(240,230,200,.5);}
    .WYD{text-align:center;font-size:1.4rem;color:rgba(42,100,180,.4);}
    [data-theme="dark"] .WYD{color:rgba(42,100,180,.3);}
    /* slider */
    .WSF{position:relative;width:100%;max-width:1160px;margin:0 auto;aspect-ratio:16/9;max-height:70vh;border-radius:12px;overflow:hidden;
         cursor:ew-resize;user-select:none;-webkit-user-select:none;
         box-shadow:0 8px 40px rgba(0,0,0,0.18);}
    @media(max-width:600px){.WSF{aspect-ratio:4/3;max-height:none;border-radius:6px;cursor:default;}}
    .WSF .wb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:block;
             filter:saturate(1.15) contrast(1.06) brightness(1.03);}
    .WSF .wo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:block;
             clip-path:inset(0 50% 0 0);will-change:clip-path;transform:translateZ(0);
             filter:contrast(1.12) brightness(1.06) saturate(0.05);}
    .WSF::after{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 55%,rgba(0,0,0,.3) 100%);
      pointer-events:none;z-index:5;}
    .WDL{position:absolute;top:0;bottom:0;left:50%;z-index:15;pointer-events:none;
         transform:translateX(-50%);width:1px;
         background:linear-gradient(to bottom,transparent 0%,rgba(255,255,255,.15) 4%,rgba(255,255,255,.9) 20%,#fff 50%,rgba(255,255,255,.9) 80%,rgba(255,255,255,.15) 96%,transparent 100%);}
    .WDH{position:absolute;top:50%;left:50%;z-index:20;
         transform:translate(-50%,-50%);pointer-events:none;
         display:flex;flex-direction:column;align-items:center;}
    .WDH::before,.WDH::after{content:'';display:block;width:1px;height:28px;background:rgba(255,255,255,.7);}
    .WDISC{width:44px;height:44px;border-radius:50%;
           background:linear-gradient(135deg,#fff 0%,#e8f0ff 100%);
           box-shadow:0 2px 20px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,.4);
           display:flex;align-items:center;justify-content:center;transition:transform .15s;}
    .WSF.wdrag .WDISC{transform:scale(1.12);}
    .WDISC svg{width:18px;height:18px;fill:#001428;opacity:.7;}
    .WCLB{position:absolute;z-index:16;pointer-events:none;}
    .WCLB.wll{top:1.2rem;left:1.2rem;}
    .WCLB.wlr{top:1.2rem;right:1.2rem;text-align:right;}
    .WCLB .wcy{display:block;font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:300;line-height:1;
               text-shadow:0 0 20px rgba(0,0,0,1),0 2px 8px rgba(0,0,0,1);}
    .WCLB.wll .wcy{color:#f5d060;}
    .WCLB.wlr .wcy{color:#a8d8ff;}
    .WCLB .wcs{display:block;font-size:.6rem;letter-spacing:.14em;text-transform:uppercase;
               color:#fff;margin-top:.15rem;font-weight:500;
               text-shadow:0 1px 8px rgba(0,0,0,1),0 0 12px rgba(0,0,0,1);}
    .WIP{position:absolute;bottom:1.4rem;left:50%;transform:translateX(-50%);z-index:20;
         background:rgba(0,0,0,.6);backdrop-filter:blur(12px);
         border:1px solid rgba(255,255,255,.08);border-radius:100px;
         padding:.45rem 1.2rem .45rem 1rem;display:flex;align-items:center;gap:.6rem;
         font-size:.62rem;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.4);
         pointer-events:none;transition:opacity .5s;}
    .WIP svg{width:14px;height:14px;opacity:.5;flex-shrink:0;}
    .WSF.wmoved .WIP{opacity:0;}
    /* cards */
    .WOBS{display:grid;grid-template-columns:repeat(4,1fr);gap:0;margin-top:3rem;}
    [data-theme="dark"] .WOBS{background:transparent;}
    @media(max-width:900px){.WOBS{grid-template-columns:repeat(2,1fr);}}
    @media(max-width:500px){.WOBS{grid-template-columns:1fr;}}
    .WOB{padding:2.4rem 2rem;background:transparent;position:relative;overflow:hidden;transition:background .22s;
         border-top:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .WOB{border-top-color:rgba(255,255,255,.07);}
    .WOB:not(:last-child){border-right:1px solid rgba(0,0,0,.08);}
    [data-theme="dark"] .WOB:not(:last-child){border-right-color:rgba(255,255,255,.07);}
    .WOB::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
                 background:linear-gradient(90deg,transparent,rgba(42,100,180,.0),transparent);transition:background .22s;}
    .WOB:hover{background:rgba(42,100,180,.04);}
    [data-theme="dark"] .WOB:hover{background:rgba(42,100,180,.05);}
    .WOB:hover::before{background:linear-gradient(90deg,transparent,rgba(42,100,180,.5),transparent);}
    .WOI{font-size:2rem;margin-bottom:1.1rem;display:block;}
    .WOT{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:500;color:#1c1917;margin-bottom:.7rem;line-height:1.2;}
    [data-theme="dark"] .WOT{color:#b8d0f0;}
    .WOD{font-size:.85rem;font-family:'DM Sans',sans-serif;font-weight:300;line-height:1.8;color:rgba(44,40,36,.65);}
    [data-theme="dark"] .WOD{color:rgba(240,230,200,.45);}
    </style>

    <div class="WW">
      <div class="WH">
        <div class="WE"><span>Дубровиця та околиці · Широкий огляд</span></div>
        <h2 class="WT">Регіон у розрізі часу:<br><em>1943 та 2021</em></h2>
        <p class="WSB">Місто, дороги та три сусідні села — Крупове, Острівці, Мочулище</p>
      </div>

      <div class="WYR">
        <div class="WYB">
          <span class="wy">1943</span>
          <span class="wl">Аерофото Люфтваффе</span>
          <span class="wd">Жовтень 1943 р.</span>
        </div>
        <div class="WYD">↔</div>
        <div class="WYB wr">
          <span class="wy">2021</span>
          <span class="wl">Супутник</span>
          <span class="wd">Google Maps</span>
        </div>
      </div>
    </div><!-- /WW —  slider is full-bleed -->

      <div class="WSF" id="WSLIDER">
        <img class="wb" src="https://i.imgur.com/YlJ1Rkgh.jpeg" alt="Регіон 2021" draggable="false" decoding="async" loading="lazy">
        <img class="wo" id="WOVI" src="https://i.imgur.com/qeHvndZh.jpeg" alt="Регіон 1943" draggable="false" decoding="async" loading="lazy">
        <div class="WDL" id="WDIV"></div>
        <div class="WDH" id="WHDL">
          <div class="WDISC">
            <svg viewBox="0 0 24 24"><path d="M8.5 5L3 12l5.5 7V5zm7 0v14L21 12l-5.5-7z"/></svg>
          </div>
        </div>
        <div class="WCLB wll"><span class="wcy">1943</span><span class="wcs">Аерофото · Люфтваффе</span></div>
        <div class="WCLB wlr"><span class="wcy">2021</span><span class="wcs">Супутниковий знімок</span></div>
        <div class="WIP">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 19l-7-7 7-7"/></svg>
          Тягніть для порівняння
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5l7 7-7 7"/></svg>
        </div>
        <button class="SFS-BTN" onclick="openSliderFS('https://i.imgur.com/qeHvndZ.jpeg','https://i.imgur.com/YlJ1Rkg.jpeg','1943 · Аерофото Люфтваффе','2021 · Супутниковий знімок')" title="Відкрити у повному екрані">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
        </button>
      </div>

    <div class="WW"><!-- re-open WW for cards -->
      <div class="WOBS">
        <div class="WOB">
          <span class="WOI">🛣️</span>
          <p class="WOT">Дороги та планування</p>
          <p class="WOD">На аерофото 1943 р. добре видно основну дорожню мережу регіону. Головні дороги збереглися до сьогодні — місто зросло навколо тих самих осей.</p>
        </div>
        <div class="WOB">
          <span class="WOI">🏘️</span>
          <p class="WOT">Крупове, Острівці, Мочулище</p>
          <p class="WOD">Три сусідні села видно на обох знімках. Порівняйте, як змінилася їх забудова і розміри за 78 років — деякі виросли, інші майже не змінилися.</p>
        </div>
        <div class="WOB">
          <span class="WOI">🌲</span>
          <p class="WOT">Ліси та поля</p>
          <p class="WOD">Лісові масиви навколо Дубровиці суттєво змінилися. На сучасному знімку видно нові лісопосадки та зміни у сільськогосподарських угіддях регіону.</p>
        </div>
        <div class="WOB">
          <span class="WOI">📈</span>
          <p class="WOT">Ріст міста</p>
          <p class="WOD">Порівняння чітко показує, як Дубровиця розширилася за 78 років — нові квартали, вулиці та інфраструктура, яких не існувало у воєнні роки.</p>
        </div>
      </div>
    </div><!-- /WW cards -->

    <script>
    (function(){
      var fr=document.getElementById('WSLIDER'),ov=document.getElementById('WOVI'),
          dv=document.getElementById('WDIV'),hd=document.getElementById('WHDL');
      var drag=false,rafId=null,pendingX=null;
      function apply(p){
        p=Math.max(0,Math.min(100,p));
        ov.style.clipPath='inset(0 '+(100-p).toFixed(2)+'% 0 0)';
        dv.style.left=p+'%'; hd.style.left=p+'%';
        fr.classList.add('wmoved');
      }
      function gp(cx){var r=fr.getBoundingClientRect();return((cx-r.left)/r.width)*100;}
      function onRAF(){rafId=null;if(pendingX!==null){apply(gp(pendingX));pendingX=null;}}
      function schedule(cx){pendingX=cx;if(!rafId)rafId=requestAnimationFrame(onRAF);}
      fr.addEventListener('mousedown',function(e){e.preventDefault();drag=true;fr.classList.add('wdrag');apply(gp(e.clientX));});
      window.addEventListener('mousemove',function(e){if(drag)schedule(e.clientX);});
      window.addEventListener('mouseup',function(){drag=false;fr.classList.remove('wdrag');});
      fr.addEventListener('touchstart',function(e){drag=true;fr.classList.add('wdrag');apply(gp(e.touches[0].clientX));},{passive:true});
      window.addEventListener('touchmove',function(e){if(drag)schedule(e.touches[0].clientX);},{passive:true});
      window.addEventListener('touchend',function(){drag=false;fr.classList.remove('wdrag');});
      var pos=80,run=true;
      function sw(){if(!run||drag)return;pos-=0.6;if(pos<=30){run=false;return;}apply(pos);requestAnimationFrame(sw);}
      setTimeout(function(){apply(80);requestAnimationFrame(sw);},1200);
    })();
    </script>
    </section>
    <!-- ═══ END WIDE AREA COMPARISON ═══ -->
    <!-- ═══ HORIZONTAL TIMELINE ═══ -->
    <section id="HTL">
    <style>
    /* ════════════════════════════════════════
       TIMELINE REDESIGN — Refined & Spacious
    ════════════════════════════════════════ */
    #HTL {
        padding: 7rem 0 0;
        background: #faf7f2;
        position: relative;
        overflow: hidden;
    }
    [data-theme="dark"] #HTL { background: #0d0b09; }
    #HTL * { box-sizing: border-box; }

    /* Subtle grain texture overlay */
    #HTL::before {
        content: '';
        position: absolute; inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
        pointer-events: none; z-index: 0; opacity: .6;
    }

    /* ── HEAD ── */
    .HTL-HEAD {
        text-align: center;
        margin-bottom: 4rem;
        padding: 0 2rem;
        position: relative; z-index: 1;
    }
    .HTL-EYEBROW {
        display: inline-flex; align-items: center; gap: 1rem; margin-bottom: 1.2rem;
    }
    .HTL-EYEBROW::before, .HTL-EYEBROW::after {
        content: ''; display: block; width: 48px; height: 1px;
    }
    .HTL-EYEBROW::before { background: linear-gradient(90deg, transparent, rgba(201,162,39,.6)); }
    .HTL-EYEBROW::after  { background: linear-gradient(90deg, rgba(201,162,39,.6), transparent); }
    .HTL-EYEBROW span {
        font-family: 'DM Sans', sans-serif; font-size: .62rem;
        letter-spacing: .34em; text-transform: uppercase; color: #c9a227;
    }
    .HTL-TITLE {
        font-family: 'Cormorant Garamond', Georgia, serif;
        font-size: clamp(2.4rem, 4.5vw, 3.6rem); font-weight: 300;
        color: #1c1917; line-height: 1.08; margin: 0 0 .75rem;
    }
    [data-theme="dark"] .HTL-TITLE { color: #f0e6c8; }
    .HTL-TITLE em { font-style: italic; color: #c9a227; font-weight: 400; }
    .HTL-SUB {
        font-family: 'DM Sans', sans-serif; font-size: .78rem;
        letter-spacing: .12em; color: rgba(28,25,23,.38); margin: 0;
    }
    [data-theme="dark"] .HTL-SUB { color: rgba(240,230,200,.28); }

    /* ── TRACK ── */
    .HTL-TRACK {
        overflow-x: auto;
        overflow-y: hidden;
        padding: 0 6vw 3rem;
        cursor: grab;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: rgba(201,162,39,.25) transparent;
        position: relative; z-index: 1;
    }
    .HTL-TRACK:active { cursor: grabbing; }
    .HTL-TRACK::-webkit-scrollbar { height: 2px; }
    .HTL-TRACK::-webkit-scrollbar-track { background: transparent; }
    .HTL-TRACK::-webkit-scrollbar-thumb { background: rgba(201,162,39,.25); border-radius: 2px; }

    /* ── ROW ── */
    .HTL-ROW {
        display: inline-flex;
        align-items: stretch;
        position: relative;
        height: 760px;
        padding: 0 3rem;
        min-width: max-content;
        gap: 0;
    }

    /* ── SPINE ── */
    .HTL-SPINE {
        position: absolute;
        top: 50%; left: 0; right: 0;
        height: 1px;
        transform: translateY(-50%);
        background: linear-gradient(90deg,
            transparent 0%,
            rgba(201,162,39,.15) 1%,
            rgba(201,162,39,.45) 8%,
            rgba(201,162,39,.55) 50%,
            rgba(201,162,39,.45) 92%,
            rgba(201,162,39,.15) 99%,
            transparent 100%);
        pointer-events: none; z-index: 0;
    }
    /* Second glow line */
    .HTL-SPINE::after {
        content: '';
        position: absolute; top: -1px; left: 0; right: 0; bottom: -1px;
        background: inherit;
        filter: blur(3px);
        opacity: .5;
    }

    /* ── ITEM ── */
    .HTL-ITEM {
        position: relative;
        width: 290px;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
        padding: 0 14px;
        transition: transform .35s cubic-bezier(.25,.46,.45,.94);
        opacity: 0;
        transform: translateY(18px);
    }
    .HTL-ITEM.htl-visible {
        opacity: 1;
        transform: translateY(0);
        transition: opacity .6s ease, transform .6s cubic-bezier(.25,.46,.45,.94);
    }
    .HTL-ITEM:hover { transform: translateY(-5px) !important; }

    /* ── TOP / BOTTOM halves ── */
    .HTL-TOP {
        height: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        padding-bottom: 28px;
        width: 100%;
    }
    .HTL-BOTTOM {
        height: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 28px;
        width: 100%;
    }

    /* ── DOT ── */
    .HTL-DOT {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 16px; height: 16px;
        border-radius: 50%;
        background: radial-gradient(circle at 35% 35%, #e8c84a, #c9a227);
        border: 2.5px solid #faf7f2;
        box-shadow:
            0 0 0 4px rgba(201,162,39,.18),
            0 0 0 7px rgba(201,162,39,.07),
            0 3px 12px rgba(0,0,0,.22);
        z-index: 2;
        transition: transform .3s ease, box-shadow .3s ease;
    }
    [data-theme="dark"] .HTL-DOT {
        border-color: #0d0b09;
        box-shadow: 0 0 0 4px rgba(201,162,39,.22), 0 0 0 8px rgba(201,162,39,.08), 0 3px 12px rgba(0,0,0,.5);
    }
    .HTL-ITEM:hover .HTL-DOT {
        transform: translate(-50%, -50%) scale(1.55);
        box-shadow: 0 0 0 6px rgba(201,162,39,.25), 0 0 0 11px rgba(201,162,39,.1), 0 4px 16px rgba(0,0,0,.3);
    }

    /* ── CONNECTOR LINES ── */
    .HTL-LINE-UP {
        width: 1px; flex: 1;
        background: linear-gradient(to bottom, transparent 0%, rgba(201,162,39,.4) 100%);
        margin-top: 10px;
    }
    .HTL-LINE-DOWN {
        width: 1px; flex: 1;
        background: linear-gradient(to top, transparent 0%, rgba(201,162,39,.4) 100%);
        margin-bottom: 10px;
    }

    /* ── PHOTO ── */
    .HTL-PHOTO {
        width: 168px;
        height: 114px;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        box-shadow:
            0 0 0 1px rgba(201,162,39,.18),
            0 8px 32px rgba(0,0,0,.2),
            0 2px 8px rgba(0,0,0,.12);
        background: #1a1208;
        flex-shrink: 0;
    }
    .HTL-PHOTO img {
        width: 100%; height: 100%; object-fit: cover;
        filter: sepia(.22) contrast(1.05) brightness(.97);
        transition: transform .55s cubic-bezier(.25,.46,.45,.94), filter .55s ease;
        display: block;
    }
    .HTL-ITEM:hover .HTL-PHOTO img {
        transform: scale(1.07);
        filter: sepia(.05) contrast(1.1) brightness(1.02);
    }
    /* gradient overlay on photo */
    .HTL-PHOTO::after {
        content: '';
        position: absolute; inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,.45) 0%, rgba(0,0,0,.05) 50%, transparent 100%);
        pointer-events: none;
    }
    /* gold top edge accent */
    .HTL-PHOTO::before {
        content: '';
        position: absolute; top: 0; left: 0; right: 0; height: 2px;
        background: linear-gradient(90deg, transparent, rgba(201,162,39,.6), transparent);
        z-index: 2; pointer-events: none;
    }

    /* ── NO-IMG placeholder ── */
    .HTL-PHOTO.no-img {
        background: linear-gradient(145deg,
            rgba(201,162,39,.09) 0%,
            rgba(201,162,39,.03) 50%,
            rgba(180,140,30,.07) 100%);
        border: 1px solid rgba(201,162,39,.18);
        display: flex; align-items: center; justify-content: center;
        font-size: 2.6rem;
        backdrop-filter: blur(4px);
    }
    [data-theme="dark"] .HTL-PHOTO.no-img {
        background: linear-gradient(145deg, rgba(201,162,39,.1), rgba(201,162,39,.04));
        border-color: rgba(201,162,39,.2);
    }
    .HTL-PHOTO.no-img img { display: none; }
    .HTL-PHOTO.no-img::after { display: none; }
    .HTL-PHOTO.no-img::before { display: none; }

    /* ── TEXT BLOCK ── */
    .HTL-TEXT {
        text-align: center;
        max-width: 220px;
        padding: 0 4px;
    }
    .HTL-YEAR {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.85rem; font-weight: 500; line-height: 1;
        background: linear-gradient(135deg, #b8891e 0%, #ddb830 45%, #c9a227 100%);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        background-clip: text;
        display: block; margin-bottom: .45rem;
        letter-spacing: -.01em;
    }
    .HTL-ETITLE {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.05rem; font-weight: 600;
        color: #1c1917; line-height: 1.32; margin: 0 0 .45rem;
        letter-spacing: .01em;
    }
    [data-theme="dark"] .HTL-ETITLE { color: #e8d8b8; }
    .HTL-EDESC {
        font-family: 'DM Sans', sans-serif;
        font-size: .72rem; font-weight: 400;
        line-height: 1.65; color: rgba(44,40,36,.52);
        letter-spacing: .01em;
    }
    [data-theme="dark"] .HTL-EDESC { color: rgba(240,230,200,.38); }

    /* ── CTA ── */
    .HTL-CTA {
        text-align: center;
        padding: 2rem 0 5rem;
        position: relative; z-index: 1;
    }
    .HTL-CTA a {
        display: inline-flex; align-items: center; gap: .6rem;
        font-family: 'DM Sans', sans-serif; font-size: .68rem;
        letter-spacing: .22em; text-transform: uppercase;
        color: #c9a227; text-decoration: none;
        padding: .8rem 2.2rem;
        border: 1px solid rgba(201,162,39,.35);
        border-radius: 2px;
        transition: background .25s ease, color .25s ease, border-color .25s ease, box-shadow .25s ease;
        position: relative;
    }
    .HTL-CTA a::before {
        content: '';
        position: absolute; inset: 0;
        background: rgba(201,162,39,.04);
        border-radius: 2px;
    }
    .HTL-CTA a:hover {
        background: #c9a227; color: #0f0a00;
        border-color: #c9a227;
        box-shadow: 0 4px 24px rgba(201,162,39,.3);
    }
    .HTL-CTA a svg { width: 13px; height: 13px; }

    @media (max-width: 600px) {
        .HTL-ROW { height: 600px; }
        .HTL-ITEM { width: 230px; }
        .HTL-PHOTO { width: 138px; height: 94px; }
        .HTL-YEAR { font-size: 1.5rem; }
        .HTL-HEAD { margin-bottom: 2.5rem; }
        #HTL { padding: 4rem 0 0; }
    }
    </style>

    <div class="HTL-HEAD">
        <div class="HTL-EYEBROW"><span>1005 — сьогодення</span></div>
        <h2 class="HTL-TITLE">Ключові моменти <em>історії</em></h2>
        <p class="HTL-SUB">Понад тисяча років живої пам'яті — гортайте вправо</p>
    </div>

    <div class="HTL-TRACK" id="htlTrack">
      <div class="HTL-ROW">
        <div class="HTL-SPINE"></div>

        <!-- 1: 1005 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/ZKkcU77t.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1005</span>
              <p class="HTL-ETITLE">Перша писемна згадка</p>
              <p class="HTL-EDESC">Дубровиця в переліку міст Турівської єпархії за часів Володимира Великого</p>
            </div>
          </div>
        </div>

        <!-- 2: XII ст. -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">XII ст.</span>
              <p class="HTL-ETITLE">Столиця удільного князівства</p>
              <p class="HTL-EDESC">Дубровиця стає центром окремого Дубровицького удільного князівства</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">⚔️</div>
          </div>
        </div>

        <!-- 3: 1240 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO no-img">🔥</div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1240</span>
              <p class="HTL-ETITLE">Монгольська навала</p>
              <p class="HTL-EDESC">Орда Батия зруйнувала місто. Кінець Дубровицького удільного князівства</p>
            </div>
          </div>
        </div>

        <!-- 4: 1571 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1571</span>
              <p class="HTL-ETITLE">Андрій Курбський</p>
              <p class="HTL-EDESC">Московський боярин-втікач, що осів на Волині, одержує Дубровицю як придане від місцевої княгині</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">👑</div>
          </div>
        </div>

        <!-- 5: 1695–1702 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/n74FSvKt.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1695–1702</span>
              <p class="HTL-ETITLE">Костел Іоана Хрестителя</p>
              <p class="HTL-EDESC">Зведення барочного костелу та колегіуму піярів — пам'ятка національного значення</p>
            </div>
          </div>
        </div>

        <!-- 6: 1795 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1795</span>
              <p class="HTL-ETITLE">Загарбання Російською імперією</p>
              <p class="HTL-EDESC">Після третього поділу Польщі Волинь анексована Росією. Початок тривалого колоніального гніту — заборони мови, церков, культури</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">🦅</div>
          </div>
        </div>

        <!-- 7: 1862 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/0HyroRqt.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1862</span>
              <p class="HTL-ETITLE">Церква Різдва Богородиці</p>
              <p class="HTL-EDESC">Зведення православного храму — нині пам'ятка архітектури та культури</p>
            </div>
          </div>
        </div>

        <!-- 8: 1920–1939 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1920–1939</span>
              <p class="HTL-ETITLE">У складі Польщі</p>
              <p class="HTL-EDESC">Дубровиця у Волинському воєводстві — регіональний центр торгівлі та культури</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/qcjgN1It.jpeg" alt="" loading="lazy"></div>
          </div>
        </div>

        <!-- 9: 1940 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/WzMH0hht.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1940</span>
              <p class="HTL-ETITLE">Офіційний статус міста</p>
              <p class="HTL-EDESC">Дубровиця отримує статус міста та стає центром Дубровицького району</p>
            </div>
          </div>
        </div>

        <!-- 10: 1943 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1943</span>
              <p class="HTL-ETITLE">Дубровиця під контролем УПА</p>
              <p class="HTL-EDESC">Навесні підрозділи УПА атакували нацистський гарнізон. Місто перейшло під контроль повстанців</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/zef8WRyt.jpeg" alt="" loading="lazy"></div>
          </div>
        </div>

        <!-- 11: 1944 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/CImFE7St.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1944</span>
              <p class="HTL-ETITLE">Вхід Червоної армії</p>
              <p class="HTL-EDESC">10 січня — вхід радянських військ. 15 серпня — місто отримує сучасну назву Дубровиця</p>
            </div>
          </div>
        </div>

        <!-- 12: 1945 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1945</span>
              <p class="HTL-ETITLE">Повоєнна відбудова</p>
              <p class="HTL-EDESC">Зведено 412-метровий дерев'яний міст через Горинь — один з найбільших в Україні</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">🏗️</div>
          </div>
        </div>

        <!-- 13: 1960–80-ті -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO"><img src="https://i.imgur.com/irxrwBot.jpeg" alt="" loading="lazy"></div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1960–80-ті</span>
              <p class="HTL-ETITLE">Радянська доба</p>
              <p class="HTL-EDESC">Форсована індустріалізація та колективізація. Придушення релігії та української ідентичності</p>
            </div>
          </div>
        </div>

        <!-- 14: 1991 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">1991</span>
              <p class="HTL-ETITLE">Незалежна Україна</p>
              <p class="HTL-EDESC">Початок нового розділу. Відновлення храмів, реформування місцевого самоврядування</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">🇺🇦</div>
          </div>
        </div>

        <!-- 15: 2005 -->
        <div class="HTL-ITEM">
          <div class="HTL-TOP">
            <div class="HTL-PHOTO no-img">🎉</div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">2005</span>
              <p class="HTL-ETITLE">1000-ліття Дубровиці</p>
              <p class="HTL-EDESC">Державне святкування тисячолітнього ювілею міста</p>
            </div>
          </div>
        </div>

        <!-- 16: 2020 -->
        <div class="HTL-ITEM" style="margin-right:3rem;">
          <div class="HTL-TOP">
            <div class="HTL-TEXT">
              <span class="HTL-YEAR">2020</span>
              <p class="HTL-ETITLE">Адміністративна реформа</p>
              <p class="HTL-EDESC">Ліквідація Дубровицького району. Утворення міської громади в Сарненському районі</p>
            </div>
            <div class="HTL-LINE-UP"></div>
          </div>
          <div class="HTL-DOT"></div>
          <div class="HTL-BOTTOM">
            <div class="HTL-PHOTO no-img">🏛️</div>
          </div>
        </div>

      </div>
    </div>

    <div class="HTL-CTA">
      <a href="history.html">
        Повна історія міста
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5l7 7-7 7"/></svg>
      </a>
    </div>

    <script>
    (function(){
      var track = document.getElementById('htlTrack');
      if (!track) return;

      // ── drag to scroll ──
      var isDown = false, startX = 0, scrollLeft = 0;
      track.addEventListener('mousedown', function(e) {
        isDown = true; startX = e.pageX - track.offsetLeft; scrollLeft = track.scrollLeft;
      });
      document.addEventListener('mouseup', function() { isDown = false; });
      document.addEventListener('mousemove', function(e) {
        if (!isDown) return; e.preventDefault();
        track.scrollLeft = scrollLeft - (e.pageX - track.offsetLeft - startX);
      });

      // ── scroll-in animation for items ──
      var items = track.querySelectorAll('.HTL-ITEM');
      if ('IntersectionObserver' in window) {
        var io = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry, idx) {
            if (entry.isIntersecting) {
              setTimeout(function() {
                entry.target.classList.add('htl-visible');
              }, 60);
              io.unobserve(entry.target);
            }
          });
        }, { threshold: 0.15 });
        items.forEach(function(item) { io.observe(item); });
      } else {
        items.forEach(function(item) { item.classList.add('htl-visible'); });
      }

      // ── gentle hint scroll on load ──
      setTimeout(function() {
        var max = track.scrollWidth - track.clientWidth;
        if (max <= 0) return;
        var dist = Math.min(200, max * 0.14);
        var start = null, dur = 1800;
        function step(ts) {
          if (!start) start = ts;
          var p = (ts - start) / dur;
          if (p > 1) { track.scrollLeft = 0; return; }
          var v = p < .5 ? 2*p*p : -1+(4-2*p)*p;
          track.scrollLeft = p < .75 ? dist * v / 0.75 : dist * (1 - (p-.75)/.25);
          requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      }, 1200);
    })();
    </script>
    </section>
    <!-- ═══ END HORIZONTAL TIMELINE ═══ -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="footer-title">Дубровиця</h4>
                    <p class="footer-text">
                        Цифровий архів історичної спадщини селища міського типу Дубровиця, 
                        Сарненський район, Рівненська область, Україна.
                    </p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Навігація</h4>
                    <nav class="footer-nav">
                        <a href="history.html">Історія</a>
                        <a href="photo-archive.html">Фотоархів</a>
                        <a href="metrychni-knyhy.html">Метричні книги</a>
                        <a href="books.html">Книги</a>
                    </nav>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Контакти</h4>
                    <p class="footer-text">
                        Маєте матеріали або пропозиції?<br>
                        <a href="contacts.html" class="footer-link">Зв'яжіться з нами</a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Дубровиця. Цифровий архів.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>

    <!-- FULLSCREEN SLIDER OVERLAY -->
    <div id="SFS-OVERLAY">
      <button id="SFS-CLOSE" onclick="closeSliderFS()" title="Закрити">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
      <div id="SFS-LABELS">
        <span id="SFS-L1"></span>
        <span id="SFS-L2"></span>
      </div>
      <div id="SFS-FRAME">
        <img id="SFS-BASE" src="" alt="" draggable="false">
        <img id="SFS-OV"   src="" alt="" draggable="false">
        <div id="SFS-LINE"></div>
        <div id="SFS-HANDLE">
          <div id="SFS-DISC">
            <svg viewBox="0 0 24 24"><path d="M8.5 5L3 12l5.5 7V5zm7 0v14L21 12l-5.5-7z"/></svg>
          </div>
        </div>
        <div id="SFS-HINT">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 19l-7-7 7-7"/></svg>
          Тягніть для порівняння
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5l7 7-7 7"/></svg>
        </div>
      </div>
    </div>

    <style>
    .SFS-BTN {
      position: absolute; bottom: 12px; right: 12px; z-index: 30;
      width: 36px; height: 36px;
      background: rgba(8,6,4,.82); backdrop-filter: blur(10px);
      border: 1px solid rgba(201,162,39,.35); border-radius: 8px;
      color: #c9a227; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background .15s, transform .15s; padding: 0;
    }
    .SFS-BTN svg { width: 17px; height: 17px; }
    .SFS-BTN:hover { background: rgba(201,162,39,.22); transform: scale(1.08); }

    #SFS-OVERLAY {
      position: fixed; inset: 0; z-index: 100000;
      background: rgba(4,3,2,.97); backdrop-filter: blur(20px);
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem;
      opacity: 0; pointer-events: none; transition: opacity .25s ease;
    }
    #SFS-OVERLAY.open { opacity: 1; pointer-events: all; }

    #SFS-CLOSE {
      position: fixed; top: 1rem; right: 1rem;
      width: 44px; height: 44px;
      background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.15); border-radius: 50%;
      color: rgba(255,255,255,.85); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background .2s, transform .2s; z-index: 100001;
    }
    #SFS-CLOSE svg { width: 20px; height: 20px; }
    #SFS-CLOSE:hover { background: #c9a227; border-color: #c9a227; color: #0f0a00; transform: rotate(90deg); }

    #SFS-LABELS {
      display: flex; align-items: center; justify-content: space-between;
      width: min(96vw, 1400px); padding: 0 0.5rem; pointer-events: none;
    }
    #SFS-LABELS span {
      font-family: "Cormorant Garamond", serif;
      font-size: clamp(1.1rem, 2.5vw, 1.6rem); font-weight: 300; letter-spacing: .04em;
      color: rgba(255,255,255,.55);
    }
    #SFS-LABELS span:first-child { color: #f5d060; }
    #SFS-LABELS span:last-child  { color: #a8d8ff; text-align: right; }

    #SFS-FRAME {
      position: relative; width: min(96vw, 1400px); height: min(82vh, 900px);
      border-radius: 10px; overflow: hidden; cursor: ew-resize;
      user-select: none; box-shadow: 0 40px 100px rgba(0,0,0,.8);
    }
    #SFS-BASE, #SFS-OV {
      position: absolute; inset: 0; width: 100%; height: 100%;
      object-fit: cover; pointer-events: none; display: block;
    }
    #SFS-OV { clip-path: inset(0 50% 0 0); will-change: clip-path; filter: contrast(1.12) brightness(1.04) saturate(.08); }
    #SFS-BASE { filter: saturate(1.1) contrast(1.04); }

    #SFS-LINE {
      position: absolute; top: 0; bottom: 0; left: 50%;
      transform: translateX(-50%); width: 1px; z-index: 15; pointer-events: none;
      background: linear-gradient(to bottom, transparent 0%, rgba(255,255,255,.15) 4%, rgba(255,255,255,.9) 20%, #fff 50%, rgba(255,255,255,.9) 80%, rgba(255,255,255,.15) 96%, transparent 100%);
    }
    #SFS-HANDLE {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%); z-index: 20; pointer-events: none;
      display: flex; flex-direction: column; align-items: center;
    }
    #SFS-HANDLE::before, #SFS-HANDLE::after {
      content: ""; display: block; width: 1px; height: 32px; background: rgba(255,255,255,.7);
    }
    #SFS-DISC {
      width: 52px; height: 52px; border-radius: 50%;
      background: linear-gradient(135deg, #fff 0%, #e8f0ff 100%);
      box-shadow: 0 2px 24px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.4);
      display: flex; align-items: center; justify-content: center; transition: transform .15s;
    }
    #SFS-FRAME.dragging #SFS-DISC { transform: scale(1.12); }
    #SFS-DISC svg { width: 22px; height: 22px; fill: #001428; opacity: .7; }
    #SFS-HINT {
      position: absolute; bottom: 1.5rem; left: 50%; transform: translateX(-50%); z-index: 20;
      background: rgba(0,0,0,.6); backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,.08); border-radius: 100px;
      padding: .5rem 1.4rem .5rem 1.1rem;
      display: flex; align-items: center; gap: .6rem;
      font-size: .65rem; letter-spacing: .14em; text-transform: uppercase;
      color: rgba(255,255,255,.45); pointer-events: none; transition: opacity .5s; white-space: nowrap;
    }
    #SFS-HINT svg { width: 14px; height: 14px; opacity: .5; flex-shrink: 0; }
    #SFS-FRAME.moved #SFS-HINT { opacity: 0; }
    @media (max-width: 600px) {
      #SFS-FRAME { width: 98vw; height: 65vw; border-radius: 6px; }
      #SFS-DISC  { width: 40px; height: 40px; }
      #SFS-DISC svg { width: 16px; height: 16px; }
    }
    </style>

    <script>
    var _sfsActive = false;
    function openSliderFS(ovSrc, baseSrc, label1, label2) {
      document.getElementById("SFS-OV").src = ovSrc;
      document.getElementById("SFS-BASE").src = baseSrc;
      document.getElementById("SFS-L1").textContent = label1;
      document.getElementById("SFS-L2").textContent = label2;
      var ov = document.getElementById("SFS-OV");
      var line = document.getElementById("SFS-LINE");
      var handle = document.getElementById("SFS-HANDLE");
      ov.style.clipPath = "inset(0 50% 0 0)";
      line.style.left = "50%";
      handle.style.left = "50%";
      document.getElementById("SFS-OVERLAY").classList.add("open");
      document.body.style.overflow = "hidden";
      _sfsActive = true;
      initSFSDrag();
    }
    function closeSliderFS() {
      document.getElementById("SFS-OVERLAY").classList.remove("open");
      document.body.style.overflow = "";
      _sfsActive = false;
    }
    function initSFSDrag() {
      var frame = document.getElementById("SFS-FRAME");
      var ov    = document.getElementById("SFS-OV");
      var line  = document.getElementById("SFS-LINE");
      var handle= document.getElementById("SFS-HANDLE");
      var dragging = false;
      function setPos(clientX) {
        var rect = frame.getBoundingClientRect();
        var pct = Math.min(100, Math.max(0, (clientX - rect.left) / rect.width * 100));
        var right = (100 - pct).toFixed(2);
        ov.style.clipPath = "inset(0 " + right + "% 0 0)";
        line.style.left = pct + "%";
        handle.style.left = pct + "%";
        frame.classList.add("moved");
      }
      // clean up old listeners
      var newFrame = frame.cloneNode(true);
      frame.parentNode.replaceChild(newFrame, frame);
      frame = document.getElementById("SFS-FRAME");
      ov    = document.getElementById("SFS-OV");
      line  = document.getElementById("SFS-LINE");
      handle= document.getElementById("SFS-HANDLE");

      frame.addEventListener("mousedown", function(e) {
        if (e.button !== 0) return;
        dragging = true; frame.classList.add("dragging"); setPos(e.clientX);
      });
      document.addEventListener("mousemove", function(e) {
        if (!dragging || !_sfsActive) return; setPos(e.clientX);
      });
      document.addEventListener("mouseup", function() {
        dragging = false; frame && frame.classList.remove("dragging");
      });
      frame.addEventListener("touchstart", function(e) {
        dragging = true; frame.classList.add("dragging"); setPos(e.touches[0].clientX);
      }, { passive: true });
      frame.addEventListener("touchmove", function(e) {
        if (!dragging) return; e.preventDefault(); setPos(e.touches[0].clientX);
      }, { passive: false });
      frame.addEventListener("touchend", function() {
        dragging = false; frame.classList.remove("dragging");
      });
    }
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape" && _sfsActive) closeSliderFS();
    });
    document.getElementById("SFS-OVERLAY").addEventListener("click", function(e) {
      if (e.target === this) closeSliderFS();
    });
    </script>
</body>
</html>
