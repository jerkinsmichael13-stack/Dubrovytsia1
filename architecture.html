<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Архітектурні пам'ятки — Дубровиця</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ═══ DARK PAGE ═══ */
    #KP { background: #07060a; color: #f0e8d0; font-family: 'DM Sans', sans-serif; }

    /* ── Page header ── */
    .KPH {
        text-align: center;
        padding: 5rem 2rem 3rem;
    }
    .KPH-EYE {
        display: inline-flex; align-items: center; gap: .8rem;
        margin-bottom: 1.2rem;
        font-size: .57rem; letter-spacing: .3em; text-transform: uppercase; color: #b8902a;
    }
    .KPH-EYE::before, .KPH-EYE::after {
        content: ''; display: block; width: 38px; height: 1px;
    }
    .KPH-EYE::before { background: linear-gradient(90deg, transparent, rgba(180,145,40,.5)); }
    .KPH-EYE::after  { background: linear-gradient(90deg, rgba(180,145,40,.5), transparent); }
    .KPH-T {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(2.4rem, 5vw, 4rem); font-weight: 300; line-height: 1.05;
        color: #f5ead8; margin-bottom: .4rem;
    }
    .KPH-T em { font-style: italic; color: #c9a227; }
    .KPH-S {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(.95rem, 1.8vw, 1.2rem); font-style: italic;
        color: rgba(245,234,216,.32); margin-bottom: .5rem;
    }
    .KPH-M {
        font-size: .62rem; letter-spacing: .15em; text-transform: uppercase;
        color: rgba(245,234,216,.18);
    }

    /* ══════════════════════════════════════════
       ANNOTATED PHOTO STAGE
       Layout: [left-panel] [photo] [right-panel]
    ══════════════════════════════════════════ */
    .KSTAGE {
        display: grid;
        /* panels shrink to 0 on small screens */
        grid-template-columns: 1fr minmax(0, 820px) 1fr;
        align-items: start;
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 0 2rem;
        position: relative;
    }

    /* Photo column */
    .KPHOTO-COL {
        position: relative;
        grid-column: 2;
    }
    .KPHOTO-IMG {
        display: block; width: 100%; height: auto;
        border-radius: 4px;
        filter: contrast(1.04) brightness(.93) saturate(.82);
        box-shadow: 0 0 0 1px rgba(180,145,40,.08), 0 30px 90px rgba(0,0,0,.85);
        user-select: none; -webkit-user-drag: none;
    }

    /* Pin overlay — JS sets height */
    .KPINS-OVL {
        position: absolute;
        top: 0; left: 0; right: 0;
        pointer-events: none;
        overflow: visible;
    }

    /* Single marker — diamond shape */
    .KM {
        position: absolute;
        transform: translate(-50%, -50%);
        pointer-events: all;
        cursor: default;
        z-index: 10;
    }
    /* Diamond */
    .KM-DIAMOND {
        width: 18px; height: 18px;
        background: linear-gradient(135deg, #f5d060, #c9a227);
        transform: rotate(45deg);
        box-shadow: 0 0 0 2px rgba(201,162,39,.35), 0 3px 12px rgba(0,0,0,.6);
        transition: transform .22s, box-shadow .22s;
        position: relative; z-index: 2;
    }
    .KM:hover .KM-DIAMOND {
        transform: rotate(45deg) scale(1.3);
        box-shadow: 0 0 0 3px rgba(201,162,39,.55), 0 5px 20px rgba(0,0,0,.8);
    }
    /* Subtle pulse on diamond */
    .KM-PULSE {
        position: absolute; top: 50%; left: 50%;
        width: 18px; height: 18px;
        transform: translate(-50%,-50%) rotate(45deg);
        background: rgba(201,162,39,.22);
        animation: dPulse 3s ease-out infinite;
        pointer-events: none;
    }
    @keyframes dPulse {
        0%   { transform: translate(-50%,-50%) rotate(45deg) scale(1);   opacity: .7; }
        70%  { transform: translate(-50%,-50%) rotate(45deg) scale(2.8); opacity: 0; }
        100% { transform: translate(-50%,-50%) rotate(45deg) scale(1);   opacity: 0; }
    }

    /* ── SVG arrows overlay — sits above photo, same size ── */
    .KARROWS {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none;
        overflow: visible;
    }
    .KARROW-LINE {
        stroke: rgba(201,162,39,.55);
        stroke-width: 1.2;
        fill: none;
        stroke-dasharray: 4 3;
    }

    /* ── Side panels ── */
    .KPANEL {
        padding: 2.5rem 0;
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    .KPANEL-L { grid-column: 1; padding-right: 2rem; padding-left: 1.5rem; align-items: flex-end; }
    .KPANEL-R { grid-column: 3; padding-left: 2rem; padding-right: 1.5rem; align-items: flex-start; }

    /* Info card on panel */
    .KCARD {
        width: 100%;
        max-width: 240px;
        position: relative;
        padding: 1.1rem 1.3rem 1.1rem 1rem;
        border-left: 1px solid rgba(201,162,39,.2);
        margin-bottom: 2.2rem;
        opacity: 0;
        transform: translateX(-12px);
        transition: opacity .5s ease, transform .5s ease;
    }
    .KPANEL-R .KCARD {
        border-left: none;
        border-right: 1px solid rgba(201,162,39,.2);
        padding: 1.1rem 1rem 1.1rem 1.3rem;
        transform: translateX(12px);
    }
    .KCARD.vis {
        opacity: 1;
        transform: translateX(0);
    }
    /* Gold accent dot on the border */
    .KCARD::before {
        content: '';
        position: absolute;
        top: 1.1rem; left: -4px;
        width: 7px; height: 7px;
        background: #c9a227;
        transform: rotate(45deg);
    }
    .KPANEL-R .KCARD::before {
        left: auto; right: -4px;
    }
    .KCARD-LABEL {
        font-size: .55rem;
        letter-spacing: .22em;
        text-transform: uppercase;
        color: #c9a227;
        margin-bottom: .4rem;
        opacity: .8;
    }
    .KCARD-TITLE {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1rem;
        font-weight: 500;
        color: #f0e6c8;
        line-height: 1.25;
        margin-bottom: .45rem;
    }
    .KCARD-TEXT {
        font-size: .7rem;
        font-weight: 300;
        line-height: 1.72;
        color: rgba(240,230,200,.45);
    }

    /* On small screens — hide panels, show tooltip instead */
    @media (max-width: 900px) {
        .KSTAGE { grid-template-columns: 1fr; }
        .KPHOTO-COL { grid-column: 1; }
        .KPANEL { display: none; }
        .KARROWS { display: none; }
    }

    /* hint */
    .KHINT {
        text-align: center; margin: .6rem 0 0;
        font-size: .57rem; letter-spacing: .2em; text-transform: uppercase;
        color: rgba(240,230,200,.15);
        display: flex; align-items: center; justify-content: center; gap: .5rem;
    }

    /* ── Stats ── */
    .KSTATS {
        display: grid; grid-template-columns: repeat(4,1fr);
        gap: 1px; background: rgba(255,255,255,.04);
        max-width: 820px; margin: 3.5rem auto 0;
    }
    @media (max-width: 640px) { .KSTATS { grid-template-columns: repeat(2,1fr); } }
    .KST {
        background: #07060a; padding: 1.7rem 1.4rem;
        position: relative; transition: background .22s; overflow: hidden;
    }
    .KST::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
        background: transparent; transition: background .25s;
    }
    .KST:hover { background: #0e0c07; }
    .KST:hover::before { background: linear-gradient(90deg, transparent, rgba(201,162,39,.45), transparent); }
    .KST-V {
        font-family: 'Cormorant Garamond', serif; font-size: 2.8rem; font-weight: 300; line-height: 1;
        background: linear-gradient(135deg, #c9a227, #edd060);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        margin-bottom: .3rem;
    }
    .KST-K { font-size: .58rem; letter-spacing: .13em; text-transform: uppercase; color: rgba(240,230,200,.24); margin-bottom: .3rem; }
    .KST-D { font-size: .7rem; font-weight: 300; line-height: 1.68; color: rgba(240,230,200,.4); }

    /* ── Gallery ── */
    .KGAL { max-width: 820px; margin: 4rem auto 0; padding: 0 1.5rem 6rem; }
    .KGAL-HDR { display: flex; align-items: baseline; gap: 1rem; margin-bottom: 1.2rem; }
    .KGAL-HDR::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,.06); align-self: center; }
    .KGAL-TITLE { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; font-weight: 300; font-style: italic; color: #e0d0a8; }
    .KGAL-GRID {
        display: grid;
        grid-template-columns: 1.65fr 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: .5rem; height: 400px;
    }
    @media (max-width: 640px) { .KGAL-GRID { grid-template-columns: 1fr 1fr; grid-template-rows: auto; height: auto; } .KGAL-MAIN { grid-column: span 2; } }
    .KGAL-ITEM {
        position: relative; overflow: hidden;
        border-radius: 4px; background: #0d0b0a;
        cursor: pointer; box-shadow: 0 2px 16px rgba(0,0,0,.5);
    }
    .KGAL-MAIN { grid-row: span 2; }
    .KGAL-ITEM img { width: 100%; height: 100%; object-fit: cover; display: block; filter: contrast(1.04) brightness(.96); transition: transform .5s ease, filter .5s ease; }
    .KGAL-ITEM:hover img { transform: scale(1.05); filter: contrast(1.07) brightness(1.03); }

    /* ── Lightbox ── */
    #KLB {
        position: fixed; inset: 0; z-index: 99999;
        background: rgba(4,2,8,.97);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity .22s;
    }
    #KLB.on { opacity: 1; pointer-events: all; }
    #KLB img { max-width: 94vw; max-height: 90vh; object-fit: contain; border-radius: 4px; }
    .KLB-X {
        position: absolute; top: 1.2rem; right: 1.4rem;
        width: 42px; height: 42px; border-radius: 50%;
        background: rgba(255,255,255,.1); border: none; color: #fff;
        font-size: 1.1rem; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: background .15s;
    }
    .KLB-X:hover { background: rgba(255,255,255,.22); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="https://i.imgur.com/mXCrjjG.png" alt="Герб" class="logo-img" loading="lazy">
                <div class="logo-text">
                    <span class="logo-city">Дубровиця</span>
                    <span class="logo-subtitle">Цифровий архів</span>
                </div>
            </a>
            <nav class="nav" id="mainNav">
                <a href="index.html" class="nav-link">Головна</a>
                <a href="history.html" class="nav-link">Історія</a>
                <a href="photo-archive.html" class="nav-link">Фотоархів</a>
                <a href="architecture.html" class="nav-link active">Пам'ятки</a>
                <a href="metrychni-knyhy.html" class="nav-link">Метричні книги</a>
                <a href="books.html" class="nav-link">Книги</a>
                <a href="contacts.html" class="nav-link">Контакти</a>
            </nav>
            <button class="theme-toggle" id="themeToggle" aria-label="Перемкнути тему">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
            <button class="mobile-toggle" id="mobileToggle" aria-label="Відкрити меню">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <section class="article-header">
        <div class="container">
            <h1 class="article-title fade-in-up">Архітектурні пам'ятки</h1>
            <p class="article-meta fade-in-up delay-1">Сакральна архітектура · Пам'ятки національного значення</p>
        </div>
    </section>

    <div id="KP">

        <!-- Header -->
        <div class="KPH">
            <div class="KPH-EYE"><span>Пам'ятка архітектури національного значення · №&thinsp;1497</span></div>
            <h2 class="KPH-T">Костел <em>Іоанна Хрестителя</em></h2>
            <p class="KPH-S">Найстаріша архітектурна пам'ятка Дубровиці</p>
            <p class="KPH-M">Збудований 1695–1742 · Стиль рококо · Орден піарів</p>
        </div>

        <!-- ═══ STAGE: panels + photo + arrows ═══ -->
        <div class="KSTAGE" id="KSTAGE">

            <!-- LEFT PANEL -->
            <div class="KPANEL KPANEL-L" id="KPANEL-L">

                <div class="KCARD" id="card-A">
                    <div class="KCARD-LABEL">Будівництво · 1695–1742</div>
                    <div class="KCARD-TITLE">Орден піарів</div>
                    <div class="KCARD-TEXT">Збудований орденом піарів коштом Яна Кароля Дольського — 33 тис. злотих. Додаткові кошти надали графи Плятери та скарбник київський В. Прушеневський (50 тис. злотих). Консекрований єпископом Франциском Кобельським у 1742 р.</div>
                </div>

                <div class="KCARD" id="card-B">
                    <div class="KCARD-LABEL">Дзвіниця · XVIII ст.</div>
                    <div class="KCARD-TITLE">Вежа-дзвіниця</div>
                    <div class="KCARD-TEXT">У 1945 р. радянська влада зняла і вивезла дзвони, розібрала та знищила орган. Цінні ікони, срібне начиння й майно розграбували. Костел перефарбували з білого у червоний і перетворили на промисловий склад.</div>
                </div>

                <div class="KCARD" id="card-C">
                    <div class="KCARD-LABEL">Парафія · 1938 р.</div>
                    <div class="KCARD-TITLE">1 045 парафіян</div>
                    <div class="KCARD-TEXT">До закриття парафія охоплювала понад 100 навколишніх сіл — Крупове, Острівці, Мочулище, Воробин та ін. Стиль — рококо. Трьохнавна базиліка з хрестовими склепіннями.</div>
                </div>

            </div><!-- /KPANEL-L -->

            <!-- PHOTO COLUMN -->
            <div class="KPHOTO-COL" id="KPHOTO-COL">
                <img
                    class="KPHOTO-IMG"
                    id="KPHOTO-IMG"
                    src="https://i.imgur.com/Ru7uTkK.jpeg"
                    alt="Костел Іоанна Хрестителя"
                    draggable="false"
                >

                <!-- Diamond markers — % of image -->
                <!--
                  Looking at the photo carefully:
                  The photo shows the building taking up the left ~55% of the frame.
                  Left tower top dome: ~x=22%, y=20%
                  Right (main taller) tower dome: ~x=38%, y=8%
                  Left baroque facade/body mid: ~x=20%, y=45%
                  Main portal bottom: ~x=33%, y=91%
                  Right nave body / windows: ~x=57%, y=65%
                -->
                <div class="KPINS-OVL" id="KPINS-OVL">
                    <!-- markers go here, positioned via JS from MARKERS data -->
                </div>

                <!-- SVG arrows drawn by JS -->
                <svg class="KARROWS" id="KARROWS-SVG" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
            </div>

            <!-- RIGHT PANEL -->
            <div class="KPANEL KPANEL-R" id="KPANEL-R">

                <div class="KCARD" id="card-D">
                    <div class="KCARD-LABEL">Відкрито 1702 р.</div>
                    <div class="KCARD-TITLE">Головний портал</div>
                    <div class="KCARD-TEXT">Відкритий у 1702 р. — ще до завершення всього будівництва. Перший дерев'яний костел 1684 р. шведи спалили у 1709 р. під час відступу після Полтавської битви.</div>
                </div>

                <div class="KCARD" id="card-E">
                    <div class="KCARD-LABEL">Втрачено 1945 р. ✝</div>
                    <div class="KCARD-TITLE">Венеційський вітраж</div>
                    <div class="KCARD-TEXT">Найцінніший елемент інтер'єру — вітраж, замовлений спеціально у Венеції. Знищений радянською владою у 1945 р. разом із закриттям костелу. Відновлення вітражу досі не відбулося.</div>
                </div>

            </div><!-- /KPANEL-R -->

        </div><!-- /KSTAGE -->

        <p class="KHINT" id="KHINT">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/></svg>
            Маркери вказують на ключові елементи будівлі
        </p>

        <!-- Stats -->
        <div class="KSTATS">
            <div class="KST">
                <div class="KST-V">1684</div>
                <div class="KST-K">Перший костел</div>
                <div class="KST-D">Дерев'яний, коштом Дольського. Спалений шведами у 1709 р. після Полтавської битви.</div>
            </div>
            <div class="KST">
                <div class="KST-V">330+</div>
                <div class="KST-K">Років історії</div>
                <div class="KST-D">Пам'ятка національного значення №&thinsp;1497. Найстаріша збережена споруда Дубровиці.</div>
            </div>
            <div class="KST">
                <div class="KST-V">1045</div>
                <div class="KST-K">Парафіян · 1938</div>
                <div class="KST-D">Понад 100 навколишніх сіл. Після 1945 р. парафію ліквідовано, будівлю зробили складом.</div>
            </div>
            <div class="KST">
                <div class="KST-V">1992</div>
                <div class="KST-K">Повернення</div>
                <div class="KST-D">Освячений єпископом Маркіяном Трофим'яком у листопаді 1992 р. після десятиліть занедбаності.</div>
            </div>
        </div>

        <!-- Gallery -->
        <div class="KGAL">
            <div class="KGAL-HDR">
                <div class="KGAL-TITLE">Інтер'єр костелу</div>
            </div>
            <div class="KGAL-GRID">
                <div class="KGAL-ITEM KGAL-MAIN" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/u6vHC49.jpeg" alt="Головний вівтар" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/pcuoEmD.jpeg" alt="Бічна нава" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/JM3Qg4Z.jpeg" alt="Склепіння" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/dHKnHPp.jpeg" alt="Орнамент" loading="lazy">
                </div>
            </div>
        </div>

    </div><!-- /#KP -->

    <div id="KLB">
        <button class="KLB-X" onclick="document.getElementById('KLB').classList.remove('on')">&#x2715;</button>
        <img id="KLB-I" src="" alt="">
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="footer-title">Дубровиця</h4>
                    <p class="footer-text">Цифровий архів історичної спадщини міста Дубровиця, Сарненський район, Рівненська область, Україна.</p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Навігація</h4>
                    <nav class="footer-nav">
                        <a href="history.html">Історія</a>
                        <a href="photo-archive.html">Фотоархів</a>
                        <a href="architecture.html">Пам'ятки</a>
                        <a href="metrychni-knyhy.html">Метричні книги</a>
                        <a href="books.html">Книги</a>
                    </nav>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Контакти</h4>
                    <p class="footer-text">Маєте матеріали або пропозиції?<br><a href="contacts.html" class="footer-link">Зв'яжіться з нами</a></p>
                </div>
            </div>
            <div class="footer-bottom"><p>&copy; 2026 Дубровиця. Цифровий архів.</p></div>
        </div>
    </footer>

    <script>
    // ══════════════════════════════════════════════════════════════
    // MARKERS DATA
    // Each marker: { px, py } = % position on the photo (left, top)
    // side = 'L' or 'R' — which panel it connects to
    // cardId = id of the .KCARD element
    // ══════════════════════════════════════════════════════════════
    var MARKERS = [
        // Left panel cards — arrows go from marker LEFT off photo
        { px: 32, py: 9,  side: 'L', cardId: 'card-A' },  // top of main tower — Орден піарів
        { px: 22, py: 22, side: 'L', cardId: 'card-B' },  // left tower dome — Дзвіниця
        { px: 19, py: 47, side: 'L', cardId: 'card-C' },  // left baroque facade — Парафія
        // Right panel cards — arrows go from marker RIGHT off photo
        { px: 33, py: 90, side: 'R', cardId: 'card-D' },  // portal bottom
        { px: 57, py: 62, side: 'R', cardId: 'card-E' },  // right nave windows
    ];

    var photoEl  = document.getElementById('KPHOTO-IMG');
    var ovlEl    = document.getElementById('KPINS-OVL');
    var svgEl    = document.getElementById('KARROWS-SVG');
    var stageEl  = document.getElementById('KSTAGE');
    var panelL   = document.getElementById('KPANEL-L');
    var panelR   = document.getElementById('KPANEL-R');
    var photoCol = document.getElementById('KPHOTO-COL');

    // Build marker elements
    MARKERS.forEach(function(m, i) {
        var el = document.createElement('div');
        el.className = 'KM';
        el.id = 'km-' + i;
        el.style.left = m.px + '%';
        el.style.top  = m.py + '%';
        el.style.opacity = '0';
        el.style.transition = 'opacity .45s ease';

        var pulse = document.createElement('div');
        pulse.className = 'KM-PULSE';

        var diamond = document.createElement('div');
        diamond.className = 'KM-DIAMOND';

        el.appendChild(pulse);
        el.appendChild(diamond);
        ovlEl.appendChild(el);

        setTimeout(function() { el.style.opacity = '1'; }, 500 + i * 180);
    });

    // ── Draw SVG arrows ──────────────────────────────────────────
    // Each arrow: from the marker (in % of photo) to the edge of the photo,
    // then a short elbow to help point toward the card.
    // We use percentage-based SVG (viewBox="0 0 100 100" preserveAspectRatio="none").
    // For left markers: line goes from (px, py) to (0, py) — exits left edge.
    // For right markers: line goes from (px, py) to (100, py) — exits right edge.
    // An arrowhead polygon.

    function buildArrows() {
        // Only draw on wide screens
        if (window.innerWidth <= 900) return;

        svgEl.innerHTML = '';

        MARKERS.forEach(function(m, i) {
            var x1 = m.px, y1 = m.py;
            var x2 = (m.side === 'L') ? 0 : 100;
            // Slight curve downward for lower markers, up for upper
            var ymid = y1;

            // Dashed line from marker to edge
            var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1 + '%');
            line.setAttribute('y1', y1 + '%');
            line.setAttribute('x2', x2 + '%');
            line.setAttribute('y2', ymid + '%');
            line.setAttribute('class', 'KARROW-LINE');
            svgEl.appendChild(line);

            // Arrowhead at the edge
            var arr = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            var ax = parseFloat(x2);
            var ay = parseFloat(ymid);
            var sz = 1.2; // arrowhead size in %
            var pts;
            if (m.side === 'L') {
                // pointing left
                pts = [
                    (ax - sz*1.8) + '% ' + ay + '%',
                    (ax)          + '% ' + (ay - sz*.9) + '%',
                    (ax)          + '% ' + (ay + sz*.9) + '%',
                ].join(', ');
            } else {
                // pointing right
                pts = [
                    (ax + sz*1.8) + '% ' + ay + '%',
                    (ax)          + '% ' + (ay - sz*.9) + '%',
                    (ax)          + '% ' + (ay + sz*.9) + '%',
                ].join(', ');
            }
            arr.setAttribute('points', pts);
            arr.setAttribute('fill', 'rgba(201,162,39,.55)');
            arr.setAttribute('stroke', 'none');
            svgEl.appendChild(arr);
        });
    }

    // ── Animate cards into view ───────────────────────────────────
    function animateCards() {
        document.querySelectorAll('.KCARD').forEach(function(card, i) {
            setTimeout(function() { card.classList.add('vis'); }, 300 + i * 200);
        });
    }

    // ── Sync overlay height to rendered photo ─────────────────────
    function sync() {
        ovlEl.style.height = photoEl.offsetHeight + 'px';
        buildArrows();
    }

    photoEl.addEventListener('load', function() { sync(); animateCards(); });
    window.addEventListener('resize', sync);
    if (photoEl.complete) { sync(); animateCards(); }
    setTimeout(function() { sync(); animateCards(); }, 400);

    // ── Lightbox ──────────────────────────────────────────────────
    function openKLB(el) {
        document.getElementById('KLB-I').src = el.querySelector('img').src;
        document.getElementById('KLB').classList.add('on');
    }
    document.getElementById('KLB').addEventListener('click', function(e) {
        if (e.target === this) this.classList.remove('on');
    });
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') document.getElementById('KLB').classList.remove('on');
    });
    </script>
    <script src="script.js"></script>
</body>
</html>
