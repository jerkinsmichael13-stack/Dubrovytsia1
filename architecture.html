<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Архітектурні пам'ятки — Дубровиця</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    #KP { background: #07060a; color: #f0e8d0; font-family: 'DM Sans', sans-serif; }

    /* ── Page header ── */
    .KPH { text-align: center; padding: 5rem 2rem 3rem; }
    .KPH-EYE {
        display: inline-flex; align-items: center; gap: .8rem;
        margin-bottom: 1.2rem;
        font-size: .56rem; letter-spacing: .3em; text-transform: uppercase; color: #b8902a;
    }
    .KPH-EYE::before, .KPH-EYE::after { content: ''; display: block; width: 38px; height: 1px; }
    .KPH-EYE::before { background: linear-gradient(90deg, transparent, rgba(180,145,40,.5)); }
    .KPH-EYE::after  { background: linear-gradient(90deg, rgba(180,145,40,.5), transparent); }
    .KPH-T {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(2.4rem, 5vw, 4rem); font-weight: 300; line-height: 1.05;
        color: #f5ead8; margin-bottom: .4rem;
    }
    .KPH-T em { font-style: italic; color: #c9a227; }
    .KPH-S {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(.95rem, 1.8vw, 1.2rem); font-style: italic;
        color: rgba(245,234,216,.32); margin-bottom: .5rem;
    }
    .KPH-M { font-size: .62rem; letter-spacing: .15em; text-transform: uppercase; color: rgba(245,234,216,.18); }

    /* ═══════════════════════════════════════════════
       STAGE: [left panel] [photo] [right panel]
    ═══════════════════════════════════════════════ */
    .KSTAGE {
        display: grid;
        grid-template-columns: 1fr minmax(0, 780px) 1fr;
        align-items: start;
        max-width: 1700px;
        margin: 0 auto;
        padding: 0 0 2rem;
        position: relative;
    }

    /* Photo */
    .KPHOTO-COL { position: relative; grid-column: 2; }
    .KPHOTO-IMG {
        display: block; width: 100%; height: auto;
        border-radius: 3px;
        filter: contrast(1.04) brightness(.93) saturate(.82);
        box-shadow: 0 0 0 1px rgba(180,145,40,.07), 0 30px 90px rgba(0,0,0,.9);
        user-select: none; -webkit-user-drag: none;
    }

    /* Marker overlay */
    .KPINS-OVL {
        position: absolute; top: 0; left: 0; right: 0;
        pointer-events: none; overflow: visible;
    }

    /* ── Minimal circle marker ── */
    .KM {
        position: absolute;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 10;
    }
    /* Outer ring — thin gold circle */
    .KM-RING {
        width: 20px; height: 20px;
        border-radius: 50%;
        border: 1px solid rgba(201,162,39,.7);
        background: transparent;
        display: flex; align-items: center; justify-content: center;
        position: relative; z-index: 2;
    }
    /* Inner solid dot */
    .KM-DOT {
        width: 5px; height: 5px;
        border-radius: 50%;
        background: #c9a227;
    }
    /* Pulse */
    .KM-PULSE {
        position: absolute; top: 50%; left: 50%;
        width: 20px; height: 20px; border-radius: 50%;
        border: 1px solid rgba(201,162,39,.4);
        transform: translate(-50%,-50%);
        animation: mPulse 3.2s ease-out infinite;
        pointer-events: none;
    }
    @keyframes mPulse {
        0%   { transform: translate(-50%,-50%) scale(1);   opacity: .8; }
        70%  { transform: translate(-50%,-50%) scale(2.6); opacity: 0; }
        100% { transform: translate(-50%,-50%) scale(1);   opacity: 0; }
    }

    /* ── SVG line overlay ── */
    .KARROWS {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; overflow: visible;
    }
    /* Solid, ultra-thin, very low opacity */
    .KL {
        stroke: rgba(201,162,39,.38);
        stroke-width: .6;
        fill: none;
        stroke-linecap: round;
    }
    /* Tiny arrowhead fill */
    .KA { fill: rgba(201,162,39,.45); }

    /* ── Side panels ── */
    .KPANEL {
        display: flex; flex-direction: column;
        padding-top: 1.5rem;
    }
    .KPANEL-L { grid-column: 1; padding-right: 2.5rem; padding-left: 2rem; align-items: flex-end; }
    .KPANEL-R { grid-column: 3; padding-left: 2.5rem; padding-right: 2rem; align-items: flex-start; }

    /* Card */
    .KCARD {
        width: 100%; max-width: 260px;
        position: relative;
        padding: 0 0 0 1.1rem;
        border-left: 1px solid rgba(201,162,39,.18);
        margin-bottom: 3rem;
        opacity: 0;
        transform: translateX(-10px);
        transition: opacity .55s ease, transform .55s ease;
    }
    .KPANEL-R .KCARD {
        border-left: none;
        border-right: 1px solid rgba(201,162,39,.18);
        padding: 0 1.1rem 0 0;
        transform: translateX(10px);
        text-align: right;
    }
    .KCARD.vis { opacity: 1; transform: translateX(0); }

    .KCARD-LABEL {
        font-size: .52rem; letter-spacing: .24em; text-transform: uppercase;
        color: rgba(201,162,39,.7); margin-bottom: .5rem; display: block;
    }
    .KCARD-TITLE {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.1rem; font-weight: 400;
        color: #f0e6c8; line-height: 1.25; margin-bottom: .6rem;
    }
    .KCARD-TEXT {
        font-size: .69rem; font-weight: 300; line-height: 1.82;
        color: rgba(240,230,200,.42);
    }
    .KCARD-TEXT + .KCARD-TEXT { margin-top: .55rem; }

    /* hide panels on narrow */
    @media (max-width: 960px) {
        .KSTAGE { grid-template-columns: 1fr; }
        .KPHOTO-COL { grid-column: 1; }
        .KPANEL, .KARROWS { display: none; }
    }

    /* Hint */
    .KHINT {
        text-align: center; margin: .7rem 0 0;
        font-size: .55rem; letter-spacing: .2em; text-transform: uppercase;
        color: rgba(240,230,200,.13);
        display: flex; align-items: center; justify-content: center; gap: .5rem;
    }

    /* ── Stats ── */
    .KSTATS {
        display: grid; grid-template-columns: repeat(4,1fr);
        gap: 1px; background: rgba(255,255,255,.035);
        max-width: 780px; margin: 4rem auto 0;
    }
    @media (max-width: 640px) { .KSTATS { grid-template-columns: repeat(2,1fr); } }
    .KST { background: #07060a; padding: 1.8rem 1.5rem; position: relative; transition: background .22s; overflow: hidden; }
    .KST::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: transparent; transition: background .25s; }
    .KST:hover { background: #0e0c07; }
    .KST:hover::before { background: linear-gradient(90deg, transparent, rgba(201,162,39,.4), transparent); }
    .KST-V {
        font-family: 'Cormorant Garamond', serif; font-size: 2.8rem; font-weight: 300; line-height: 1;
        background: linear-gradient(135deg, #c9a227, #edd060);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        margin-bottom: .3rem;
    }
    .KST-K { font-size: .57rem; letter-spacing: .13em; text-transform: uppercase; color: rgba(240,230,200,.22); margin-bottom: .3rem; }
    .KST-D { font-size: .69rem; font-weight: 300; line-height: 1.7; color: rgba(240,230,200,.38); }

    /* ── Gallery ── */
    .KGAL { max-width: 780px; margin: 4rem auto 0; padding: 0 1.5rem 6rem; }
    .KGAL-HDR { display: flex; align-items: baseline; gap: 1rem; margin-bottom: 1.2rem; }
    .KGAL-HDR::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,.055); align-self: center; }
    .KGAL-TITLE { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; font-weight: 300; font-style: italic; color: #e0d0a8; }
    .KGAL-GRID {
        display: grid; grid-template-columns: 1.65fr 1fr 1fr;
        grid-template-rows: 1fr 1fr; gap: .5rem; height: 390px;
    }
    @media (max-width: 640px) { .KGAL-GRID { grid-template-columns: 1fr 1fr; grid-template-rows: auto; height: auto; } .KGAL-MAIN { grid-column: span 2; } }
    .KGAL-ITEM { position: relative; overflow: hidden; border-radius: 3px; background: #0d0b0a; cursor: pointer; }
    .KGAL-MAIN { grid-row: span 2; }
    .KGAL-ITEM img { width: 100%; height: 100%; object-fit: cover; display: block; filter: contrast(1.04) brightness(.95); transition: transform .5s ease, filter .5s ease; }
    .KGAL-ITEM:hover img { transform: scale(1.05); filter: contrast(1.07) brightness(1.03); }

    /* ── Lightbox ── */
    #KLB { position: fixed; inset: 0; z-index: 99999; background: rgba(4,2,8,.97); display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity .22s; }
    #KLB.on { opacity: 1; pointer-events: all; }
    #KLB img { max-width: 94vw; max-height: 90vh; object-fit: contain; border-radius: 3px; }
    .KLB-X { position: absolute; top: 1.2rem; right: 1.4rem; width: 42px; height: 42px; border-radius: 50%; background: rgba(255,255,255,.1); border: none; color: #fff; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background .15s; }
    .KLB-X:hover { background: rgba(255,255,255,.22); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="https://i.imgur.com/mXCrjjG.png" alt="Герб" class="logo-img" loading="lazy">
                <div class="logo-text">
                    <span class="logo-city">Дубровиця</span>
                    <span class="logo-subtitle">Цифровий архів</span>
                </div>
            </a>
            <nav class="nav" id="mainNav">
                <a href="index.html" class="nav-link">Головна</a>
                <a href="history.html" class="nav-link">Історія</a>
                <a href="photo-archive.html" class="nav-link">Фотоархів</a>
                <a href="architecture.html" class="nav-link active">Пам'ятки</a>
                <a href="metrychni-knyhy.html" class="nav-link">Метричні книги</a>
                <a href="books.html" class="nav-link">Книги</a>
                <a href="contacts.html" class="nav-link">Контакти</a>
            </nav>
            <button class="theme-toggle" id="themeToggle" aria-label="Перемкнути тему">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
            <button class="mobile-toggle" id="mobileToggle" aria-label="Відкрити меню">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <section class="article-header">
        <div class="container">
            <h1 class="article-title fade-in-up">Архітектурні пам'ятки</h1>
            <p class="article-meta fade-in-up delay-1">Сакральна архітектура · Пам'ятки національного значення</p>
        </div>
    </section>

    <div id="KP">

        <div class="KPH">
            <div class="KPH-EYE"><span>Пам'ятка архітектури національного значення · №&thinsp;1497</span></div>
            <h2 class="KPH-T">Костел <em>Іоанна Хрестителя</em></h2>
            <p class="KPH-S">Найстаріша архітектурна пам'ятка Дубровиці</p>
            <p class="KPH-M">Збудований 1695–1742 · Стиль рококо · Орден піарів</p>
        </div>

        <div class="KSTAGE" id="KSTAGE">

            <!-- ═══ LEFT PANEL ═══ -->
            <div class="KPANEL KPANEL-L">

                <div class="KCARD" id="card-A">
                    <span class="KCARD-LABEL">Будівництво · 1695–1742</span>
                    <div class="KCARD-TITLE">Орден піарів</div>
                    <div class="KCARD-TEXT">Костел збудований орденом піарів — католицьким чернечим орденом, заснованим у Римі 1617 р. і присвяченим освіті бідних. Разом із костелом у Дубровиці орден заснував колегіум — один із небагатьох навчальних закладів тогочасного Полісся.</div>
                    <div class="KCARD-TEXT">Будівництво тривало понад 40 років. Головним ктитором виступив Ян Кароль Дольський, який виділив 33 тис. злотих. Додаткові кошти надійшли від графів Плятерів та скарбника київського В. Прушеневського — ще 50 тис. злотих. Консекрований єпископом Франциском Кобельським у 1742 р.</div>
                </div>

                <div class="KCARD" id="card-B">
                    <span class="KCARD-LABEL">1945 — Радянська окупація</span>
                    <div class="KCARD-TITLE">Знищення та пограбування</div>
                    <div class="KCARD-TEXT">Одразу після встановлення радянської влади у 1945 р. костел зачинили. Дзвони зняли і вивезли, орган розібрали й знищили. Срібне начиння, старовинні ікони та цінне церковне майно — розграбували або знищили.</div>
                    <div class="KCARD-TEXT">Будівлю перефарбували з білого у червоний колір і пристосували під промисловий склад. Так тривало понад чотири десятиліття. Лише у 1992 р. костел було освячено повторно і повернуто католицькій громаді єпископом Маркіяном Трофим'яком.</div>
                </div>

                <div class="KCARD" id="card-C">
                    <span class="KCARD-LABEL">Парафія · до 1945 р.</span>
                    <div class="KCARD-TITLE">1 045 парафіян</div>
                    <div class="KCARD-TEXT">У 1938 р. парафія налічувала 1 045 осіб і охоплювала понад 100 навколишніх сіл, зокрема Крупове, Острівці, Мочулище, Воробин та інші. Це була одна з найбільших католицьких громад на Рівненщині.</div>
                    <div class="KCARD-TEXT">Перший дерев'яний костел, збудований тут у 1684 р., шведські війська спалили у 1709 р. під час відступу після Полтавської битви. Нинішня мурована споруда в стилі рококо — трьохнавна базиліка — зведена на її місці й стала єдиним нагадуванням про ту добу.</div>
                </div>

            </div>

            <!-- ═══ PHOTO ═══ -->
            <div class="KPHOTO-COL" id="KPHOTO-COL">
                <img
                    class="KPHOTO-IMG"
                    id="KPHOTO-IMG"
                    src="https://i.imgur.com/Ru7uTkK.jpeg"
                    alt="Костел Іоанна Хрестителя"
                    draggable="false"
                >
                <div class="KPINS-OVL" id="KPINS-OVL"></div>
                <svg class="KARROWS" id="KARROWS-SVG" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
            </div>

            <!-- ═══ RIGHT PANEL ═══ -->
            <div class="KPANEL KPANEL-R">

                <div class="KCARD" id="card-D">
                    <span class="KCARD-LABEL">Відкрито 1702 р.</span>
                    <div class="KCARD-TITLE">Головний портал</div>
                    <div class="KCARD-TEXT">Портал відкритий у 1702 р. — ще до завершення всього будівництва. Це свідчить про те, що богослужіння в костелі розпочалися задовго до офіційної консекрації 1742 р. Інтер'єр оздоблений у стилі рококо: хрестові склепіння нефу, різьблені вівтарі й скульптурний декор.</div>
                    <div class="KCARD-TEXT">Підлога виконана з керамічних кахлів на вапняному розчині, гашеному сирими яйцями — традиційна технологія бароко, яка забезпечувала особливу міцність. Головний образ вівтаря — св. Іоанна Хрестителя — роботи живописця Лукаша Хубля, що дивом вцілів у радянський час.</div>
                </div>

                <div class="KCARD" id="card-E">
                    <span class="KCARD-LABEL">Втрачено 1945 р. ✝</span>
                    <div class="KCARD-TITLE">Венеційський вітраж</div>
                    <div class="KCARD-TEXT">Найцінніший елемент інтер'єру — вітраж, замовлений і виготовлений спеціально у Венеції. Він вважався унікальним для всього регіону Полісся: жоден інший костел чи церква в окрузі не мали нічого подібного за художньою цінністю й майстерністю виконання.</div>
                    <div class="KCARD-TEXT">Знищений радянською владою одразу після закриття костелу у 1945 р. Від нього не залишилося ані фрагментів, ані документальних зображень. Відновлення вітражу досі не відбулося.</div>
                </div>

            </div>

        </div><!-- /KSTAGE -->

        <p class="KHINT">
            <svg width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/></svg>
            Маркери на фото вказують на ключові елементи
        </p>

        <!-- Stats -->
        <div class="KSTATS">
            <div class="KST">
                <div class="KST-V">1684</div>
                <div class="KST-K">Перший костел</div>
                <div class="KST-D">Дерев'яний, коштом Яна Кароля Дольського. Спалений шведами у 1709 р. під час відступу після Полтавської битви.</div>
            </div>
            <div class="KST">
                <div class="KST-V">330+</div>
                <div class="KST-K">Років історії</div>
                <div class="KST-D">Пам'ятка архітектури національного значення — охоронний №&thinsp;1497. Найстаріша збережена споруда Дубровиці.</div>
            </div>
            <div class="KST">
                <div class="KST-V">1045</div>
                <div class="KST-K">Парафіян · 1938</div>
                <div class="KST-D">Понад 100 навколишніх сіл. Після 1945 р. парафію ліквідовано, майно конфісковано, будівлю зробили промисловим складом.</div>
            </div>
            <div class="KST">
                <div class="KST-V">1992</div>
                <div class="KST-K">Повернення</div>
                <div class="KST-D">Освячений єпископом Маркіяном Трофим'яком у листопаді 1992 р. після чотирьох десятиліть радянського складу.</div>
            </div>
        </div>

        <!-- Gallery -->
        <div class="KGAL">
            <div class="KGAL-HDR">
                <div class="KGAL-TITLE">Інтер'єр костелу</div>
            </div>
            <div class="KGAL-GRID">
                <div class="KGAL-ITEM KGAL-MAIN" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/u6vHC49.jpeg" alt="Головний вівтар" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/pcuoEmD.jpeg" alt="Інтер'єр" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/JM3Qg4Z.jpeg" alt="Інтер'єр" loading="lazy">
                </div>
                <div class="KGAL-ITEM" onclick="openKLB(this)">
                    <img src="https://i.imgur.com/dHKnHPp.jpeg" alt="Інтер'єр" loading="lazy">
                </div>
            </div>
        </div>

    </div><!-- /#KP -->

    <div id="KLB">
        <button class="KLB-X" onclick="document.getElementById('KLB').classList.remove('on')">&#x2715;</button>
        <img id="KLB-I" src="" alt="">
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="footer-title">Дубровиця</h4>
                    <p class="footer-text">Цифровий архів історичної спадщини міста Дубровиця, Сарненський район, Рівненська область, Україна.</p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Навігація</h4>
                    <nav class="footer-nav">
                        <a href="history.html">Історія</a>
                        <a href="photo-archive.html">Фотоархів</a>
                        <a href="architecture.html">Пам'ятки</a>
                        <a href="metrychni-knyhy.html">Метричні книги</a>
                        <a href="books.html">Книги</a>
                    </nav>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">Контакти</h4>
                    <p class="footer-text">Маєте матеріали або пропозиції?<br><a href="contacts.html" class="footer-link">Зв'яжіться з нами</a></p>
                </div>
            </div>
            <div class="footer-bottom"><p>&copy; 2026 Дубровиця. Цифровий архів.</p></div>
        </div>
    </footer>

    <script>
    // ═══════════════════════════════════════════════════════════
    // Marker positions — % of photo width/height
    // Looking at the photo: building is on left ~55% of frame
    //   Main tower cross (top):   x=33%, y=4%
    //   Left tower dome:          x=22%, y=22%
    //   Left facade (baroque):    x=19%, y=50%
    //   Portal bottom:            x=34%, y=90%
    //   Right nave / windows:     x=56%, y=63%
    // ═══════════════════════════════════════════════════════════
    var MARKERS = [
        { px: 33, py:  4, side: 'L', cardId: 'card-A' },
        { px: 22, py: 22, side: 'L', cardId: 'card-B' },
        { px: 19, py: 50, side: 'L', cardId: 'card-C' },
        { px: 34, py: 90, side: 'R', cardId: 'card-D' },
        { px: 56, py: 63, side: 'R', cardId: 'card-E' },
    ];

    var photoEl  = document.getElementById('KPHOTO-IMG');
    var ovlEl    = document.getElementById('KPINS-OVL');
    var svgEl    = document.getElementById('KARROWS-SVG');

    // Build circle markers
    MARKERS.forEach(function(m, i) {
        var wrap = document.createElement('div');
        wrap.className = 'KM';
        wrap.style.left = m.px + '%';
        wrap.style.top  = m.py + '%';
        wrap.style.opacity = '0';
        wrap.style.transition = 'opacity .5s ease';

        var pulse = document.createElement('div');
        pulse.className = 'KM-PULSE';
        // Stagger pulse delay
        pulse.style.animationDelay = (i * 0.6) + 's';

        var ring = document.createElement('div');
        ring.className = 'KM-RING';

        var dot = document.createElement('div');
        dot.className = 'KM-DOT';

        ring.appendChild(dot);
        wrap.appendChild(pulse);
        wrap.appendChild(ring);
        ovlEl.appendChild(wrap);

        setTimeout(function() { wrap.style.opacity = '1'; }, 400 + i * 160);
    });

    // Build SVG lines — solid, thin, single horizontal to edge
    function buildLines() {
        if (window.innerWidth <= 960) return;
        svgEl.innerHTML = '';

        // Get card vertical positions relative to photo top
        // We need to draw line from marker to edge, with a small angled elbow
        // to point roughly at the card in the side panel.
        // Since cards are stacked vertically in the panel, we compute
        // rough target Y based on card position in panel.

        var photoRect = document.getElementById('KPHOTO-COL').getBoundingClientRect();
        var photoH = photoRect.height || photoEl.offsetHeight;
        var photoY = photoRect.top;

        MARKERS.forEach(function(m) {
            var cardEl = document.getElementById(m.cardId);
            if (!cardEl) return;

            var cardRect = cardEl.getBoundingClientRect();
            // Card center Y relative to photo top, as % of photo height
            var cardCenterPx = cardRect.top + cardRect.height / 2 - photoY;
            var cardPy = (cardCenterPx / photoH) * 100;
            // Clamp
            cardPy = Math.max(2, Math.min(98, cardPy));

            var x1 = m.px, y1 = m.py;
            var x2 = (m.side === 'L') ? 0 : 100;

            // Two-point path: marker → elbow at edge x, midpoint Y → (just for visual)
            // Simple: straight line from marker to edge at card's Y level
            // with a tiny kink at the marker
            var line = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            line.setAttribute('points',
                x1 + '% ' + y1 + '%, ' +
                x2 + '% ' + cardPy + '%'
            );
            line.setAttribute('class', 'KL');
            svgEl.appendChild(line);

            // Tiny arrowhead at edge
            var arr = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            var ax = parseFloat(x2), ay = parseFloat(cardPy);
            var s = .8; // size in %
            var pts;
            if (m.side === 'L') {
                pts = (ax-s*1.6)+'% '+ay+'%, '+ax+'% '+(ay-s*.8)+'%, '+ax+'% '+(ay+s*.8)+'%';
            } else {
                pts = (ax+s*1.6)+'% '+ay+'%, '+ax+'% '+(ay-s*.8)+'%, '+ax+'% '+(ay+s*.8)+'%';
            }
            arr.setAttribute('points', pts);
            arr.setAttribute('class', 'KA');
            svgEl.appendChild(arr);
        });
    }

    function animateCards() {
        document.querySelectorAll('.KCARD').forEach(function(c, i) {
            setTimeout(function() { c.classList.add('vis'); }, 250 + i * 180);
        });
    }

    function sync() {
        ovlEl.style.height = photoEl.offsetHeight + 'px';
        buildLines();
    }

    photoEl.addEventListener('load', function() { sync(); animateCards(); });
    window.addEventListener('resize', function() { sync(); });
    if (photoEl.complete) { sync(); animateCards(); }
    setTimeout(function() { sync(); animateCards(); }, 500);

    function openKLB(el) {
        document.getElementById('KLB-I').src = el.querySelector('img').src;
        document.getElementById('KLB').classList.add('on');
    }
    document.getElementById('KLB').addEventListener('click', function(e) {
        if (e.target === this) this.classList.remove('on');
    });
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') document.getElementById('KLB').classList.remove('on');
    });
    </script>
    <script src="script.js"></script>
</body>
</html>
